{"version":3,"sources":["meteor://ðŸ’»app/imports/message-read-receipt/server/lib/ReadReceipt.js","meteor://ðŸ’»app/imports/message-read-receipt/server/api/methods/getReadReceipts.js","meteor://ðŸ’»app/imports/message-read-receipt/server/models/ReadReceipts.js","meteor://ðŸ’»app/imports/message-read-receipt/server/dbIndexes.js","meteor://ðŸ’»app/imports/message-read-receipt/server/hooks.js","meteor://ðŸ’»app/imports/message-read-receipt/server/index.js","meteor://ðŸ’»app/imports/message-read-receipt/server/settings.js","meteor://ðŸ’»app/imports/startup/server/index.js","meteor://ðŸ’»app/server/lib/cordova/facebook-login.js","meteor://ðŸ’»app/server/lib/accounts.js","meteor://ðŸ’»app/server/lib/cordova.js","meteor://ðŸ’»app/server/startup/migrations/v001.js","meteor://ðŸ’»app/server/startup/migrations/v002.js","meteor://ðŸ’»app/server/startup/migrations/v003.js","meteor://ðŸ’»app/server/startup/migrations/v004.js","meteor://ðŸ’»app/server/startup/migrations/v005.js","meteor://ðŸ’»app/server/startup/migrations/v006.js","meteor://ðŸ’»app/server/startup/migrations/v007.js","meteor://ðŸ’»app/server/startup/migrations/v008.js","meteor://ðŸ’»app/server/startup/migrations/v009.js","meteor://ðŸ’»app/server/startup/migrations/v010.js","meteor://ðŸ’»app/server/startup/migrations/v011.js","meteor://ðŸ’»app/server/startup/migrations/v012.js","meteor://ðŸ’»app/server/startup/migrations/v013.js","meteor://ðŸ’»app/server/startup/migrations/v014.js","meteor://ðŸ’»app/server/startup/migrations/v015.js","meteor://ðŸ’»app/server/startup/migrations/v016.js","meteor://ðŸ’»app/server/startup/migrations/v017.js","meteor://ðŸ’»app/server/startup/migrations/v018.js","meteor://ðŸ’»app/server/startup/migrations/v019.js","meteor://ðŸ’»app/server/startup/migrations/v020.js","meteor://ðŸ’»app/server/startup/migrations/v021.js","meteor://ðŸ’»app/server/startup/migrations/v022.js","meteor://ðŸ’»app/server/startup/migrations/v023.js","meteor://ðŸ’»app/server/startup/migrations/v024.js","meteor://ðŸ’»app/server/startup/migrations/v025.js","meteor://ðŸ’»app/server/startup/migrations/v026.js","meteor://ðŸ’»app/server/startup/migrations/v027.js","meteor://ðŸ’»app/server/startup/migrations/v028.js","meteor://ðŸ’»app/server/startup/migrations/v029.js","meteor://ðŸ’»app/server/startup/migrations/v030.js","meteor://ðŸ’»app/server/startup/migrations/v031.js","meteor://ðŸ’»app/server/startup/migrations/v032.js","meteor://ðŸ’»app/server/startup/migrations/v033.js","meteor://ðŸ’»app/server/startup/migrations/v034.js","meteor://ðŸ’»app/server/startup/migrations/v035.js","meteor://ðŸ’»app/server/startup/migrations/v036.js","meteor://ðŸ’»app/server/startup/migrations/v037.js","meteor://ðŸ’»app/server/startup/migrations/v038.js","meteor://ðŸ’»app/server/startup/migrations/v039.js","meteor://ðŸ’»app/server/startup/migrations/v040.js","meteor://ðŸ’»app/server/startup/migrations/v041.js","meteor://ðŸ’»app/server/startup/migrations/v042.js","meteor://ðŸ’»app/server/startup/migrations/v043.js","meteor://ðŸ’»app/server/startup/migrations/v044.js","meteor://ðŸ’»app/server/startup/migrations/v045.js","meteor://ðŸ’»app/server/startup/migrations/v046.js","meteor://ðŸ’»app/server/startup/migrations/v047.js","meteor://ðŸ’»app/server/startup/migrations/v048.js","meteor://ðŸ’»app/server/startup/migrations/v049.js","meteor://ðŸ’»app/server/startup/migrations/v050.js","meteor://ðŸ’»app/server/startup/migrations/v051.js","meteor://ðŸ’»app/server/startup/migrations/v052.js","meteor://ðŸ’»app/server/startup/migrations/v053.js","meteor://ðŸ’»app/server/startup/migrations/v054.js","meteor://ðŸ’»app/server/startup/migrations/v055.js","meteor://ðŸ’»app/server/startup/migrations/v056.js","meteor://ðŸ’»app/server/startup/migrations/v057.js","meteor://ðŸ’»app/server/startup/migrations/v058.js","meteor://ðŸ’»app/server/startup/migrations/v059.js","meteor://ðŸ’»app/server/startup/migrations/v060.js","meteor://ðŸ’»app/server/startup/migrations/v061.js","meteor://ðŸ’»app/server/startup/migrations/v062.js","meteor://ðŸ’»app/server/startup/migrations/v063.js","meteor://ðŸ’»app/server/startup/migrations/v064.js","meteor://ðŸ’»app/server/startup/migrations/v065.js","meteor://ðŸ’»app/server/startup/migrations/v066.js","meteor://ðŸ’»app/server/startup/migrations/v067.js","meteor://ðŸ’»app/server/startup/migrations/v068.js","meteor://ðŸ’»app/server/startup/migrations/v069.js","meteor://ðŸ’»app/server/startup/migrations/v070.js","meteor://ðŸ’»app/server/startup/migrations/v071.js","meteor://ðŸ’»app/server/startup/migrations/v072.js","meteor://ðŸ’»app/server/startup/migrations/v073.js","meteor://ðŸ’»app/server/startup/migrations/v074.js","meteor://ðŸ’»app/server/startup/migrations/v075.js","meteor://ðŸ’»app/server/startup/migrations/v076.js","meteor://ðŸ’»app/server/startup/migrations/v077.js","meteor://ðŸ’»app/server/startup/migrations/v078.js","meteor://ðŸ’»app/server/startup/migrations/v079.js","meteor://ðŸ’»app/server/startup/migrations/v080.js","meteor://ðŸ’»app/server/startup/migrations/v081.js","meteor://ðŸ’»app/server/startup/migrations/v082.js","meteor://ðŸ’»app/server/startup/migrations/v083.js","meteor://ðŸ’»app/server/startup/migrations/v084.js","meteor://ðŸ’»app/server/startup/migrations/v085.js","meteor://ðŸ’»app/server/startup/migrations/v086.js","meteor://ðŸ’»app/server/startup/migrations/v087.js","meteor://ðŸ’»app/server/startup/migrations/v088.js","meteor://ðŸ’»app/server/startup/migrations/v089.js","meteor://ðŸ’»app/server/startup/migrations/v090.js","meteor://ðŸ’»app/server/startup/migrations/v091.js","meteor://ðŸ’»app/server/startup/migrations/v092.js","meteor://ðŸ’»app/server/startup/migrations/v093.js","meteor://ðŸ’»app/server/startup/migrations/v094.js","meteor://ðŸ’»app/server/startup/migrations/v095.js","meteor://ðŸ’»app/server/startup/migrations/v096.js","meteor://ðŸ’»app/server/startup/migrations/v097.js","meteor://ðŸ’»app/server/startup/migrations/v098.js","meteor://ðŸ’»app/server/startup/migrations/v099.js","meteor://ðŸ’»app/server/startup/migrations/v100.js","meteor://ðŸ’»app/server/startup/migrations/v101.js","meteor://ðŸ’»app/server/startup/migrations/v102.js","meteor://ðŸ’»app/server/startup/migrations/v103.js","meteor://ðŸ’»app/server/startup/migrations/v104.js","meteor://ðŸ’»app/server/startup/migrations/v105.js","meteor://ðŸ’»app/server/startup/migrations/v106.js","meteor://ðŸ’»app/server/startup/migrations/v107.js","meteor://ðŸ’»app/server/startup/migrations/v108.js","meteor://ðŸ’»app/server/startup/migrations/v109.js","meteor://ðŸ’»app/server/startup/migrations/v110.js","meteor://ðŸ’»app/server/startup/migrations/v111.js","meteor://ðŸ’»app/server/startup/migrations/v112.js","meteor://ðŸ’»app/server/startup/migrations/v113.js","meteor://ðŸ’»app/server/startup/migrations/v114.js","meteor://ðŸ’»app/server/startup/migrations/v115.js","meteor://ðŸ’»app/server/startup/migrations/v116.js","meteor://ðŸ’»app/server/startup/migrations/v117.js","meteor://ðŸ’»app/server/startup/migrations/v118.js","meteor://ðŸ’»app/server/startup/migrations/v119.js","meteor://ðŸ’»app/server/startup/migrations/v120.js","meteor://ðŸ’»app/server/startup/migrations/v121.js","meteor://ðŸ’»app/server/startup/migrations/v122.js","meteor://ðŸ’»app/server/startup/migrations/v123.js","meteor://ðŸ’»app/server/startup/migrations/v124.js","meteor://ðŸ’»app/server/startup/migrations/v125.js","meteor://ðŸ’»app/server/startup/migrations/v126.js","meteor://ðŸ’»app/server/startup/migrations/v127.js","meteor://ðŸ’»app/server/startup/migrations/v128.js","meteor://ðŸ’»app/server/startup/migrations/v129.js","meteor://ðŸ’»app/server/startup/migrations/v130.js","meteor://ðŸ’»app/server/startup/migrations/xrun.js","meteor://ðŸ’»app/server/startup/appcache.js","meteor://ðŸ’»app/server/startup/avatar.js","meteor://ðŸ’»app/server/startup/cron.js","meteor://ðŸ’»app/server/startup/i18n-validation.js","meteor://ðŸ’»app/server/startup/initialData.js","meteor://ðŸ’»app/server/startup/presence.js","meteor://ðŸ’»app/server/startup/serverRunning.js","meteor://ðŸ’»app/server/configuration/accounts_meld.js","meteor://ðŸ’»app/server/configuration/grant.js","meteor://ðŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ðŸ’»app/server/methods/addAllUserToRoom.js","meteor://ðŸ’»app/server/methods/addRoomLeader.js","meteor://ðŸ’»app/server/methods/addRoomModerator.js","meteor://ðŸ’»app/server/methods/addRoomOwner.js","meteor://ðŸ’»app/server/methods/afterVerifyEmail.js","meteor://ðŸ’»app/server/methods/browseChannels.js","meteor://ðŸ’»app/server/methods/canAccessRoom.js","meteor://ðŸ’»app/server/methods/channelsList.js","meteor://ðŸ’»app/server/methods/createDirectMessage.js","meteor://ðŸ’»app/server/methods/deleteFileMessage.js","meteor://ðŸ’»app/server/methods/deleteUser.js","meteor://ðŸ’»app/server/methods/eraseRoom.js","meteor://ðŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ðŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ðŸ’»app/server/methods/getRoomNameById.js","meteor://ðŸ’»app/server/methods/getTotalChannels.js","meteor://ðŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ðŸ’»app/server/methods/getUsersOfRoom.js","meteor://ðŸ’»app/server/methods/hideRoom.js","meteor://ðŸ’»app/server/methods/ignoreUser.js","meteor://ðŸ’»app/server/methods/loadHistory.js","meteor://ðŸ’»app/server/methods/loadLocale.js","meteor://ðŸ’»app/server/methods/loadMissedMessages.js","meteor://ðŸ’»app/server/methods/loadNextMessages.js","meteor://ðŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ðŸ’»app/server/methods/logoutCleanUp.js","meteor://ðŸ’»app/server/methods/messageSearch.js","meteor://ðŸ’»app/server/methods/migrate.js","meteor://ðŸ’»app/server/methods/muteUserInRoom.js","meteor://ðŸ’»app/server/methods/openRoom.js","meteor://ðŸ’»app/server/methods/readMessages.js","meteor://ðŸ’»app/server/methods/registerUser.js","meteor://ðŸ’»app/server/methods/removeRoomLeader.js","meteor://ðŸ’»app/server/methods/removeRoomModerator.js","meteor://ðŸ’»app/server/methods/removeRoomOwner.js","meteor://ðŸ’»app/server/methods/removeUserFromRoom.js","meteor://ðŸ’»app/server/methods/reportMessage.js","meteor://ðŸ’»app/server/methods/requestDataDownload.js","meteor://ðŸ’»app/server/methods/resetAvatar.js","meteor://ðŸ’»app/server/methods/roomNameExists.js","meteor://ðŸ’»app/server/methods/saveUserPreferences.js","meteor://ðŸ’»app/server/methods/saveUserProfile.js","meteor://ðŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ðŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ðŸ’»app/server/methods/setAvatarFromService.js","meteor://ðŸ’»app/server/methods/setUserActiveStatus.js","meteor://ðŸ’»app/server/methods/setUserPassword.js","meteor://ðŸ’»app/server/methods/toogleFavorite.js","meteor://ðŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ðŸ’»app/server/methods/userSetUtcOffset.js","meteor://ðŸ’»app/server/publications/activeUsers.js","meteor://ðŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ðŸ’»app/server/publications/fullUserData.js","meteor://ðŸ’»app/server/publications/messages.js","meteor://ðŸ’»app/server/publications/room.js","meteor://ðŸ’»app/server/publications/roomFiles.js","meteor://ðŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ðŸ’»app/server/publications/spotlight.js","meteor://ðŸ’»app/server/publications/subscription.js","meteor://ðŸ’»app/server/publications/userAutocomplete.js","meteor://ðŸ’»app/server/publications/userChannels.js","meteor://ðŸ’»app/server/publications/userData.js","meteor://ðŸ’»app/server/stream/messages.js","meteor://ðŸ’»app/server/stream/streamBroadcast.js","meteor://ðŸ’»app/server/main.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/francocatena_fix.js"],"names":["module","export","ReadReceipt","Random","watch","require","v","ModelReadReceipts","default","rawReadReceipts","model","rawCollection","list","debounceByRoomId","fn","roomId","args","clearTimeout","setTimeout","call","updateMessages","Meteor","bindEnvironment","firstSubscription","RocketChat","models","Subscriptions","getMinimumLastSeenByRoomId","Messages","setAsRead","ls","markMessagesAsRead","userId","userLastSeen","settings","get","room","Rooms","findOneById","fields","lm","storeReadReceipts","findUnreadMessagesByRoomAndDate","markMessageAsReadBySender","message","unread","ts","setAsReadById","_id","messages","Date","receipts","map","id","messageId","length","insertMany","e","console","error","getReceipts","findByMessageId","receipt","user","Users","username","name","methods","getReadReceipts","Error","method","rid","_Base","constructor","arguments","tryEnsureIndex","unique","find","exportDefault","sparse","callbacks","add","editedAt","setAsReadByRoomIdAndUserId","u","group","type","public","enableQuery","value","_","getIdentity","accessToken","HTTP","params","access_token","data","extend","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","now","expiresIn","whitelisted","pick","options","profile","updateOrCreateUserFromExternalService","s","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","config","emailTemplates","siteName","from","userToActivate","subject","TAPi18n","__","html","header","placeholders","replace","footer","email","reason","userActivated","active","action","verifyEmailHtml","verifyEmail","text","url","absoluteUrl","urls","resetPassword","token","enrollAccount","lng","language","emails","address","onCreateUser","run","status","firstName","lastName","services","service","Object","values","verified","destinations","Roles","findUsersInRole","forEach","adminUser","Array","isArray","push","to","defer","Email","send","insertUserDoc","wrap","roles","Match","test","globalRoles","String","concat","password","defaultAuthServiceRoles","split","trim","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","Settings","updateValueById","authz","addUserRoles","validateLoginAttempt","login","allowed","includes","validEmail","filter","updateLastLoginById","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","push_test","hasRole","Push","enabled","query","$and","$or","$exists","tokens","appCollection","count","title","apn","sound","sendPush","tries","post","statusCode","log","remove","SystemLogger","milli","Math","pow","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","app","topic","appName","startup","Migrations","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","image","contentType","RocketChatFile","dataURIParse","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","tryDropIndex","uid","nonreactive","sub","update","$set","$unset","$in","uids","usernames","t","k","oldId","sort","join","removeById","multi","rn","$rename","item","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","by","findOneByName","upsert","index","isString","OEmbed","rocketUrlParser","CDN_PREFIX","ENV","MAIL_URL","denyUnverifiedEmails","avatarStore","path","toMigrate","source","Mongo","Collection","target","OEmbedCache","collection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","new","oldAndNew","oldSetting","oldValue","newSetting","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","chunks","__migration_assets_chunks","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","code","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","audioNotification","lastActivity","LDAP_Domain_Base","LDAP_Domain_Search_User_ID","LDAP_Use_Custom_Domain_Search","LDAP_Custom_Domain_Search","LDAP_Domain_Search_User","LDAP_Domain_Search_Password","LDAP_Domain_Search_Filter","LDAP_Domain_Search_Object_Class","LDAP_Domain_Search_Object_Category","Custom_Domain_Search","parse","userDN","LDAP_Sync_User_Data","LDAP_Import_Users","majorColors","newvariables","lightenDarkenColor","col","amt","usePound","slice","num","r","b","g","toString","color","editor","newPreference","unreadRoomsMode","settingsMap","newSettingKey","LivechatVisitors","visitors","total","deparment","userAgent","ip","host","phone","role","createOrUpdate","FileUpload_GoogleStorage_Proxy","FileUpload_S3_Proxy","idleTimeLimit","fileQuery","filesToUpdate","messageQuery","announcement","desktopNotifications","desktopPrefOrigin","mobilePushNotifications","mobilePrefOrigin","emailNotifications","emailPrefOrigin","mobileNotifications","emailNotificationMode","userHighlights","highlights","pageVisitedCollection","messageCollection","roomCollection","roomIdByToken","batchSize","migrateHistory","items","toArray","actions","reduce","page","location","href","groupable","navigation","expireAt","ops","removeMany","LivechatPageVisited","pages","close","Future","_db","originals","usersCount","findByRoomId","fname","usersByUsername","obj","updateSubscription","fut","processBatch","itens","return","wait","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","sharp","WebApp","connectHandlers","use","req","res","decodeURIComponent","cacheTime","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","toUTCString","initials","getAvatarColor","substr","toUpperCase","viewSize","fontSize","svg","format","toFormat","pipe","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","provider","secret","apps","redirectUrl","errorUrl","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","hasPermission","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","sortChannels","field","direction","sortUsers","browseChannels","sortBy","sortDirection","regex","escapeRegExp","skip","results","findByNameAndType","description","lastMessage","archived","findByActiveUsersExcept","DDPRateLimiter","addRule","canAccessRoom","extraData","Maybe","channelsList","channelType","unblock","Optional","isNumber","channels","findByTypeAndNameContaining","roomIds","findByTypeAndUserId","findByTypeInIds","findByTypeInIdsAndNameContaining","userPref","getUserPreference","groupByType","createDirectMessage","me","myNotificationPref","getDefaultSubscriptionPref","upsertSubscription","customFields","toNotificationPref","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","eraseRoom","Apps","isLoaded","prevent","await","getBridges","getListenerBridge","roomEvent","roomTypes","canBeDeleted","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","generateSuggestion","preferredHandle","first","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","broadcast","findByRoomIdWhenUsernameExists","userIds","findUsersWithUsernameByIds","findUsersWithUsernameByIdsNotOffline","records","hideRoom","hideByRoomIdAndUserId","ignoreUser","ignoredUser","ignore","subscriptionIgnoredUser","hideMessagesOfType","types","loadHistory","fromId","canAnonymous","canPreview","loadMessageHistory","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","starred","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","docs","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","filterLabel","tag","sortByTimestamp","startsWith","$regex","$options","mention","$text","$search","score","$meta","findByUserId","getMigrationVersion","muteUserInRoom","ObjectIncluding","findOneByRoomIdAndUsername","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","userSubscription","assign","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","manuallyApproveNewUsers","_loginUser","pass","secretURL","passwordPolicy","validate","validateEmailDomain","userData","importedUser","importIds","createUser","setReason","saveCustomFields","userModel","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","Reports","createWithMessageDescriptionAndUserId","tempFolder","requestDataDownload","fullExport","currentUserData","lastOperation","ExportOperations","findLastOperationByUser","yesterday","setUTCDate","getUTCDate","requested","exportOperation","existsSync","mkdirSync","subFolderName","baseFolder","folderName","assetsFolder","roomList","exportPath","assetsPath","fileList","generatedFile","resetAvatar","unsetAvatarOrigin","roomNameExists","saveUserPreferences","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","unreadAlert","notificationsSoundVolume","enableAutoAway","desktopNotificationDuration","messageViewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","sidebarShowFavorites","sidebarShowUnread","sidebarSortby","sidebarViewMode","sidebarHideAvatar","sidebarGroupByType","muteFocusedConversations","oldDesktopNotifications","oldMobileNotifications","oldEmailNotifications","clearSettings","setLanguage","setPreferences","clearDesktopNotificationUserPreferences","updateDesktopNotificationUserPreferences","clearMobileNotificationUserPreferences","updateMobileNotificationUserPreferences","clearEmailNotificationUserPreferences","updateEmailNotificationUserPreferences","updateUserHighlights","saveUserProfile","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","setRealName","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","unsetReason","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","ready","findUsersNotOffline","selector","pub","cursorHandle","findChannelAndPrivateByNameStarting","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","lastUpdate","latestDate","oldestDate","inclusive","unreads","updated","findForUpdates","deleted","trashFindDeletedAfter","_deletedAt","latest","oldest","cl","announcementDetails","muted","_updatedAt","jitsiTimeout","livechatData","tags","sms","joinCodeRequired","ro","reactWhenReadOnly","sysMes","sentiment","tokenpass","streamingOptions","roomMap","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","findByTypeAndName","on","clientAction","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","fetchRooms","spotlight","searchForChannels","searchForDMs","roomOptions","findByNameAndTypeNotDefault","userOptions","searchableRoomTypes","entries","roomType","includeInRoomSearch","findByUserIdAndTypes","findByNameAndTypesNotInIds","$nin","audioNotifications","audioNotificationValue","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","muteGroupMentions","ignored","trashFindOneById","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","banners","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","publishMessage","imported","UI_Use_Real_Name","emitWithoutBroadcast","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","serverOnly","emitWithScope","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","fromInstance","connected","endpoint","conn","currentStatus","i18n_status_func"],"mappings":"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","file":"/app.js","sourcesContent":["import { Random } from 'meteor/random';\nimport ModelReadReceipts from '../models/ReadReceipts';\n\nconst rawReadReceipts = ModelReadReceipts.model.rawCollection();\n\n// debounced function by roomId, so multiple calls within 2 seconds to same roomId runs only once\nconst list = {};\nconst debounceByRoomId = function(fn) {\n\treturn function(roomId, ...args) {\n\t\tclearTimeout(list[roomId]);\n\t\tlist[roomId] = setTimeout(() => { fn.call(this, roomId, ...args); }, 2000);\n\t};\n};\n\nconst updateMessages = debounceByRoomId(Meteor.bindEnvironment((roomId) => {\n\t// @TODO maybe store firstSubscription in room object so we don't need to call the above update method\n\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\tRocketChat.models.Messages.setAsRead(roomId, firstSubscription.ls);\n}));\n\nexport const ReadReceipt = {\n\tmarkMessagesAsRead(roomId, userId, userLastSeen) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { lm: 1 } });\n\n\t\t// if users last seen is greadebounceByRoomIdter than room's last message, it means the user already have this room marked as read\n\t\tif (userLastSeen > room.lm) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (userLastSeen) {\n\t\t\tthis.storeReadReceipts(RocketChat.models.Messages.findUnreadMessagesByRoomAndDate(roomId, userLastSeen), roomId, userId);\n\t\t}\n\n\t\tupdateMessages(roomId);\n\t},\n\n\tmarkMessageAsReadBySender(message, roomId, userId) {\n\t\tif (!RocketChat.settings.get('Message_Read_Receipt_Enabled')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// this will usually happens if the message sender is the only one on the room\n\t\tconst firstSubscription = RocketChat.models.Subscriptions.getMinimumLastSeenByRoomId(roomId);\n\t\tif (message.unread && message.ts < firstSubscription.ls) {\n\t\t\tRocketChat.models.Messages.setAsReadById(message._id, firstSubscription.ls);\n\t\t}\n\n\t\tthis.storeReadReceipts([{ _id: message._id }], roomId, userId);\n\t},\n\n\tstoreReadReceipts(messages, roomId, userId) {\n\t\tif (RocketChat.settings.get('Message_Read_Receipt_Store_Users')) {\n\t\t\tconst ts = new Date();\n\t\t\tconst receipts = messages.map(message => {\n\t\t\t\treturn {\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\troomId,\n\t\t\t\t\tuserId,\n\t\t\t\t\tmessageId: message._id,\n\t\t\t\t\tts\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tif (receipts.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\trawReadReceipts.insertMany(receipts);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Error inserting read receipts per user');\n\t\t\t}\n\t\t}\n\t},\n\n\tgetReceipts(message) {\n\t\treturn ModelReadReceipts.findByMessageId(message._id).map(receipt => ({\n\t\t\t...receipt,\n\t\t\tuser: RocketChat.models.Users.findOneById(receipt.userId, { fields: { username: 1, name: 1 }})\n\t\t}));\n\t}\n};\n","import { Meteor } from 'meteor/meteor';\n\nimport { ReadReceipt } from '../../lib/ReadReceipt';\n\nMeteor.methods({\n\tgetReadReceipts({ messageId }) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tif (!messageId) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'The required \\'messageId\\' param is missing.', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { method: 'getReadReceipts' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getReadReceipts' });\n\t\t}\n\n\t\treturn ReadReceipt.getReceipts(message);\n\t}\n});\n","class ModelReadReceipts extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({\n\t\t\troomId: 1,\n\t\t\tuserId: 1,\n\t\t\tmessageId: 1\n\t\t}, {\n\t\t\tunique: 1\n\t\t});\n\t}\n\n\tfindByMessageId(messageId) {\n\t\treturn this.find({ messageId });\n\t}\n}\n\nexport default new ModelReadReceipts('message_read_receipt');\n","RocketChat.models.Messages.tryEnsureIndex({\n\tunread: 1\n}, {\n\tsparse: true\n});\n","import { ReadReceipt } from './lib/ReadReceipt';\n\nRocketChat.callbacks.add('afterSaveMessage', (message, room) => {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\t// set subscription as read right after message was sent\n\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(room._id, message.u._id);\n\n\t// mark message as read as well\n\tReadReceipt.markMessageAsReadBySender(message, room._id, message.u._id);\n});\n","import './dbIndexes';\nimport './hooks';\nimport './settings';\n\nimport './api/methods/getReadReceipts';\n","RocketChat.settings.add('Message_Read_Receipt_Enabled', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true\n});\n\nRocketChat.settings.add('Message_Read_Receipt_Store_Users', false, {\n\tgroup: 'Message',\n\ttype: 'boolean',\n\tpublic: true,\n\tenableQuery: { _id: 'Message_Read_Receipt_Enabled', value: true }\n});\n","import '../../message-read-receipt/server';\n","import _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nconst accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nAccounts.emailTemplates.userToActivate = {\n\tsubject() {\n\t\tconst subject = TAPi18n.__('Accounts_Admin_Email_Approval_Needed_Subject_Default');\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ subject }`;\n\t},\n\n\thtml(options = {}) {\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\tconst email = options.reason ? 'Accounts_Admin_Email_Approval_Needed_With_Reason_Default' : 'Accounts_Admin_Email_Approval_Needed_Default';\n\n\t\tconst html = RocketChat.placeholders.replace(TAPi18n.__(email), {\n\t\t\tname: options.name,\n\t\t\temail: options.email,\n\t\t\treason: options.reason\n\t\t});\n\n\t\treturn header + html + footer;\n\t}\n};\n\nAccounts.emailTemplates.userActivated = {\n\tsubject({active, username}) {\n\t\tconst action = active ? (username ? 'Activated' : 'Approved') : 'Deactivated';\n\t\tconst subject = `Accounts_Email_${ action }_Subject`;\n\t\tconst siteName = RocketChat.settings.get('Site_Name');\n\n\t\treturn `[${ siteName }] ${ TAPi18n.__(subject) }`;\n\t},\n\n\thtml({active, name, username}) {\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\tconst action = active ? (username ? 'Activated' : 'Approved') : 'Deactivated';\n\n\t\tconst html = RocketChat.placeholders.replace(TAPi18n.__(`Accounts_Email_${ action }`), {\n\t\t\tname\n\t\t});\n\n\t\treturn header + html + footer;\n\t}\n};\n\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nAccounts.urls.resetPassword = function(token) {\n\treturn Meteor.absoluteUrl(`reset-password/${ token }`);\n};\n\nAccounts.emailTemplates.resetPassword.html = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/*, url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: user.name,\n\t\temail: user.emails && user.emails[0] && user.emails[0].address\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!user.active) {\n\t\tconst destinations = [];\n\n\t\tRocketChat.models.Roles.findUsersInRole('admin').forEach(adminUser => {\n\t\t\tif (Array.isArray(adminUser.emails)) {\n\t\t\t\tadminUser.emails.forEach(email => {\n\t\t\t\t\tdestinations.push(`${ adminUser.name }<${ email.address }>`);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tconst email = {\n\t\t\tto: destinations,\n\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\tsubject: Accounts.emailTemplates.userToActivate.subject(),\n\t\t\thtml: Accounts.emailTemplates.userToActivate.html(options)\n\t\t};\n\n\t\tMeteor.defer(() => Email.send(email));\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id\n\t});\n\n\tif (user.username) {\n\t\tif (options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\t\tMeteor.runAsUser(_id, function() {\n\t\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t\t});\n\t\t}\n\n\t\tif (user.type !== 'visitor') {\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', user);\n\t\t\t});\n\t\t}\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (!login.user.roles || !Array.isArray(login.user.roles)) {\n\t\tthrow new Meteor.Error('error-user-has-no-roles', 'User has no roles', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter(email => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some(domain => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions\n\t\t}\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\nimport _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': `Custom OAuth: ${ name }`,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({$or: [{_id: 'PiwikAnalytics_url', value: {$ne: null}}, {_id: 'PiwikAnalytics_siteId', value: {$ne: null}}]}).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'PiwikAnalytics_enabled'}, {$set: {value: true}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tname: null\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'services.linkedin.firstName': 1, username: 1}).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', 'event': 'sendMessage' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room'\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous'\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true }\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'emails.address.address': 1}).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some(email => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }`} }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>`} }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/'\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({err});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => {\n\t\treturn fn(item);\n\t})).then(() => { return batch(arr, limit, fn); });\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'store': 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin'\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStorePath'});\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStoreType'});\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars'\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({avatarOrigin: {$in: avatarOrigins}}, {avatarOrigin: 1, username: 1}).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStoreType'});\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStorePath'});\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 100,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({audioNotification:{$exists:1}}, { $rename: { 'audioNotification': 'audioNotifications' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 101,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({lastActivity:{$exists:1}}, { $unset: { 'lastActivity': '' } }, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 102,\n\tup() {\n\t\tif (!RocketChat || !RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Connect_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Idle_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tconst LDAP_Domain_Base = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Base' });\n\t\tif (LDAP_Domain_Base) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_BaseDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Base.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Base' });\n\n\t\tconst LDAP_Domain_Search_User_ID = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User_ID' });\n\t\tif (LDAP_Domain_Search_User_ID) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Field' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User_ID.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User_ID' });\n\n\t\tconst LDAP_Use_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tconst LDAP_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Custom_Domain_Search' });\n\n\t\tconst LDAP_Domain_Search_User = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User' });\n\t\tconst LDAP_Domain_Search_Password = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Password' });\n\t\tconst LDAP_Domain_Search_Filter = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tconst LDAP_Domain_Search_Object_Class = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tconst LDAP_Domain_Search_Object_Category = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Category' });\n\n\t\tif (LDAP_Use_Custom_Domain_Search) {\n\t\t\tif (LDAP_Use_Custom_Domain_Search.value === true) {\n\t\t\t\tlet Custom_Domain_Search;\n\t\t\t\ttry {\n\t\t\t\t\tCustom_Domain_Search = JSON.parse(LDAP_Custom_Domain_Search.value);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t\t}\n\n\t\t\t\tLDAP_Domain_Search_User.value = Custom_Domain_Search.userDN || '';\n\t\t\t\tLDAP_Domain_Search_Password.value = Custom_Domain_Search.password || '';\n\t\t\t\tLDAP_Domain_Search_Filter.value = Custom_Domain_Search.filter;\n\t\t\t} else {\n\t\t\t\tconst filter = [];\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Category.value !== '') {\n\t\t\t\t\tfilter.push(`(objectCategory=${ LDAP_Domain_Search_Object_Category.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Class.value !== '') {\n\t\t\t\t\tfilter.push(`(objectclass=${ LDAP_Domain_Search_Object_Class.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Filter.value !== '') {\n\t\t\t\t\tfilter.push(`(${ LDAP_Domain_Search_Filter.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (filter.length === 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = filter[0];\n\t\t\t\t} else if (filter.length > 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = `(&${ filter.join('') })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (LDAP_Domain_Search_Filter && LDAP_Domain_Search_Filter.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Filter' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Filter.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_UserDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User' });\n\n\n\t\tif (LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_Password' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Password.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Password' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value && LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Category' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Sync_Users' }); //Button\n\n\t\tconst LDAP_Sync_User_Data = RocketChat.models.Settings.findOne({ _id: 'LDAP_Sync_User_Data' });\n\t\tif (LDAP_Sync_User_Data && LDAP_Sync_User_Data.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tconst LDAP_Import_Users = RocketChat.models.Settings.findOne({ _id: 'LDAP_Import_Users' });\n\t\tif (LDAP_Import_Users && LDAP_Import_Users.value === false) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync_Import_New_Users' },\n\t\t\t\t{ $set: { value: false } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Import_Users' });\n\t}\n});\n","const majorColors = {\n\t'content-background-color': '#FFFFFF',\n\t'primary-background-color': '#04436A',\n\t'primary-font-color': '#444444',\n\t'primary-action-color': '#13679A', // was action-buttons-color\n\t'secondary-background-color': '#F4F4F4',\n\t'secondary-font-color': '#A0A0A0',\n\t'secondary-action-color': '#DDDDDD',\n\t'component-color': '#EAEAEA',\n\t'success-color': '#4dff4d',\n\t'pending-color': '#FCB316',\n\t'error-color': '#BC2031',\n\t'selection-color': '#02ACEC',\n\t'attention-color': '#9C27B0'\n};\n\n// Minor colours implement major colours by default, but can be overruled\n// const minorColors = {\n// \t'tertiary-background-color': '@component-color',\n// \t'tertiary-font-color': '@transparent-lightest',\n// \t'link-font-color': '@primary-action-color',\n// \t'info-font-color': '@secondary-font-color',\n// \t'custom-scrollbar-color': '@transparent-darker',\n// \t'status-online': '@success-color',\n// \t'status-away': '@pending-color',\n// \t'status-busy': '@error-color',\n// \t'status-offline': '@transparent-darker'\n// };\n\nconst newvariables = {\n\t'content-background-color': 'rc-color-primary-lightest',\n\t'primary-background-color': 'rc-color-primary',\n\t'success-color': 'rc-color-success',\n\t'pending-color': 'rc-color-alert',\n\t'error-color': 'rc-color-error',\n\t'status-online': 'rc-color-success',\n\t'status-away': 'rc-color-alert',\n\t'status-busy': 'rc-color-error',\n\t'status-offline': 'rc-color-primary-darkest'\n};\n\nfunction lightenDarkenColor(col, amt) {\n\tlet usePound = false;\n\tif (col[0] === '#') {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\n\tconst num = parseInt(col, 16);\n\tlet r = (num >> 16) + amt;\n\n\tif (r > 255) { r = 255; } else if (r < 0) { r = 0; }\n\n\tlet b = ((num >> 8) & 0x00FF) + amt;\n\n\tif (b > 255) { b = 255; } else if (b < 0) { b = 0; }\n\n\tlet g = (num & 0x0000FF) + amt;\n\n\tif (g > 255) { g = 255; } else if (g < 0) { g = 0; }\n\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nRocketChat.Migrations.add({\n\tversion: 103,\n\tup() {\n\t\tObject.keys(majorColors).forEach(function(_id) {\n\t\t\tconst color = RocketChat.models.Settings.findOne({_id: `theme-color-${ _id }`});\n\t\t\tconst key = newvariables[_id];\n\t\t\tif (color && color.value !== majorColors[_id] && key) {\n\t\t\t\tif (/^@.+/.test(color.value)) {\n\t\t\t\t\tcolor.value = newvariables[color.value.replace('@', '')];\n\t\t\t\t}\n\t\t\t\tconst id = `theme-color-${ key }`;\n\t\t\t\tRocketChat.models.Settings.update({_id: id}, {$set: { value : color.value, editor: /^#.+/.test(color.value) ? 'color' : 'expression' }});\n\t\t\t\tif (key === 'rc-color-primary') {\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, -16)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 18)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 110)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 156)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 200)}});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n});\n","RocketChat.Migrations.add({\n\tversion: 104,\n\tup() {\n\t\tif ((RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary'}) || {}).value === '#04436A' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-darkest'}) || {}).value === '#335a' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-dark'}) || {}).value === '#16557c' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light'}) || {}).value === '#72b1d8' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light-medium'}) || {}).value === '#a0dfff' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-lightest'}) || {}).value === '#ccffff'\n\t\t) {\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary'}, {$set: {editor: 'expression', value: 'color-dark'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'expression', value: 'color-darkest'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'expression', value: 'color-dark-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'expression', value: 'color-gray'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'expression', value: 'color-gray-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'expression', value: 'color-gray-lightest'}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 105,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.unreadRoomsMode': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tconst newPreference = user.settings.preferences.unreadRoomsMode ? 'unread' : 'category';\n\t\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.unreadRoomsMode': 1 }, $set: { 'settings.preferences.roomsListExhibitionMode': newPreference } });\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst settingsMap = {\n\t\t\t\t\t'Desktop_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_desktopNotifications',\n\t\t\t\t\t'Mobile_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_mobileNotifications',\n\t\t\t\t\t'Audio_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_audioNotifications',\n\t\t\t\t\t'Desktop_Notifications_Duration': 'Accounts_Default_User_Preferences_desktopNotificationDuration',\n\t\t\t\t\t'Audio_Notifications_Value': undefined\n\t\t\t\t};\n\t\t\t\tRocketChat.models.Settings.find({ _id: { $in: Object.keys(settingsMap) }}).forEach(oldSetting => {\n\t\t\t\t\tconst newSettingKey = settingsMap[oldSetting._id];\n\t\t\t\t\tconst newSetting = newSettingKey && RocketChat.models.Settings.findOne({ _id: newSettingKey });\n\n\t\t\t\t\tif (newSetting && newSetting.value !== oldSetting.value) {\n\t\t\t\t\t\tRocketChat.models.Settings.update({ _id: newSettingKey }, {\t$set: {\tvalue: oldSetting.value\t}\t});\n\t\t\t\t\t}\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: oldSetting._id });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","import LivechatVisitors from 'meteor/rocketchat:livechat/server/models/LivechatVisitors';\n\nRocketChat.Migrations.add({\n\tversion: 106,\n\tup() {\n\t\tconst visitors = Meteor.users.find({ type: 'visitor' });\n\t\tconst total = visitors.count();\n\t\tlet current = 1;\n\n\t\tconsole.log('Migrating livechat visitors, this may take a while ...');\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tvisitors.forEach(user => {\n\t\t\t\tconsole.log(`Migrating visitor ${ current++ }/${ total }`);\n\n\t\t\t\tconst {\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone\n\t\t\t\t} = user;\n\t\t\t\tLivechatVisitors.insert({\n\t\t\t\t\t_id,\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tdeparment,\n\t\t\t\t\tuserAgent,\n\t\t\t\t\tip,\n\t\t\t\t\thost,\n\t\t\t\t\tvisitorEmails,\n\t\t\t\t\tphone,\n\t\t\t\t\ttoken: user.profile.token\n\t\t\t\t});\n\n\t\t\t\tMeteor.users.remove({ _id });\n\t\t\t});\n\n\t\t\tconsole.log('Livechat visitors migration finished.');\n\t\t}, 1000);\n\t}\n});\n","\n\nRocketChat.Migrations.add({\n\tversion: 107,\n\tup() {\n\n\n\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'activity'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'activity',\n\t\t\t\t'preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'unread'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowUnread' : true,\n\t\t\t\t'preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'preferences.roomsListExhibitionMode': 'category'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 108,\n\tup() {\n\t\tconst roles = RocketChat.models.Roles.find({\n\t\t\t_id: { $ne: 'guest' },\n\t\t\tscope: 'Users'\n\t\t}).fetch().map((role)=>{ return role._id; });\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-c', roles);\n\t\tRocketChat.models.Permissions.createOrUpdate('leave-d', roles);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 109,\n\tup() {\n\t\tconst FileUpload_GoogleStorage_Proxy = (RocketChat.models.Settings.findOne({_id: 'FileUpload_GoogleStorage_Proxy'}) || {}).value === true;\n\t\tconst FileUpload_S3_Proxy = (RocketChat.models.Settings.findOne({_id: 'FileUpload_S3_Proxy'}) || {}).value === true;\n\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_GoogleStorage_Proxy_Avatars'}, {$set: {value: FileUpload_GoogleStorage_Proxy}});\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_GoogleStorage_Proxy_Uploads'}, {$set: {value: FileUpload_GoogleStorage_Proxy}});\n\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_S3_Proxy_Avatars'}, {$set: {value: FileUpload_S3_Proxy}});\n\t\tRocketChat.models.Settings.update({_id: 'FileUpload_S3_Proxy_Uploads'}, {$set: {value: FileUpload_S3_Proxy}});\n\n\t\tRocketChat.models.Settings.remove({_id: 'FileUpload_GoogleStorage_Proxy'});\n\t\tRocketChat.models.Settings.remove({_id: 'FileUpload_S3_Proxy'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 110,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_viewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.viewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.viewMode': 'user.settings.preferences.messageViewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t},\n\tdown() {\n\t\tif (RocketChat && RocketChat.models) {\n\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_messageViewMode' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_viewMode' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.remove(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_messageViewMode' }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t{ 'settings.preferences.messageViewMode': { $exists: 1 } },\n\t\t\t\t\t{ $rename: { 'settings.preferences.messageViewMode': 'user.settings.preferences.viewMode' } },\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","// Migration to give delete channel, delete group permissions to owner\nRocketChat.Migrations.add({\n\tversion: 111,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-c' }, { $addToSet: { roles: 'owner' } });\n\t\t\tRocketChat.models.Permissions.update({ _id: 'delete-p' }, { $addToSet: { roles: 'owner' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 112,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t\t{ _id: 'Accounts_Default_User_Preferences_idleTimeoutLimit' },\n\t\t\t\t\t\t{ $set: { value: setting.value / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.idleTimeLimit': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tRocketChat.models.Users.update(\n\t\t\t\t\t\t{ _id: user._id },\n\t\t\t\t\t\t{ $set: { 'settings.preferences.idleTimeLimit': user.settings.preferences.idleTimeLimit / 1000 } }\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 113,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Uploads && RocketChat.models.Messages) {\n\t\t\tconst fileQuery = {\n\t\t\t\tuserId: null\n\t\t\t};\n\n\t\t\tconst filesToUpdate = RocketChat.models.Uploads.find(fileQuery);\n\t\t\tfilesToUpdate.forEach((file) => {\n\t\t\t\tconst messageQuery = {\n\t\t\t\t\t'file._id' : file._id\n\t\t\t\t};\n\t\t\t\tconst message = RocketChat.models.Messages.findOne(messageQuery);\n\t\t\t\tif (message) {\n\t\t\t\t\tconst filter = {\n\t\t\t\t\t\t_id: file._id\n\t\t\t\t\t};\n\n\t\t\t\t\tconst update = {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tuserId: message.u._id\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tRocketChat.models.Uploads.model.direct.update(filter, update);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 114,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Message_GlobalSearch' });\n\t\t\t\tif (setting && setting.value) {\n\t\t\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t\t\t{ _id: 'Search.defaultProvider.GlobalSearchEnabled' },\n\t\t\t\t\t\t{ $set: { value: setting.value } }\n\t\t\t\t\t);\n\n\t\t\t\t\tRocketChat.models.Settings.removeById('Message_GlobalSearch');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 115,\n\tup() {\n\t\tRocketChat.models.Rooms.update({\n\t\t\t'announcement.message': { $exists: true }\n\t\t}, {\n\t\t\t$unset: { announcement: 1 }\n\t\t}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 116,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex({\n\t\t\tunread: 1\n\t\t});\n\n\t\t// set pref origin to all existing preferences\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tdesktopNotifications: { $exists: true }\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tdesktopPrefOrigin: 'subscription'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\tmobilePushNotifications: { $exists: true }\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmobilePrefOrigin: 'subscription'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\temailNotifications: { $exists: true }\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\temailPrefOrigin: 'subscription'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\t// set user preferences on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true } }\n\t\t\t]\n\t\t}).forEach(user => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: { $exists: false }\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t\tdesktopPrefOrigin: 'user'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: { $exists: false }\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobileNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t\tmobilePrefOrigin: 'user'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: { $exists: false }\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t\temailPrefOrigin: 'user'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 117,\n\tup() {\n\t\tif (RocketChat.authz &&\n\t\tRocketChat.models &&\n\t\tRocketChat.models.Settings &&\n\t\tRocketChat.authz.getUsersInRole('admin').count()) {\n\t\t\tRocketChat.models.Settings.upsert(\n\t\t\t\t{\n\t\t\t\t\t_id: 'Show_Setup_Wizard'\n\t\t\t\t}, {\n\t\t\t\t\t$set: { value: 'completed' }\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 118,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\temailNotifications: 'all',\n\t\t\temailPrefOrigin: 'user'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\temailNotifications: 'mentions'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti:true\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.emailNotificationMode': 'disabled'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.emailNotificationMode': 'nothing'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti:true\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.emailNotificationMode': 'all'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.emailNotificationMode': 'mentions'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti:true\n\t\t});\n\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'Accounts_Default_User_Preferences_emailNotificationMode',\n\t\t\tvalue: 'disabled'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'nothing'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({\n\t\t\t_id: 'Accounts_Default_User_Preferences_emailNotificationMode',\n\t\t\tvalue: 'all'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'mentions'\n\t\t\t}\n\t\t});\n\n\t\t// set user highlights on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t'settings.preferences.highlights.0': {$exists: true}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.highlights': 1\n\t\t\t}\n\t\t}).forEach(user => {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tuserHighlights: user.settings.preferences.highlights\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 119,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t$set: { value: 'pending' }\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t_id: 'Show_Setup_Wizard',\n\t\t\t\tvalue: false\n\t\t\t}, {\n\t\t\t\t$set: { value: 'completed' }\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 120,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'activity'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'activity',\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'unread'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'settings.preferences.sidebarShowUnread' : true,\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.roomsListExhibitionMode': 'category'\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.roomsListExhibitionMode': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.sidebarSortby': 'alphabetical',\n\t\t\t\t'settings.preferences.sidebarShowFavorites': true\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 121,\n\tup() {\n\n\t\t// set user preferences on subscriptions\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true } }\n\t\t\t]\n\t\t}).forEach(user => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: { $exists: false }\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications,\n\t\t\t\t\t\tdesktopPrefOrigin: 'user'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: { $exists: false }\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobileNotifications: user.settings.preferences.mobileNotifications,\n\t\t\t\t\t\tmobilePrefOrigin: 'user'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: { $exists: false }\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions',\n\t\t\t\t\t\temailPrefOrigin: 'user'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 122,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1_code_1');\n\t\tconsole.log('Fixing ChatSubscription u._id_1_name_1_t_1_code_1');\n\t}\n});\n","let pageVisitedCollection;\nlet messageCollection;\nlet roomCollection;\n\nconst roomIdByToken = {};\n\nconst batchSize = 5000;\n\nasync function migrateHistory(total, current) {\n\tconsole.log(`Livechat history migration ${ current }/${ total }`);\n\n\tconst items = await pageVisitedCollection.find({}).limit(batchSize).toArray();\n\n\tconst tokens = items.filter((item) => item.token && !roomIdByToken[item.token]).map((item) => item.token);\n\tconst rooms = await roomCollection.find({\n\t\t'v.token': {\n\t\t\t$in: tokens\n\t\t}\n\t}, {\n\t\tfields: {\n\t\t\t'v.token': 1\n\t\t}\n\t}).toArray();\n\n\trooms.forEach((room) => {\n\t\troomIdByToken[room.v.token] = room._id;\n\t});\n\n\tconst actions = items.reduce((result, item) => {\n\t\tconst msg = {\n\t\t\tt: 'livechat_navigation_history',\n\t\t\trid: roomIdByToken[item.token] || null, // prevent from being `undefined`\n\t\t\tts: item.ts,\n\t\t\tmsg: `${ item.page.title } - ${ item.page.location.href }`,\n\t\t\tu: {\n\t\t\t\t_id : 'rocket.cat',\n\t\t\t\tusername : 'rocket.cat'\n\t\t\t},\n\t\t\tgroupable : false,\n\t\t\tnavigation : {\n\t\t\t\tpage: item.page,\n\t\t\t\ttoken: item.token\n\t\t\t}\n\t\t};\n\t\tif (!roomIdByToken[item.token] && item.expireAt) {\n\t\t\tmsg.expireAt = item.expireAt;\n\t\t}\n\t\tresult.insert.push(msg);\n\t\tresult.remove.push(item._id);\n\n\t\treturn result;\n\t}, { insert: [], remove: [] });\n\n\tconst ops = [];\n\n\tif (actions.insert.length > 0) {\n\t\tops.push(messageCollection.insertMany(actions.insert));\n\t}\n\n\tif (actions.remove.length > 0) {\n\t\tops.push(pageVisitedCollection.removeMany({ _id: { $in: actions.remove } }));\n\t}\n\n\tconst batch = Promise.all(ops);\n\tif (actions.remove.length === batchSize) {\n\t\tawait batch;\n\t\treturn migrateHistory(total, current + batchSize);\n\t}\n\n\treturn batch;\n}\n\n\nRocketChat.Migrations.add({\n\tversion: 123,\n\tup() {\n\t\tpageVisitedCollection = RocketChat.models.LivechatPageVisited.model.rawCollection();\n\t\tmessageCollection = RocketChat.models.Messages.model.rawCollection();\n\t\troomCollection = RocketChat.models.Rooms.model.rawCollection();\n\n\t\t/*\n\t\t * Move visitor navigation history to messages\n\t\t */\n\t\tMeteor.setTimeout(async() => {\n\t\t\tconst pages = pageVisitedCollection.find({});\n\t\t\tconst total = await pages.count();\n\t\t\tawait pages.close();\n\n\t\t\tconsole.log('Migrating livechat visitors navigation history to livechat messages. This might take a long time ...');\n\n\t\t\tawait migrateHistory(total, 0);\n\n\t\t\tconsole.log('Livechat visitors navigation history migration finished.');\n\t\t}, 1000);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 124,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.mergeChannels': true\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.mergeChannels': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.groupByType': false\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.mergeChannels': false\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\t'settings.preferences.mergeChannels': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\t'settings.preferences.groupByType': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 125,\n\tup() {\n\t\tRocketChat.models.Users.update({\n\t\t\t'settings.preferences.groupByType': { $exists: true }\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\t'settings.preferences.groupByType': 'settings.preferences.sidebarGroupByType'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 126,\n\tup() {\n\t\tif (!RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: 'Accounts_Default_User_Preferences_idleTimeoutLimit'\n\t\t};\n\t\tconst setting = RocketChat.models.Settings.findOne(query);\n\n\t\tif (setting) {\n\t\t\tdelete setting._id;\n\t\t\tRocketChat.models.Settings.upsert({_id: 'Accounts_Default_User_Preferences_idleTimeLimit'}, setting);\n\t\t\tRocketChat.models.Settings.remove(query);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 127,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('view-livechat-manager');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'remove-closed-livechat-rooms' }, { $set: { roles: newPermission.roles } });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission\n\t\t\tRocketChat.models.Permissions.remove({ _id: 'remove-closed-livechat-rooms' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 128,\n\tup() {\n\t\tconst _id = 'theme-font-body-font-family';\n\t\tconst oldValue = '-apple-system, BlinkMacSystemFont, Roboto, \\'Helvetica Neue\\', Arial, sans-serif, \\'Apple Color Emoji\\', \\'Segoe UI\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Meiryo UI\\'';\n\t\tconst newValue = '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, \\'Helvetica Neue\\', \\'Apple Color Emoji\\', \\'Segoe UI Emoji\\', \\'Segoe UI Symbol\\', \\'Meiryo UI\\', Arial, sans-serif';\n\n\t\tRocketChat.models.Settings.update({ _id, value: oldValue }, {\n\t\t\t$set: {\n\t\t\t\tvalue: newValue\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 129,\n\tup() {\n\t\tRocketChat.models.Users.find({\n\t\t\t$or: [\n\t\t\t\t{ 'settings.preferences.desktopNotifications': { $exists: true, $ne: 'default' } },\n\t\t\t\t{ 'settings.preferences.mobileNotifications': { $exists: true, $ne: 'default' } },\n\t\t\t\t{ 'settings.preferences.emailNotificationMode': { $exists: true, $ne: 'default' } }\n\t\t\t]\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t'settings.preferences.desktopNotifications': 1,\n\t\t\t\t'settings.preferences.mobileNotifications': 1,\n\t\t\t\t'settings.preferences.emailNotificationMode': 1\n\t\t\t}\n\t\t}).forEach(user => {\n\t\t\tif (user.settings.preferences.desktopNotifications && user.settings.preferences.desktopNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tdesktopPrefOrigin: 'user',\n\t\t\t\t\tdesktopNotifications: null\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tdesktopNotifications: user.settings.preferences.desktopNotifications\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.mobileNotifications && user.settings.preferences.mobileNotifications !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\tmobilePrefOrigin: 'user',\n\t\t\t\t\tmobilePushNotifications: null\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tmobilePushNotifications: user.settings.preferences.mobileNotifications\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (user.settings.preferences.emailNotificationMode && user.settings.preferences.emailNotificationMode !== 'default') {\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\t'u._id': user._id,\n\t\t\t\t\temailPrefOrigin: 'user',\n\t\t\t\t\temailNotifications: null\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\temailNotifications: user.settings.preferences.emailNotificationMode === 'disabled' || user.settings.preferences.emailNotificationMode === 'nothing' ? 'nothing' : 'mentions'\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","import Future from 'fibers/future';\n\nRocketChat.Migrations.add({\n\tversion: 129,\n\tup() {\n\t\tRocketChat.models.Rooms._db.originals.update(\n\t\t\t{\n\t\t\t\tt: { $ne: 'd' }\n\t\t\t},\n\t\t\t{\n\t\t\t\t$unset: { usernames: 1 }\n\t\t\t},\n\t\t\t{\n\t\t\t\tmulti: true\n\t\t\t}\n\t\t);\n\n\t\tRocketChat.models.Rooms.find(\n\t\t\t{\n\t\t\t\tusersCount: { $exists: false }\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1\n\t\t\t\t}\n\t\t\t}\n\t\t).forEach(({ _id }) => {\n\t\t\tconst usersCount = RocketChat.models.Subscriptions.findByRoomId(\n\t\t\t\t_id\n\t\t\t).count();\n\n\t\t\tRocketChat.models.Rooms._db.originals.update(\n\t\t\t\t{\n\t\t\t\t\t_id\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusersCount\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\t// Getting all subscriptions and users to memory allow us to process in batches,\n\t\t// all other solutions takes hundreds or thousands times more to process.\n\t\tconst subscriptions = RocketChat.models.Subscriptions.find(\n\t\t\t{\n\t\t\t\tt: 'd',\n\t\t\t\tname: { $exists: true },\n\t\t\t\tfname: { $exists: false }\n\t\t\t},\n\t\t\t{\n\t\t\t\tfields: {\n\t\t\t\t\tname: 1\n\t\t\t\t}\n\t\t\t}\n\t\t).fetch();\n\n\t\tconst users = RocketChat.models.Users.find(\n\t\t\t{ username: { $exists: true }, name: { $exists: true } },\n\t\t\t{ fields: { username: 1, name: 1 } }\n\t\t).fetch();\n\t\tconst usersByUsername = users.reduce((obj, user) => {\n\t\t\tobj[user.username] = user.name;\n\t\t\treturn obj;\n\t\t}, {});\n\n\t\tconst updateSubscription = subscription => {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tMeteor.defer(() => {\n\t\t\t\t\tconst name = usersByUsername[subscription.name];\n\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\treturn resolve();\n\t\t\t\t\t}\n\n\t\t\t\t\tRocketChat.models.Subscriptions._db.originals.update(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_id: subscription._id\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t\tfname: name\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\t// Use FUTURE to process itens in batchs and wait the final one\n\t\tconst fut = new Future();\n\n\t\tconst processBatch = () => {\n\t\t\tconst itens = subscriptions.splice(0, 1000);\n\n\t\t\tconsole.log(\n\t\t\t\t'Migrating',\n\t\t\t\titens.length,\n\t\t\t\t'of',\n\t\t\t\tsubscriptions.length,\n\t\t\t\t'subscriptions'\n\t\t\t);\n\n\t\t\tif (itens.length) {\n\t\t\t\tPromise.all(itens.map(s => updateSubscription(s))).then(() => {\n\t\t\t\t\tprocessBatch();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tfut.return();\n\t\t\t}\n\t\t};\n\n\t\tprocessBatch();\n\n\t\tfut.wait();\n\t}\n});\n","import _ from 'underscore';\n\nif (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","/* globals FileUpload */\nimport _ from 'underscore';\nimport sharp from 'sharp';\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\t\tconst cacheTime = req.query.cacheTime || RocketChat.settings.get('Accounts_AvatarCacheTime');\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\t\t\t\tif (reqModifiedHeader && reqModifiedHeader === (file.uploadedAt && file.uploadedAt.toUTCString())) {\n\t\t\t\t\tres.setHeader('Last-Modified', reqModifiedHeader);\n\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\tres.end();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.setHeader('Cache-Control', `public, max-age=${ cacheTime }`);\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Content-Disposition', 'inline');\n\t\t\t\tres.setHeader('Last-Modified', file.uploadedAt.toUTCString());\n\t\t\t\tres.setHeader('Content-Type', file.type);\n\t\t\t\tres.setHeader('Content-Length', file.size);\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', `public, max-age=${ cacheTime }`);\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tcolor = RocketChat.getAvatarColor(username);\n\n\t\t\t\t\tinitials = username.replace(/[^A-Za-z0-9]/g, '').substr(0, 1).toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst viewSize = parseInt(req.query.size) || 200;\n\t\t\t\tconst fontSize = viewSize / 1.6;\n\n\t\t\t\tconst svg = `<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 ${ viewSize } ${ viewSize }\\\">\\n<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"${ color }\\\"/>\\n<text x=\\\"50%\\\" y=\\\"50%\\\" dy=\\\"0.36em\\\" text-anchor=\\\"middle\\\" pointer-events=\\\"none\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-size=\"${ fontSize }\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tif (['png', 'jpg', 'jpeg'].includes(req.query.format)) {\n\t\t\t\t\tres.setHeader('Content-Type', `image/${ req.query.format }`);\n\t\t\t\t\tsharp(new Buffer(svg))\n\t\t\t\t\t\t.toFormat(req.query.format)\n\t\t\t\t\t\t.pipe(res);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\n\t\treturn SyncedCron.start();\n\t});\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nfunction flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","import _ from 'underscore';\n\nMeteor.startup(function() {\n\tMeteor.defer(() => {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png'\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username || oldestUser.name } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tif (!_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tconsole.log('Setting Setup Wizard to \"in_progress\" because, at least, one admin was found');\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\tif (RocketChat.settings.get('Show_Setup_Wizard') === 'pending') {\n\t\t\t\tRocketChat.models.Settings.updateValueById('Show_Setup_Wizard', 'in_progress');\n\t\t\t}\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim()\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","import _ from 'underscore';\n\nconst orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {} /*, options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm'\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","import { Settings } from 'meteor/rocketchat:grant';\n\nSettings.add({\n\tenabled: true,\n\tprovider: 'github',\n\tkey: '96db2753350cfe8c8ae1',\n\tsecret: '546317a561df5e3d350fca9b5500f270b54f3301'\n});\n\nSettings.add({\n\tenabled: true,\n\tprovider: 'facebook',\n\tkey: '494859557516801',\n\tsecret: '5274d3495cebaf01f7e1b90fe1331fba'\n});\n\nSettings.add({\n\tenabled: true,\n\tprovider: 'google',\n\tkey: '979285364697-pob8soqche90ng1af0pj9if6ed69jalh.apps.googleusercontent.com',\n\tsecret: 'lFWtrtJngtlNBdrAoevwPjZh'\n});\n\nSettings.apps.add('pwa', {\n\tredirectUrl: 'http://localhost:4200/login?service={provider}&access_token={accessToken}&refresh_token={refreshToken}',\n\terrorUrl: 'http://localhost:4200/login?service={provider}&error={error}'\n});\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t}\n});\n","import s from 'underscore.string';\n\nconst sortChannels = function(field, direction) {\n\tswitch (field) {\n\t\tcase 'createdAt':\n\t\t\treturn {\n\t\t\t\tts: direction === 'asc' ? 1 : -1\n\t\t\t};\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1\n\t\t\t};\n\t}\n};\n\nconst sortUsers = function(field, direction) {\n\tswitch (field) {\n\t\tdefault:\n\t\t\treturn {\n\t\t\t\t[field]: direction === 'asc' ? 1 : -1\n\t\t\t};\n\t}\n};\n\n\nMeteor.methods({\n\tbrowseChannels({text = '', type = 'channels', sortBy = 'name', sortDirection = 'asc', page = 0, limit = 10}) {\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (!['channels', 'users'].includes(type)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['asc', 'desc'].includes(sortDirection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!['name', 'createdAt', ...type === 'channels' ? ['usersCount'] : [], ...type === 'users' ? ['username'] : []].includes(sortBy)) {\n\t\t\treturn;\n\t\t}\n\n\t\tpage = page > -1 ? page : 0;\n\n\t\tlimit = limit > 0 ? limit : 10;\n\n\t\tconst options = {\n\t\t\tskip: limit * page,\n\t\t\tlimit\n\t\t};\n\n\t\tconst user = Meteor.user();\n\t\tif (type === 'channels') {\n\n\t\t\tconst sort = sortChannels(sortBy, sortDirection);\n\t\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-c-room')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tresults: RocketChat.models.Rooms.findByNameAndType(regex, 'c', {\n\t\t\t\t\t...options,\n\t\t\t\t\tsort,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tdescription: 1,\n\t\t\t\t\t\ttopic: 1,\n\t\t\t\t\t\tname: 1,\n\t\t\t\t\t\tlastMessage: 1,\n\t\t\t\t\t\tts: 1,\n\t\t\t\t\t\tarchived: 1,\n\t\t\t\t\t\tusersCount: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch(),\n\t\t\t\ttotal: RocketChat.models.Rooms.findByNameAndType(regex, 'c').count()\n\t\t\t};\n\t\t}\n\n\t\t// type === users\n\t\tif (!RocketChat.authz.hasPermission(user._id, 'view-outside-room') || !RocketChat.authz.hasPermission(user._id, 'view-d-room')) {\n\t\t\treturn;\n\t\t}\n\t\tconst sort = sortUsers(sortBy, sortDirection);\n\t\treturn {\n\t\t\tresults: RocketChat.models.Users.findByActiveUsersExcept(text, [user.username], {\n\t\t\t\t...options,\n\t\t\t\tsort,\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tname: 1,\n\t\t\t\t\tcreatedAt: 1,\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t}).fetch(),\n\t\t\ttotal: RocketChat.models.Users.findByActiveUsersExcept(text, [user.username]).count()\n\t\t};\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'browseChannels',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","Meteor.methods({\n\tcanAccessRoom(rid, userId, extraData) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user, extraData)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tlet channels = [];\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByType('c', options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeAndNameContaining('c', filter, options).fetch());\n\t\t\t\t}\n\t\t\t} else if (RocketChat.authz.hasPermission(userId, 'view-joined-room')) {\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByTypeAndUserId('c', userId, {fields: {rid: 1}}).fetch().map(s => s.rid);\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIds('c', roomIds, options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIdsAndNameContaining('c', roomIds, filter, options).fetch());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(userId, 'view-p-room')) {\n\t\t\tconst user = RocketChat.models.Users.findOne(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\t'settings.preferences.sidebarGroupByType': 1\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst userPref = RocketChat.getUserPreference(user, 'sidebarGroupByType');\n\t\t\t// needs to negate globalPref because userPref represents its opposite\n\t\t\tconst groupByType = userPref !== undefined ? userPref : RocketChat.settings.get('UI_Group_Channels_By_Type');\n\n\t\t\tif (!groupByType) {\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByTypeAndUserId('p', userId, {fields: {rid: 1}}).fetch().map(s => s.rid);\n\t\t\t\tif (filter) {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIds('p', roomIds, options).fetch());\n\t\t\t\t} else {\n\t\t\t\t\tchannels = channels.concat(RocketChat.models.Rooms.findByTypeInIdsAndNameContaining('p', roomIds, filter, options).fetch());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tchannels\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.settings.get('Message_AllowDirectMessagesToYourself') === false && me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now,\n\t\t\t\tusersCount: 2\n\t\t\t}\n\t\t});\n\n\t\tconst myNotificationPref = RocketChat.getDefaultSubscriptionPref(me);\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tfname: to.name,\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: me.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t},\n\t\t\t\t...myNotificationPref\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tconst toNotificationPref = RocketChat.getDefaultSubscriptionPref(to);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tfname: me.username,\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tcustomFields: to.customFields,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t},\n\t\t\t\t...toNotificationPref\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid\n\t\t};\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Apps && Apps.isLoaded()) {\n\t\t\tconst prevent = Promise.await(Apps.getBridges().getListenerBridge().roomEvent('IPreRoomDeletePrevent', room));\n\t\t\tif (prevent) {\n\t\t\t\tthrow new Meteor.Error('error-app-prevented-deleting', 'A Rocket.Chat App prevented the room erasing.');\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat.roomTypes.roomTypes[room.t].canBeDeleted(room)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\tconst result = RocketChat.models.Rooms.removeById(rid);\n\n\t\t\tif (Apps && Apps.isLoaded()) {\n\t\t\t\tApps.getBridges().getListenerBridge().roomEvent('IPostRoomDeleted', room);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","// DEPRECATE\nMeteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId, { fields: { _id: 1 } });\n\t\tif (subscription) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(userId, 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\nimport _ from 'underscore';\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername(username);\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(rid, showAll) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', rid, userId);\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tif (room.broadcast && !RocketChat.authz.hasPermission(userId, 'view-broadcast-member-list', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdWhenUsernameExists(rid, { fields: { 'u._id': 1 } }).fetch();\n\t\tconst userIds = subscriptions.map(s => s.u._id); // TODO: CACHE: expensive\n\t\tconst options = { fields: { username: 1, name: 1 } };\n\n\t\tconst users = showAll === true\n\t\t\t? RocketChat.models.Users.findUsersWithUsernameByIds(userIds, options).fetch()\n\t\t\t: RocketChat.models.Users.findUsersWithUsernameByIdsNotOffline(userIds, options).fetch();\n\n\t\treturn {\n\t\t\ttotal: userIds.length,\n\t\t\trecords: users\n\t\t};\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\tignoreUser({rid, userId: ignoredUser, ignore = true}) {\n\t\tcheck(ignoredUser, String);\n\t\tcheck(rid, String);\n\t\tcheck(ignore, Boolean);\n\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'ignoreUser'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\tconst subscriptionIgnoredUser = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, ignoredUser);\n\n\t\tif (!subscriptionIgnoredUser) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription', 'Invalid subscription', { method: 'ignoreUser' });\n\t\t}\n\n\t\treturn !!RocketChat.models.Subscriptions.ignoreUser({_id: subscription._id, ignoredUser, ignore});\n\t}\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tthis.unblock();\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, fromId, { fields: { _id: 1 } })) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn RocketChat.loadMessageHistory({ userId: fromId, rid, end, limit, ls });\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages\n\t\t};\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tcheck(text, String);\n\t\tcheck(rid, Match.Maybe(String));\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\t// TODO: Evaluate why we are returning `users` and `channels`, as the only thing that gets set is the `messages`.\n\t\tconst result = {\n\t\t\tmessage: {\n\t\t\t\tdocs:[]\n\t\t\t}\n\t\t};\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\n\t\t// Don't process anything else if the user can't access the room\n\t\tif (rid) {\n\t\t\tif (!Meteor.call('canAccessRoom', rid, currentUserId)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Search.defaultProvider.GlobalSearchEnabled') !== true) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tconst currentUserName = user.username;\n\t\tconst currentUserTimezoneOffset = user.utcOffset;\n\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLabel(_, tag) {\n\t\t\tquery['attachments.0.labels'] = new RegExp(s.escapeRegExp(tag), 'i');\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filter image tags\n\t\ttext = text.replace(/label:(\\w+)/g, filterLabel);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm' //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true // don't return _hidden messages\n\t\t\t};\n\n\t\t\tif (rid) {\n\t\t\t\tquery.rid = rid;\n\t\t\t} else {\n\t\t\t\tquery.rid = {\n\t\t\t\t\t$in: RocketChat.models.Subscriptions.findByUserId(user._id)\n\t\t\t\t\t\t.fetch()\n\t\t\t\t\t\t.map(subscription => subscription.rid)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\toptions.fields = {\n\t\t\t\t\t'editedAt': 0\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tresult.message.docs = RocketChat.models.Messages.find(query, options).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUsername(data.rid, data.username, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","import { ReadReceipt } from '../../imports/message-read-receipt/server/lib/ReadReceipt';\n\nMeteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\t// this prevents cache from updating object reference/pointer\n\t\tconst userSubscription = Object.assign({}, RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, userId));\n\n\t\tRocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, userId);\n\n\t\tMeteor.defer(() => {\n\t\t\tReadReceipt.markMessagesAsRead(rid, userId, userSubscription.ls);\n\t\t});\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tconst manuallyApproveNewUsers = RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous'\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String),\n\t\t\t\treason: Match.Optional(String)\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.passwordPolicy.validate(formData.pass);\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass,\n\t\t\tname: formData.name,\n\t\t\treason: formData.reason\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tconst reason = s.trim(formData.reason);\n\t\tif (manuallyApproveNewUsers && reason) {\n\t\t\tRocketChat.models.Users.setReason(userId, reason);\n\t\t}\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(data.rid, removedUser._id, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","import fs from 'fs';\nimport path from 'path';\n\nlet tempFolder = '/tmp/userData';\nif (RocketChat.settings.get('UserData_FileSystemPath') != null) {\n\tif (RocketChat.settings.get('UserData_FileSystemPath').trim() !== '') {\n\t\ttempFolder = RocketChat.settings.get('UserData_FileSystemPath');\n\t}\n}\n\nMeteor.methods({\n\trequestDataDownload({fullExport = false}) {\n\t\tconst currentUserData = Meteor.user();\n\t\tconst userId = currentUserData._id;\n\n\t\tconst lastOperation = RocketChat.models.ExportOperations.findLastOperationByUser(userId, fullExport);\n\n\t\tif (lastOperation) {\n\t\t\tconst yesterday = new Date();\n\t\t\tyesterday.setUTCDate(yesterday.getUTCDate() - 1);\n\n\t\t\tif (lastOperation.createdAt > yesterday) {\n\t\t\t\treturn {\n\t\t\t\t\trequested: false,\n\t\t\t\t\texportOperation: lastOperation\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!fs.existsSync(tempFolder)) {\n\t\t\tfs.mkdirSync(tempFolder);\n\t\t}\n\n\t\tconst subFolderName = fullExport ? 'full' : 'partial';\n\t\tconst baseFolder = path.join(tempFolder, userId);\n\t\tif (!fs.existsSync(baseFolder)) {\n\t\t\tfs.mkdirSync(baseFolder);\n\t\t}\n\n\t\tconst folderName = path.join(baseFolder, subFolderName);\n\t\tif (!fs.existsSync(folderName)) {\n\t\t\tfs.mkdirSync(folderName);\n\t\t}\n\t\tconst assetsFolder = path.join(folderName, 'assets');\n\t\tif (!fs.existsSync(assetsFolder)) {\n\t\t\tfs.mkdirSync(assetsFolder);\n\t\t}\n\n\t\tconst exportOperation = {\n\t\t\tuserId : currentUserData._id,\n\t\t\troomList: null,\n\t\t\tstatus: 'pending',\n\t\t\texportPath: folderName,\n\t\t\tassetsPath: assetsFolder,\n\t\t\tfileList: [],\n\t\t\tgeneratedFile: null,\n\t\t\tfullExport\n\t\t};\n\n\t\tRocketChat.models.ExportOperations.create(exportOperation);\n\n\t\treturn {\n\t\t\trequested: true,\n\t\t\texportOperation\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists'\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t}\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tconst keys = {\n\t\t\tlanguage: Match.Optional(String),\n\t\t\tnewRoomNotification: Match.Optional(String),\n\t\t\tnewMessageNotification: Match.Optional(String),\n\t\t\tuseEmojis: Match.Optional(Boolean),\n\t\t\tconvertAsciiEmoji: Match.Optional(Boolean),\n\t\t\tsaveMobileBandwidth: Match.Optional(Boolean),\n\t\t\tcollapseMediaByDefault: Match.Optional(Boolean),\n\t\t\tautoImageLoad: Match.Optional(Boolean),\n\t\t\temailNotificationMode: Match.Optional(String),\n\t\t\tunreadAlert: Match.Optional(Boolean),\n\t\t\tnotificationsSoundVolume: Match.Optional(Number),\n\t\t\tdesktopNotifications: Match.Optional(String),\n\t\t\tmobileNotifications: Match.Optional(String),\n\t\t\tenableAutoAway: Match.Optional(Boolean),\n\t\t\thighlights: Match.Optional([String]),\n\t\t\tdesktopNotificationDuration: Match.Optional(Number),\n\t\t\tmessageViewMode: Match.Optional(Number),\n\t\t\thideUsernames: Match.Optional(Boolean),\n\t\t\thideRoles: Match.Optional(Boolean),\n\t\t\thideAvatars: Match.Optional(Boolean),\n\t\t\thideFlexTab: Match.Optional(Boolean),\n\t\t\tsendOnEnter: Match.Optional(String),\n\t\t\troomCounterSidebar: Match.Optional(Boolean),\n\t\t\tidleTimeLimit: Match.Optional(Number),\n\t\t\tsidebarShowFavorites: Match.Optional(Boolean),\n\t\t\tsidebarShowUnread: Match.Optional(Boolean),\n\t\t\tsidebarSortby: Match.Optional(String),\n\t\t\tsidebarViewMode: Match.Optional(String),\n\t\t\tsidebarHideAvatar: Match.Optional(Boolean),\n\t\t\tsidebarGroupByType: Match.Optional(Boolean),\n\t\t\tmuteFocusedConversations: Match.Optional(Boolean)\n\t\t};\n\t\tcheck(settings, Match.ObjectIncluding(keys));\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst {\n\t\t\tdesktopNotifications: oldDesktopNotifications,\n\t\t\tmobileNotifications: oldMobileNotifications,\n\t\t\temailNotificationMode: oldEmailNotifications\n\t\t} = (user.settings && user.settings.preferences) || {};\n\n\t\tif (user.settings == null) {\n\t\t\tRocketChat.models.Users.clearSettings(user._id);\n\t\t}\n\n\t\tif (settings.language != null) {\n\t\t\tRocketChat.models.Users.setLanguage(user._id, settings.language);\n\t\t}\n\n\t\t// Keep compatibility with old values\n\t\tif (settings.emailNotificationMode === 'all') {\n\t\t\tsettings.emailNotificationMode = 'mentions';\n\t\t} else if (settings.emailNotificationMode === 'disabled') {\n\t\t\tsettings.emailNotificationMode = 'nothing';\n\t\t}\n\n\t\tif (settings.idleTimeLimit != null && settings.idleTimeLimit < 60) {\n\t\t\tthrow new Meteor.Error('invalid-idle-time-limit-value', 'Invalid idleTimeLimit');\n\t\t}\n\n\t\tRocketChat.models.Users.setPreferences(user._id, settings);\n\n\t\t// propagate changed notification preferences\n\t\tMeteor.defer(() => {\n\t\t\tif (settings.desktopNotifications && oldDesktopNotifications !== settings.desktopNotifications) {\n\t\t\t\tif (settings.desktopNotifications === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearDesktopNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateDesktopNotificationUserPreferences(user._id, settings.desktopNotifications);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.mobileNotifications && oldMobileNotifications !== settings.mobileNotifications) {\n\t\t\t\tif (settings.mobileNotifications === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearMobileNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateMobileNotificationUserPreferences(user._id, settings.mobileNotifications);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode && oldEmailNotifications !== settings.emailNotificationMode) {\n\t\t\t\tif (settings.emailNotificationMode === 'default') {\n\t\t\t\t\tRocketChat.models.Subscriptions.clearEmailNotificationUserPreferences(user._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.updateEmailNotificationUserPreferences(user._id, settings.emailNotificationMode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Array.isArray(settings.highlights)) {\n\t\t\t\tRocketChat.models.Subscriptions.updateUserHighlights(user._id, settings.highlights);\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\t\tcheck(customFields, Match.Maybe(Object));\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tif (!RocketChat.setRealName(Meteor.userId(), settings.realname)) {\n\t\t\t\tthrow new Meteor.Error('error-could-not-change-name', 'Could not change name', { method: 'saveUserProfile' });\n\t\t\t}\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.passwordPolicy.validate(settings.newPassword);\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tif (customFields && Object.keys(customFields).length) {\n\t\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.unsetReason(userId);\n\t\t\t}\n\n\t\t\tconst destinations = Array.isArray(user.emails) && user.emails.map(email => `${ user.name || user.username }<${ email.address }>`);\n\n\t\t\tif (destinations) {\n\t\t\t\tconst email = {\n\t\t\t\t\tto: destinations,\n\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\tsubject: Accounts.emailTemplates.userActivated.subject({active}),\n\t\t\t\t\thtml: Accounts.emailTemplates.userActivated.html({active, name: user.name, username: user.username})\n\t\t\t\t};\n\n\t\t\t\tMeteor.defer(() => Email.send(email));\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.passwordPolicy.validate(password);\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\tconst userSubscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tif (!userSubscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-subscription',\n\t\t\t\t'You must be part of a room to favorite it',\n\t\t\t\t{ method: 'toggleFavorite' }\n\t\t\t);\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUsername(data.rid, data.username, { fields: { _id: 1 } });\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findChannelAndPrivateByNameStarting(selector.name, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","import _ from 'underscore';\n\nMeteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n\nMeteor.methods({\n\t'messages/get'(rid, {lastUpdate, latestDate = new Date(), oldestDate, inclusive = false, count = 20, unreads= false}) {\n\t\tcheck(rid, String);\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messages/get'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'messages/get'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (lastUpdate instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdated: RocketChat.models.Messages.findForUpdates(rid, lastUpdate, options).fetch(),\n\t\t\t\tdeleted: RocketChat.models.Messages.trashFindDeletedAfter(lastUpdate, {rid}, { ...options, fields: { _id: 1, _deletedAt: 1 }}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn Meteor.call('getChannelHistory', { rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\n\t}\n});\n","import _ from 'underscore';\n\nconst fields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\t// usernames: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tannouncementDetails: 1,\n\tmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tjitsiTimeout: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\tlastMessage: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\tlivechatData: 1,\n\ttags: 1,\n\tsms: 1,\n\tfacebook: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tv: 1,\n\tlabel: 1,\n\tro: 1,\n\treactWhenReadOnly: 1,\n\tsysMes: 1,\n\tsentiment: 1,\n\ttokenpass: 1,\n\tstreamingOptions: 1,\n\tbroadcast: 1\n};\n\nconst roomMap = (record) => {\n\tif (record) {\n\t\treturn _.pick(record, ...Object.keys(fields));\n\t}\n\treturn {};\n};\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tlet options = {fields};\n\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\toptions = {\n\t\t\tfields\n\t\t};\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room || room.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\troom = room[0];\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, userId)) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('Store_Last_Message') && !RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\t\tdelete room.lastMessage;\n\t\t}\n\n\t\treturn roomMap(room);\n\t}\n});\n\nRocketChat.models.Rooms.on('change', ({clientAction, id, data}) => {\n\tswitch (clientAction) {\n\t\tcase 'updated':\n\t\tcase 'inserted':\n\t\t\t// Override data cuz we do not publish all fields\n\t\t\tdata = RocketChat.models.Rooms.findOneById(id, { fields });\n\t\t\tbreak;\n\n\t\tcase 'removed':\n\t\t\tdata = { _id: id };\n\t\t\tbreak;\n\t}\n\n\tif (data) {\n\t\tRocketChat.models.Subscriptions.findByRoomId(id, {fields: {'u._id': 1}}).forEach(({u}) => {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(u._id, 'rooms-changed', clientAction, data);\n\t\t});\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\tconst {username, name} = record.userId ? RocketChat.models.Users.findOneById(record.userId) : {};\n\t\t\treturn pub.added('room_files', _id, {...record, user:{username, name}});\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\tconst {username, name} = record.userId ? RocketChat.models.Users.findOneById(record.userId) : {};\n\t\t\treturn pub.changed('room_files', _id, {...record, user:{username, name}});\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","import s from 'underscore.string';\n\nfunction fetchRooms(userId, rooms) {\n\tif (!RocketChat.settings.get('Store_Last_Message') || RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\treturn rooms;\n\t}\n\n\treturn rooms.map(room => {\n\t\tdelete room.lastMessage;\n\t\treturn room;\n\t});\n}\n\nMeteor.methods({\n\tspotlight(text, usernames, type = {users: true, rooms: true}, rid) {\n\t\tconst searchForChannels = text[0] === '#';\n\t\tconst searchForDMs = text[0] === '@';\n\t\tif (searchForChannels) {\n\t\t\ttype.users = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tif (searchForDMs) {\n\t\t\ttype.rooms = false;\n\t\t\ttext = text.slice(1);\n\t\t}\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1,\n\t\t\t\tlastMessage: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t};\n\t\tconst userId = this.userId;\n\t\tif (userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch());\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst userOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tstatus: 1\n\t\t\t},\n\t\t\tsort: {}\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tuserOptions.sort.name = 1;\n\t\t} else {\n\t\t\tuserOptions.sort.username = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(userId, 'view-outside-room')) {\n\t\t\tif (type.users === true && RocketChat.authz.hasPermission(userId, 'view-d-room')) {\n\t\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t\t}\n\n\t\t\tif (type.rooms === true && RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tconst searchableRoomTypes = Object.entries(RocketChat.roomTypes.roomTypes)\n\t\t\t\t\t.filter((roomType)=>roomType[1].includeInRoomSearch())\n\t\t\t\t\t.map((roomType)=>roomType[0]);\n\n\t\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByUserIdAndTypes(userId, searchableRoomTypes, {fields: {rid: 1}}).fetch().map(s => s.rid);\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypesNotInIds(regex, searchableRoomTypes, roomIds, roomOptions).fetch());\n\t\t\t}\n\t\t} else if (type.users === true && rid) {\n\t\t\tconst subscriptions = RocketChat.models.Subscriptions.find({\n\t\t\t\trid, 'u.username': {\n\t\t\t\t\t$regex: regex,\n\t\t\t\t\t$nin: [...usernames, Meteor.user().username]\n\t\t\t\t}\n\t\t\t}, {limit: userOptions.limit}).fetch().map(({u}) => u._id);\n\t\t\tresult.users = RocketChat.models.Users.find({_id: {$in: subscriptions}}, {\n\t\t\t\tfields: userOptions.fields,\n\t\t\t\tsort: userOptions.sort\n\t\t\t}).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotifications: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1,\n\tmuteGroupMentions: 1,\n\tignored: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = { fields };\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('change', ({clientAction, id, data}) => {\n\tswitch (clientAction) {\n\t\tcase 'updated':\n\t\tcase 'inserted':\n\t\t\t// Override data cuz we do not publish all fields\n\t\t\tdata = RocketChat.models.Subscriptions.findOneById(id, { fields });\n\t\t\tbreak;\n\n\t\tcase 'removed':\n\t\t\tdata = RocketChat.models.Subscriptions.trashFindOneById(id, { fields: { u: 1 } });\n\t\t\tbreak;\n\t}\n\n\tRocketChat.Notifications.notifyUserInThisInstance(data.u._id, 'subscriptions-changed', clientAction, data);\n});\n","import _ from 'underscore';\n\nMeteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\tenableAutoAway: 1,\n\t\t\tidleTimeLimit: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\t'services.tokenpass': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1,\n\t\t\tbanners: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName, args) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId, args);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && !RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, this.userId, { fields: { _id: 1 } })) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, this.userId, { fields: { _id: 1 } }) != null;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages.on('change', function({ clientAction, id, data/*, oplog*/ }) {\n\t\tswitch (clientAction) {\n\t\t\tcase 'inserted':\n\t\t\tcase 'updated':\n\t\t\t\tconst message = data || RocketChat.models.Messages.findOne({ _id: id });\n\t\t\t\tpublishMessage(clientAction, message);\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport _ from 'underscore';\nimport {DDPCommon} from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tconst instance = Meteor.StreamerCentral.instances[streamName];\n\t\tif (!instance) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tif (instance.serverOnly) {\n\t\t\tconst scope = {};\n\t\t\tinstance.emitWithScope(eventName, scope, ...args);\n\t\t} else {\n\t\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t\t}\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get'\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map(address => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t}\n});\n","import '/imports/startup/server';\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n"]}