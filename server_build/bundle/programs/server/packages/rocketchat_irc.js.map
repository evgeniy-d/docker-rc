{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:irc/server/irc.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/methods/resetIrcConnection.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-settings.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/index.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/index.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onCreateRoom.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onCreateUser.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onJoinRoom.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onLeaveRoom.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onLogin.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onLogout.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/localHandlers/onSaveMessage.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/disconnected.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/index.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/joinedChannel.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/leftChannel.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/nickChanged.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/sentMessage.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/irc-bridge/peerHandlers/userRegistered.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/servers/index.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/servers/RFC2813/codes.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/servers/RFC2813/index.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/servers/RFC2813/localCommandHandlers.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/servers/RFC2813/parseMessage.js","meteor://ðŸ’»app/packages/rocketchat:irc/server/servers/RFC2813/peerCommandHandlers.js"],"names":["Bridge","module","watch","require","default","v","RocketChat","settings","get","config","server","protocol","host","port","name","description","passwords","local","peer","Meteor","ircBridge","startup","init","methods","resetIrcConnection","ircEnabled","stop","message","params","Error","t","addGroup","add","type","i18nLabel","i18nDescription","alert","values","key","actionText","Queue","servers","peerCommandHandlers","localCommandHandlers","constructor","loggedInUsers","Server","setupPeerHandlers","setupLocalHandlers","queue","queueTimeout","register","on","logQueue","runQueue","disconnect","log","console","onMessageReceived","from","command","parameters","enqueue","isEmpty","setTimeout","bind","item","dequeue","apply","cmd","identifier","args","callbacks","priority","LOW","sendCommand","emit","exportDefault","export","onCreateRoom","onJoinRoom","onLeaveRoom","onLogin","onLogout","onSaveMessage","onCreateUser","handleOnCreateRoom","user","room","usernames","username","models","Users","findOne","profile","irc","fromIRC","handleOnCreateUser","newUser","indexOf","_id","push","users","update","$set","rooms","Rooms","findWithUsername","fetch","forEach","handleOnJoinRoom","handleOnLeaveRoom","handleOnLogin","login","handleOnLogout","_","without","handleOnSaveMessage","to","toIdentification","subscriptions","Subscriptions","findByRoomId","subscription","u","userData","nick","error","msg","handleQUIT","status","removeUsernameFromAll","disconnected","joinedChannel","leftChannel","nickChanged","sentMessage","userRegistered","handleJoinedChannel","findOneByName","roomName","createdRoom","createRoom","rid","addUserToRoom","handleLeftChannel","removeUserFromRoom","handleNickChanged","newNick","handleSentMessage","getDirectRoom","source","target","sort","join","upsert","$setOnInsert","msgs","ts","Date","open","unread","recipientUser","recipientNick","sendMessage","handleUserRegistered","userToInsert","utcOffset","active","hostname","create","RFC2813","exports","net","util","EventEmitter","parseMessage","registerSteps","isRegistered","serverPrefix","receiveBuffer","Buffer","setupSocket","socket","Socket","setNoDelay","setEncoding","setKeepAlive","onReceiveFromPeer","onConnect","err","onReceiveFromLocal","connect","destroy","undefined","write","trailer","buffer","prefix","length","chunk","concat","lines","toString","split","pop","line","startsWith","parsedMessage","call","JSON","stringify","inherits","registerUser","joinChannel","replyFor","match","replace","rawCommand","commandType","middle","trailing","search","trimRight","PASS","SERVER","PING","NICK","JOIN","substring","PART","PRIVMSG","QUIT"],"mappings":"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","file":"/packages/rocketchat_irc.js","sourcesContent":["import Bridge from './irc-bridge';\n\nif (!!RocketChat.settings.get('IRC_Enabled') === true) {\n\t// Normalize the config values\n\tconst config = {\n\t\tserver: {\n\t\t\tprotocol: RocketChat.settings.get('IRC_Protocol'),\n\t\t\thost: RocketChat.settings.get('IRC_Host'),\n\t\t\tport: RocketChat.settings.get('IRC_Port'),\n\t\t\tname: RocketChat.settings.get('IRC_Name'),\n\t\t\tdescription: RocketChat.settings.get('IRC_Description')\n\t\t},\n\t\tpasswords: {\n\t\t\tlocal: RocketChat.settings.get('IRC_Local_Password'),\n\t\t\tpeer: RocketChat.settings.get('IRC_Peer_Password')\n\t\t}\n\t};\n\n\tMeteor.ircBridge = new Bridge(config);\n\n\tMeteor.startup(() => {\n\t\tMeteor.ircBridge.init();\n\t});\n}\n","import Bridge from '../irc-bridge';\n\nMeteor.methods({\n\tresetIrcConnection() {\n\t\tconst ircEnabled = (!!RocketChat.settings.get('IRC_Enabled')) === true;\n\n\t\tif (Meteor.ircBridge) {\n\t\t\tMeteor.ircBridge.stop();\n\t\t\tif (!ircEnabled) {\n\t\t\t\treturn {\n\t\t\t\t\tmessage: 'Connection_Closed',\n\t\t\t\t\tparams: []\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (ircEnabled) {\n\t\t\tif (Meteor.ircBridge) {\n\t\t\t\tMeteor.ircBridge.init();\n\t\t\t\treturn {\n\t\t\t\t\tmessage: 'Connection_Reset',\n\t\t\t\t\tparams: []\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Normalize the config values\n\t\t\tconst config = {\n\t\t\t\tserver: {\n\t\t\t\t\tprotocol: RocketChat.settings.get('IRC_Protocol'),\n\t\t\t\t\thost: RocketChat.settings.get('IRC_Host'),\n\t\t\t\t\tport: RocketChat.settings.get('IRC_Port'),\n\t\t\t\t\tname: RocketChat.settings.get('IRC_Name'),\n\t\t\t\t\tdescription: RocketChat.settings.get('IRC_Description')\n\t\t\t\t},\n\t\t\t\tpasswords: {\n\t\t\t\t\tlocal: RocketChat.settings.get('IRC_Local_Password'),\n\t\t\t\t\tpeer: RocketChat.settings.get('IRC_Peer_Password')\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tMeteor.ircBridge = new Bridge(config);\n\t\t\tMeteor.ircBridge.init();\n\n\t\t\treturn {\n\t\t\t\tmessage: 'Connection_Reset',\n\t\t\t\tparams: []\n\t\t\t};\n\t\t}\n\n\t\tthrow new Meteor.Error(t('IRC_Federation_Disabled'));\n\t}\n});\n","Meteor.startup(function() {\n\tRocketChat.settings.addGroup('IRC_Federation', function() {\n\t\tthis.add('IRC_Enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Enabled',\n\t\t\ti18nDescription: 'IRC_Enabled',\n\t\t\talert: 'IRC_Enabled_Alert'\n\t\t});\n\n\t\tthis.add('IRC_Protocol', 'RFC2813', {\n\t\t\ttype: 'select',\n\t\t\ti18nLabel: 'Protocol',\n\t\t\ti18nDescription: 'IRC_Protocol',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'RFC2813',\n\t\t\t\t\ti18nLabel: 'RFC2813'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tthis.add('IRC_Host', 'localhost', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Host',\n\t\t\ti18nDescription: 'IRC_Host'\n\t\t});\n\n\t\tthis.add('IRC_Port', 6667, {\n\t\t\ttype: 'int',\n\t\t\ti18nLabel: 'Port',\n\t\t\ti18nDescription: 'IRC_Port'\n\t\t});\n\n\t\tthis.add('IRC_Name', 'irc.rocket.chat', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Name',\n\t\t\ti18nDescription: 'IRC_Name'\n\t\t});\n\n\t\tthis.add('IRC_Description', 'Rocket.Chat IRC Bridge', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Description',\n\t\t\ti18nDescription: 'IRC_Description'\n\t\t});\n\n\t\tthis.add('IRC_Local_Password', 'password', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Local_Password',\n\t\t\ti18nDescription: 'IRC_Local_Password'\n\t\t});\n\n\t\tthis.add('IRC_Peer_Password', 'password', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Peer_Password',\n\t\t\ti18nDescription: 'IRC_Peer_Password'\n\t\t});\n\n\t\tthis.add('IRC_Reset_Connection', 'resetIrcConnection', {\n\t\t\ttype: 'action',\n\t\t\tactionText: 'Reset_Connection',\n\t\t\ti18nLabel: 'Reset_Connection'\n\t\t});\n\t});\n});\n","import Queue from 'queue-fifo';\nimport * as servers from '../servers';\nimport * as peerCommandHandlers from './peerHandlers';\nimport * as localCommandHandlers from './localHandlers';\n\nclass Bridge {\n\tconstructor(config) {\n\t\t// General\n\t\tthis.config = config;\n\n\t\t// Workaround for Rocket.Chat callbacks being called multiple times\n\t\tthis.loggedInUsers = [];\n\n\t\t// Server\n\t\tconst Server = servers[this.config.server.protocol];\n\n\t\tthis.server = new Server(this.config);\n\n\t\tthis.setupPeerHandlers();\n\t\tthis.setupLocalHandlers();\n\n\t\t// Command queue\n\t\tthis.queue = new Queue();\n\t\tthis.queueTimeout = 5;\n\t}\n\n\tinit() {\n\t\tthis.loggedInUsers = [];\n\t\tthis.server.register();\n\n\t\tthis.server.on('registered', () => {\n\t\t\tthis.logQueue('Starting...');\n\n\t\t\tthis.runQueue();\n\t\t});\n\t}\n\n\tstop() {\n\t\tthis.server.disconnect();\n\t}\n\n\t/**\n\t * Log helper\n\t */\n\tlog(message) {\n\t\tconsole.log(`[irc][bridge] ${ message }`);\n\t}\n\n\tlogQueue(message) {\n\t\tconsole.log(`[irc][bridge][queue] ${ message }`);\n\t}\n\n\t/**\n\t *\n\t *\n\t * Queue\n\t *\n\t *\n\t */\n\tonMessageReceived(from, command, ...parameters) {\n\t\tthis.queue.enqueue({ from, command, parameters });\n\t}\n\n\tasync runQueue() {\n\t\t// If it is empty, skip and keep the queue going\n\t\tif (this.queue.isEmpty()) {\n\t\t\treturn setTimeout(this.runQueue.bind(this), this.queueTimeout);\n\t\t}\n\n\t\t// Get the command\n\t\tconst item = this.queue.dequeue();\n\n\t\tthis.logQueue(`Processing \"${ item.command }\" command from \"${ item.from }\"`);\n\n\t\t// Handle the command accordingly\n\t\tswitch (item.from) {\n\t\t\tcase 'local':\n\t\t\t\tif (!localCommandHandlers[item.command]) {\n\t\t\t\t\tthrow new Error(`Could not find handler for local:${ item.command }`);\n\t\t\t\t}\n\n\t\t\t\tawait localCommandHandlers[item.command].apply(this, item.parameters);\n\t\t\t\tbreak;\n\t\t\tcase 'peer':\n\t\t\t\tif (!peerCommandHandlers[item.command]) {\n\t\t\t\t\tthrow new Error(`Could not find handler for peer:${ item.command }`);\n\t\t\t\t}\n\n\t\t\t\tawait peerCommandHandlers[item.command].apply(this, item.parameters);\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Keep the queue going\n\t\tsetTimeout(this.runQueue.bind(this), this.queueTimeout);\n\t}\n\n\t/**\n\t *\n\t *\n\t * Peer\n\t *\n\t *\n\t */\n\tsetupPeerHandlers() {\n\t\tthis.server.on('peerCommand', (cmd) => {\n\t\t\tthis.onMessageReceived('peer', cmd.identifier, cmd.args);\n\t\t});\n\t}\n\n\t/**\n\t *\n\t *\n\t * Local\n\t *\n\t *\n\t */\n\tsetupLocalHandlers() {\n\t\t// Auth\n\t\tRocketChat.callbacks.add('afterValidateLogin', this.onMessageReceived.bind(this, 'local', 'onLogin'), RocketChat.callbacks.priority.LOW, 'irc-on-login');\n\t\tRocketChat.callbacks.add('afterCreateUser', this.onMessageReceived.bind(this, 'local', 'onCreateUser'), RocketChat.callbacks.priority.LOW, 'irc-on-create-user');\n\t\t// Joining rooms or channels\n\t\tRocketChat.callbacks.add('afterCreateChannel', this.onMessageReceived.bind(this, 'local', 'onCreateRoom'), RocketChat.callbacks.priority.LOW, 'irc-on-create-channel');\n\t\tRocketChat.callbacks.add('afterCreateRoom', this.onMessageReceived.bind(this, 'local', 'onCreateRoom'), RocketChat.callbacks.priority.LOW, 'irc-on-create-room');\n\t\tRocketChat.callbacks.add('afterJoinRoom', this.onMessageReceived.bind(this, 'local', 'onJoinRoom'), RocketChat.callbacks.priority.LOW, 'irc-on-join-room');\n\t\t// Leaving rooms or channels\n\t\tRocketChat.callbacks.add('afterLeaveRoom', this.onMessageReceived.bind(this, 'local', 'onLeaveRoom'), RocketChat.callbacks.priority.LOW, 'irc-on-leave-room');\n\t\t// Chatting\n\t\tRocketChat.callbacks.add('afterSaveMessage', this.onMessageReceived.bind(this, 'local', 'onSaveMessage'), RocketChat.callbacks.priority.LOW, 'irc-on-save-message');\n\t\t// Leaving\n\t\tRocketChat.callbacks.add('afterLogoutCleanUp', this.onMessageReceived.bind(this, 'local', 'onLogout'), RocketChat.callbacks.priority.LOW, 'irc-on-logout');\n\t}\n\n\tsendCommand(command, parameters) {\n\t\tthis.server.emit('onReceiveFromLocal', command, parameters);\n\t}\n}\n\nexport default Bridge;\n","import onCreateRoom from './onCreateRoom';\nimport onJoinRoom from './onJoinRoom';\nimport onLeaveRoom from './onLeaveRoom';\nimport onLogin from './onLogin';\nimport onLogout from './onLogout';\nimport onSaveMessage from './onSaveMessage';\nimport onCreateUser from './onCreateUser';\n\nexport { onCreateRoom, onJoinRoom, onLeaveRoom, onLogin, onLogout, onSaveMessage, onCreateUser };\n","export default function handleOnCreateRoom(user, room) {\n\tif (!room.usernames) {\n\t\treturn this.log(`Room ${ room.name } does not have a valid list of usernames`);\n\t}\n\n\tfor (const username of room.usernames) {\n\t\tconst user = RocketChat.models.Users.findOne({ username });\n\n\t\tif (user.profile.irc.fromIRC) {\n\t\t\tthis.sendCommand('joinChannel', { room, user });\n\t\t} else {\n\t\t\tthis.sendCommand('joinedChannel', { room, user });\n\t\t}\n\t}\n}\n","export default function handleOnCreateUser(newUser) {\n\tif (!newUser) {\n\t\treturn this.log('Invalid handleOnCreateUser call');\n\t}\n\tif (!newUser.username) {\n\t\treturn this.log('Invalid handleOnCreateUser call (Missing username)');\n\t}\n\tif (this.loggedInUsers.indexOf(newUser._id) !== -1) {\n\t\treturn this.log('Duplicate handleOnCreateUser call');\n\t}\n\n\tthis.loggedInUsers.push(newUser._id);\n\n\tMeteor.users.update({ _id: newUser._id }, {\n\t\t$set: {\n\t\t\t'profile.irc.fromIRC': false,\n\t\t\t'profile.irc.username': `${ newUser.username }-rkt`,\n\t\t\t'profile.irc.nick': `${ newUser.username }-rkt`,\n\t\t\t'profile.irc.hostname': 'rocket.chat'\n\t\t}\n\t});\n\n\tconst user = RocketChat.models.Users.findOne({\n\t\t_id: newUser._id\n\t});\n\n\tthis.sendCommand('registerUser', user);\n\n\tconst rooms = RocketChat.models.Rooms.findWithUsername(user.username).fetch();\n\n\trooms.forEach(room => this.sendCommand('joinedChannel', { room, user }));\n}\n","export default function handleOnJoinRoom(user, room) {\n\tthis.sendCommand('joinedChannel', { room, user });\n}\n","export default function handleOnLeaveRoom(user, room) {\n\tthis.sendCommand('leftChannel', { room, user });\n}\n","export default function handleOnLogin(login) {\n\tif (login.user === null) {\n\t\treturn this.log('Invalid handleOnLogin call');\n\t}\n\tif (!login.user.username) {\n\t\treturn this.log('Invalid handleOnLogin call (Missing username)');\n\t}\n\tif (this.loggedInUsers.indexOf(login.user._id) !== -1) {\n\t\treturn this.log('Duplicate handleOnLogin call');\n\t}\n\n\tthis.loggedInUsers.push(login.user._id);\n\n\tMeteor.users.update({ _id: login.user._id }, {\n\t\t$set: {\n\t\t\t'profile.irc.fromIRC': false,\n\t\t\t'profile.irc.username': `${ login.user.username }-rkt`,\n\t\t\t'profile.irc.nick': `${ login.user.username }-rkt`,\n\t\t\t'profile.irc.hostname': 'rocket.chat'\n\t\t}\n\t});\n\n\tconst user = RocketChat.models.Users.findOne({\n\t\t_id: login.user._id\n\t});\n\n\tthis.sendCommand('registerUser', user);\n\n\tconst rooms = RocketChat.models.Rooms.findWithUsername(user.username).fetch();\n\n\trooms.forEach(room => this.sendCommand('joinedChannel', { room, user }));\n}\n","import _ from 'underscore';\n\nexport default function handleOnLogout(user) {\n\tthis.loggedInUsers = _.without(this.loggedInUsers, user._id);\n\n\tthis.sendCommand('disconnected', { user });\n}\n","export default function handleOnSaveMessage(message, to) {\n\tlet toIdentification = '';\n\t// Direct message\n\tif (to.t === 'd') {\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomId(to._id);\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tif (subscription.u.username !== to.username) {\n\t\t\t\tconst userData = RocketChat.models.Users.findOne({ username: subscription.u.username });\n\t\t\t\tif (userData) {\n\t\t\t\t\tif (userData.profile && userData.profile.irc && userData.profile.irc.nick) {\n\t\t\t\t\t\ttoIdentification = userData.profile.irc.nick;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoIdentification = userData.username;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttoIdentification = subscription.u.username;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!toIdentification) {\n\t\t\tconsole.error('[irc][server] Target user not found');\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\ttoIdentification = `#${ to.name }`;\n\t}\n\n\tconst user = RocketChat.models.Users.findOne({ _id: message.u._id });\n\n\tthis.sendCommand('sentMessage', { to: toIdentification, user, message: message.msg });\n}\n","export default function handleQUIT(args) {\n\tconst user = RocketChat.models.Users.findOne({\n\t\t'profile.irc.nick': args.nick\n\t});\n\n\tMeteor.users.update({ _id: user._id }, {\n\t\t$set: {\n\t\t\tstatus: 'offline'\n\t\t}\n\t});\n\n\tRocketChat.models.Rooms.removeUsernameFromAll(user.username);\n}\n","import disconnected from './disconnected';\nimport joinedChannel from './joinedChannel';\nimport leftChannel from './leftChannel';\nimport nickChanged from './nickChanged';\nimport sentMessage from './sentMessage';\nimport userRegistered from './userRegistered';\n\nexport { disconnected, joinedChannel, leftChannel, nickChanged, sentMessage, userRegistered };\n","export default function handleJoinedChannel(args) {\n\tconst user = RocketChat.models.Users.findOne({\n\t\t'profile.irc.nick': args.nick\n\t});\n\n\tif (!user) {\n\t\tthrow new Error(`Could not find a user with nick ${ args.nick }`);\n\t}\n\n\tlet room = RocketChat.models.Rooms.findOneByName(args.roomName);\n\n\tif (!room) {\n\t\tconst createdRoom = RocketChat.createRoom('c', args.roomName, user.username, [ /* usernames of the participants here */]);\n\t\troom = RocketChat.models.Rooms.findOne({ _id: createdRoom.rid });\n\n\t\tthis.log(`${ user.username } created room ${ args.roomName }`);\n\t} else {\n\t\tRocketChat.addUserToRoom(room._id, user);\n\n\t\tthis.log(`${ user.username } joined room ${ room.name }`);\n\t}\n}\n","export default function handleLeftChannel(args) {\n\tconst user = RocketChat.models.Users.findOne({\n\t\t'profile.irc.nick': args.nick\n\t});\n\n\tif (!user) {\n\t\tthrow new Error(`Could not find a user with nick ${ args.nick }`);\n\t}\n\n\tconst room = RocketChat.models.Rooms.findOneByName(args.roomName);\n\n\tif (!room) {\n\t\tthrow new Error(`Could not find a room with name ${ args.roomName }`);\n\t}\n\n\tthis.log(`${ user.username } left room ${ room.name }`);\n\tRocketChat.removeUserFromRoom(room._id, user);\n}\n","export default function handleNickChanged(args) {\n\tconst user = RocketChat.models.Users.findOne({\n\t\t'profile.irc.nick': args.nick\n\t});\n\n\tif (!user) {\n\t\tthrow new Error(`Could not find an user with nick ${ args.nick }`);\n\t}\n\n\tthis.log(`${ user.username } changed nick: ${ args.nick } -> ${ args.newNick }`);\n\n\t// Update on the database\n\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t$set: {\n\t\t\tname: args.newNick,\n\t\t\t'profile.irc.nick': args.newNick\n\t\t}\n\t});\n}\n","/*\n *\n * Get direct chat room helper\n *\n *\n */\nconst getDirectRoom = (source, target) => {\n\tconst rid = [ source._id, target._id ].sort().join('');\n\n\tRocketChat.models.Rooms.upsert({ _id: rid }, {\n\t\t$set: {\n\t\t\tusernames: [source.username, target.username]\n\t\t},\n\t\t$setOnInsert: {\n\t\t\tt: 'd',\n\t\t\tmsgs: 0,\n\t\t\tts: new Date()\n\t\t}\n\t});\n\n\tRocketChat.models.Subscriptions.upsert({rid, 'u._id': target._id}, {\n\t\t$setOnInsert: {\n\t\t\tname: source.username,\n\t\t\tt: 'd',\n\t\t\topen: false,\n\t\t\talert: false,\n\t\t\tunread: 0,\n\t\t\tu: {\n\t\t\t\t_id: target._id,\n\t\t\t\tusername: target.username\n\t\t\t}\n\t\t}\n\t});\n\n\tRocketChat.models.Subscriptions.upsert({rid, 'u._id': source._id}, {\n\t\t$setOnInsert: {\n\t\t\tname: target.username,\n\t\t\tt: 'd',\n\t\t\topen: false,\n\t\t\talert: false,\n\t\t\tunread: 0,\n\t\t\tu: {\n\t\t\t\t_id: source._id,\n\t\t\t\tusername: source.username\n\t\t\t}\n\t\t}\n\t});\n\n\treturn {\n\t\t_id: rid,\n\t\tt: 'd'\n\t};\n};\n\nexport default function handleSentMessage(args) {\n\tconst user = RocketChat.models.Users.findOne({\n\t\t'profile.irc.nick': args.nick\n\t});\n\n\tif (!user) {\n\t\tthrow new Error(`Could not find a user with nick ${ args.nick }`);\n\t}\n\n\tlet room;\n\n\tif (args.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(args.roomName);\n\t} else {\n\t\tconst recipientUser = RocketChat.models.Users.findOne({\n\t\t\t'profile.irc.nick': args.recipientNick\n\t\t});\n\n\t\troom = getDirectRoom(user, recipientUser);\n\t}\n\n\tconst message = {\n\t\tmsg: args.message,\n\t\tts: new Date()\n\t};\n\n\tRocketChat.sendMessage(user, message, room);\n}\n","export default async function handleUserRegistered(args) {\n\t// Check if there is an user with the given username\n\tlet user = RocketChat.models.Users.findOne({\n\t\t'profile.irc.username': args.username\n\t});\n\n\t// If there is no user, create one...\n\tif (!user) {\n\t\tthis.log(`Registering ${ args.username } with nick: ${ args.nick }`);\n\n\t\tconst userToInsert = {\n\t\t\tname: args.nick,\n\t\t\tusername: `${ args.username }-irc`,\n\t\t\tstatus: 'online',\n\t\t\tutcOffset: 0,\n\t\t\tactive: true,\n\t\t\ttype: 'user',\n\t\t\tprofile: {\n\t\t\t\tirc: {\n\t\t\t\t\tfromIRC: true,\n\t\t\t\t\tnick: args.nick,\n\t\t\t\t\tusername: args.username,\n\t\t\t\t\thostname: args.hostname\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tuser = RocketChat.models.Users.create(userToInsert);\n\t} else {\n\t\t// ...otherwise, log the user in and update the information\n\t\tthis.log(`Logging in ${ args.username } with nick: ${ args.nick }`);\n\n\t\tMeteor.users.update({ _id: user._id }, {\n\t\t\t$set: {\n\t\t\t\tstatus: 'online',\n\t\t\t\t'profile.irc.nick': args.nick,\n\t\t\t\t'profile.irc.username': args.username,\n\t\t\t\t'profile.irc.hostname': args.hostname\n\t\t\t}\n\t\t});\n\t}\n}\n","import RFC2813 from './RFC2813';\n\nexport { RFC2813 };\n","/**\n * This file is part of https://github.com/martynsmith/node-irc\n * by https://github.com/martynsmith\n */\n\nmodule.exports = {\n\t'001': {\n\t\tname: 'rpl_welcome',\n\t\ttype: 'reply'\n\t},\n\t'002': {\n\t\tname: 'rpl_yourhost',\n\t\ttype: 'reply'\n\t},\n\t'003': {\n\t\tname: 'rpl_created',\n\t\ttype: 'reply'\n\t},\n\t'004': {\n\t\tname: 'rpl_myinfo',\n\t\ttype: 'reply'\n\t},\n\t'005': {\n\t\tname: 'rpl_isupport',\n\t\ttype: 'reply'\n\t},\n\t200: {\n\t\tname: 'rpl_tracelink',\n\t\ttype: 'reply'\n\t},\n\t201: {\n\t\tname: 'rpl_traceconnecting',\n\t\ttype: 'reply'\n\t},\n\t202: {\n\t\tname: 'rpl_tracehandshake',\n\t\ttype: 'reply'\n\t},\n\t203: {\n\t\tname: 'rpl_traceunknown',\n\t\ttype: 'reply'\n\t},\n\t204: {\n\t\tname: 'rpl_traceoperator',\n\t\ttype: 'reply'\n\t},\n\t205: {\n\t\tname: 'rpl_traceuser',\n\t\ttype: 'reply'\n\t},\n\t206: {\n\t\tname: 'rpl_traceserver',\n\t\ttype: 'reply'\n\t},\n\t208: {\n\t\tname: 'rpl_tracenewtype',\n\t\ttype: 'reply'\n\t},\n\t211: {\n\t\tname: 'rpl_statslinkinfo',\n\t\ttype: 'reply'\n\t},\n\t212: {\n\t\tname: 'rpl_statscommands',\n\t\ttype: 'reply'\n\t},\n\t213: {\n\t\tname: 'rpl_statscline',\n\t\ttype: 'reply'\n\t},\n\t214: {\n\t\tname: 'rpl_statsnline',\n\t\ttype: 'reply'\n\t},\n\t215: {\n\t\tname: 'rpl_statsiline',\n\t\ttype: 'reply'\n\t},\n\t216: {\n\t\tname: 'rpl_statskline',\n\t\ttype: 'reply'\n\t},\n\t218: {\n\t\tname: 'rpl_statsyline',\n\t\ttype: 'reply'\n\t},\n\t219: {\n\t\tname: 'rpl_endofstats',\n\t\ttype: 'reply'\n\t},\n\t221: {\n\t\tname: 'rpl_umodeis',\n\t\ttype: 'reply'\n\t},\n\t241: {\n\t\tname: 'rpl_statslline',\n\t\ttype: 'reply'\n\t},\n\t242: {\n\t\tname: 'rpl_statsuptime',\n\t\ttype: 'reply'\n\t},\n\t243: {\n\t\tname: 'rpl_statsoline',\n\t\ttype: 'reply'\n\t},\n\t244: {\n\t\tname: 'rpl_statshline',\n\t\ttype: 'reply'\n\t},\n\t250: {\n\t\tname: 'rpl_statsconn',\n\t\ttype: 'reply'\n\t},\n\t251: {\n\t\tname: 'rpl_luserclient',\n\t\ttype: 'reply'\n\t},\n\t252: {\n\t\tname: 'rpl_luserop',\n\t\ttype: 'reply'\n\t},\n\t253: {\n\t\tname: 'rpl_luserunknown',\n\t\ttype: 'reply'\n\t},\n\t254: {\n\t\tname: 'rpl_luserchannels',\n\t\ttype: 'reply'\n\t},\n\t255: {\n\t\tname: 'rpl_luserme',\n\t\ttype: 'reply'\n\t},\n\t256: {\n\t\tname: 'rpl_adminme',\n\t\ttype: 'reply'\n\t},\n\t257: {\n\t\tname: 'rpl_adminloc1',\n\t\ttype: 'reply'\n\t},\n\t258: {\n\t\tname: 'rpl_adminloc2',\n\t\ttype: 'reply'\n\t},\n\t259: {\n\t\tname: 'rpl_adminemail',\n\t\ttype: 'reply'\n\t},\n\t261: {\n\t\tname: 'rpl_tracelog',\n\t\ttype: 'reply'\n\t},\n\t265: {\n\t\tname: 'rpl_localusers',\n\t\ttype: 'reply'\n\t},\n\t266: {\n\t\tname: 'rpl_globalusers',\n\t\ttype: 'reply'\n\t},\n\t300: {\n\t\tname: 'rpl_none',\n\t\ttype: 'reply'\n\t},\n\t301: {\n\t\tname: 'rpl_away',\n\t\ttype: 'reply'\n\t},\n\t302: {\n\t\tname: 'rpl_userhost',\n\t\ttype: 'reply'\n\t},\n\t303: {\n\t\tname: 'rpl_ison',\n\t\ttype: 'reply'\n\t},\n\t305: {\n\t\tname: 'rpl_unaway',\n\t\ttype: 'reply'\n\t},\n\t306: {\n\t\tname: 'rpl_nowaway',\n\t\ttype: 'reply'\n\t},\n\t311: {\n\t\tname: 'rpl_whoisuser',\n\t\ttype: 'reply'\n\t},\n\t312: {\n\t\tname: 'rpl_whoisserver',\n\t\ttype: 'reply'\n\t},\n\t313: {\n\t\tname: 'rpl_whoisoperator',\n\t\ttype: 'reply'\n\t},\n\t314: {\n\t\tname: 'rpl_whowasuser',\n\t\ttype: 'reply'\n\t},\n\t315: {\n\t\tname: 'rpl_endofwho',\n\t\ttype: 'reply'\n\t},\n\t317: {\n\t\tname: 'rpl_whoisidle',\n\t\ttype: 'reply'\n\t},\n\t318: {\n\t\tname: 'rpl_endofwhois',\n\t\ttype: 'reply'\n\t},\n\t319: {\n\t\tname: 'rpl_whoischannels',\n\t\ttype: 'reply'\n\t},\n\t321: {\n\t\tname: 'rpl_liststart',\n\t\ttype: 'reply'\n\t},\n\t322: {\n\t\tname: 'rpl_list',\n\t\ttype: 'reply'\n\t},\n\t323: {\n\t\tname: 'rpl_listend',\n\t\ttype: 'reply'\n\t},\n\t324: {\n\t\tname: 'rpl_channelmodeis',\n\t\ttype: 'reply'\n\t},\n\t329: {\n\t\tname: 'rpl_creationtime',\n\t\ttype: 'reply'\n\t},\n\t331: {\n\t\tname: 'rpl_notopic',\n\t\ttype: 'reply'\n\t},\n\t332: {\n\t\tname: 'rpl_topic',\n\t\ttype: 'reply'\n\t},\n\t333: {\n\t\tname: 'rpl_topicwhotime',\n\t\ttype: 'reply'\n\t},\n\t341: {\n\t\tname: 'rpl_inviting',\n\t\ttype: 'reply'\n\t},\n\t342: {\n\t\tname: 'rpl_summoning',\n\t\ttype: 'reply'\n\t},\n\t351: {\n\t\tname: 'rpl_version',\n\t\ttype: 'reply'\n\t},\n\t352: {\n\t\tname: 'rpl_whoreply',\n\t\ttype: 'reply'\n\t},\n\t353: {\n\t\tname: 'rpl_namreply',\n\t\ttype: 'reply'\n\t},\n\t364: {\n\t\tname: 'rpl_links',\n\t\ttype: 'reply'\n\t},\n\t365: {\n\t\tname: 'rpl_endoflinks',\n\t\ttype: 'reply'\n\t},\n\t366: {\n\t\tname: 'rpl_endofnames',\n\t\ttype: 'reply'\n\t},\n\t367: {\n\t\tname: 'rpl_banlist',\n\t\ttype: 'reply'\n\t},\n\t368: {\n\t\tname: 'rpl_endofbanlist',\n\t\ttype: 'reply'\n\t},\n\t369: {\n\t\tname: 'rpl_endofwhowas',\n\t\ttype: 'reply'\n\t},\n\t371: {\n\t\tname: 'rpl_info',\n\t\ttype: 'reply'\n\t},\n\t372: {\n\t\tname: 'rpl_motd',\n\t\ttype: 'reply'\n\t},\n\t374: {\n\t\tname: 'rpl_endofinfo',\n\t\ttype: 'reply'\n\t},\n\t375: {\n\t\tname: 'rpl_motdstart',\n\t\ttype: 'reply'\n\t},\n\t376: {\n\t\tname: 'rpl_endofmotd',\n\t\ttype: 'reply'\n\t},\n\t381: {\n\t\tname: 'rpl_youreoper',\n\t\ttype: 'reply'\n\t},\n\t382: {\n\t\tname: 'rpl_rehashing',\n\t\ttype: 'reply'\n\t},\n\t391: {\n\t\tname: 'rpl_time',\n\t\ttype: 'reply'\n\t},\n\t392: {\n\t\tname: 'rpl_usersstart',\n\t\ttype: 'reply'\n\t},\n\t393: {\n\t\tname: 'rpl_users',\n\t\ttype: 'reply'\n\t},\n\t394: {\n\t\tname: 'rpl_endofusers',\n\t\ttype: 'reply'\n\t},\n\t395: {\n\t\tname: 'rpl_nousers',\n\t\ttype: 'reply'\n\t},\n\t401: {\n\t\tname: 'err_nosuchnick',\n\t\ttype: 'error'\n\t},\n\t402: {\n\t\tname: 'err_nosuchserver',\n\t\ttype: 'error'\n\t},\n\t403: {\n\t\tname: 'err_nosuchchannel',\n\t\ttype: 'error'\n\t},\n\t404: {\n\t\tname: 'err_cannotsendtochan',\n\t\ttype: 'error'\n\t},\n\t405: {\n\t\tname: 'err_toomanychannels',\n\t\ttype: 'error'\n\t},\n\t406: {\n\t\tname: 'err_wasnosuchnick',\n\t\ttype: 'error'\n\t},\n\t407: {\n\t\tname: 'err_toomanytargets',\n\t\ttype: 'error'\n\t},\n\t409: {\n\t\tname: 'err_noorigin',\n\t\ttype: 'error'\n\t},\n\t411: {\n\t\tname: 'err_norecipient',\n\t\ttype: 'error'\n\t},\n\t412: {\n\t\tname: 'err_notexttosend',\n\t\ttype: 'error'\n\t},\n\t413: {\n\t\tname: 'err_notoplevel',\n\t\ttype: 'error'\n\t},\n\t414: {\n\t\tname: 'err_wildtoplevel',\n\t\ttype: 'error'\n\t},\n\t421: {\n\t\tname: 'err_unknowncommand',\n\t\ttype: 'error'\n\t},\n\t422: {\n\t\tname: 'err_nomotd',\n\t\ttype: 'error'\n\t},\n\t423: {\n\t\tname: 'err_noadmininfo',\n\t\ttype: 'error'\n\t},\n\t424: {\n\t\tname: 'err_fileerror',\n\t\ttype: 'error'\n\t},\n\t431: {\n\t\tname: 'err_nonicknamegiven',\n\t\ttype: 'error'\n\t},\n\t432: {\n\t\tname: 'err_erroneusnickname',\n\t\ttype: 'error'\n\t},\n\t433: {\n\t\tname: 'err_nicknameinuse',\n\t\ttype: 'error'\n\t},\n\t436: {\n\t\tname: 'err_nickcollision',\n\t\ttype: 'error'\n\t},\n\t441: {\n\t\tname: 'err_usernotinchannel',\n\t\ttype: 'error'\n\t},\n\t442: {\n\t\tname: 'err_notonchannel',\n\t\ttype: 'error'\n\t},\n\t443: {\n\t\tname: 'err_useronchannel',\n\t\ttype: 'error'\n\t},\n\t444: {\n\t\tname: 'err_nologin',\n\t\ttype: 'error'\n\t},\n\t445: {\n\t\tname: 'err_summondisabled',\n\t\ttype: 'error'\n\t},\n\t446: {\n\t\tname: 'err_usersdisabled',\n\t\ttype: 'error'\n\t},\n\t451: {\n\t\tname: 'err_notregistered',\n\t\ttype: 'error'\n\t},\n\t461: {\n\t\tname: 'err_needmoreparams',\n\t\ttype: 'error'\n\t},\n\t462: {\n\t\tname: 'err_alreadyregistred',\n\t\ttype: 'error'\n\t},\n\t463: {\n\t\tname: 'err_nopermforhost',\n\t\ttype: 'error'\n\t},\n\t464: {\n\t\tname: 'err_passwdmismatch',\n\t\ttype: 'error'\n\t},\n\t465: {\n\t\tname: 'err_yourebannedcreep',\n\t\ttype: 'error'\n\t},\n\t467: {\n\t\tname: 'err_keyset',\n\t\ttype: 'error'\n\t},\n\t471: {\n\t\tname: 'err_channelisfull',\n\t\ttype: 'error'\n\t},\n\t472: {\n\t\tname: 'err_unknownmode',\n\t\ttype: 'error'\n\t},\n\t473: {\n\t\tname: 'err_inviteonlychan',\n\t\ttype: 'error'\n\t},\n\t474: {\n\t\tname: 'err_bannedfromchan',\n\t\ttype: 'error'\n\t},\n\t475: {\n\t\tname: 'err_badchannelkey',\n\t\ttype: 'error'\n\t},\n\t481: {\n\t\tname: 'err_noprivileges',\n\t\ttype: 'error'\n\t},\n\t482: {\n\t\tname: 'err_chanoprivsneeded',\n\t\ttype: 'error'\n\t},\n\t483: {\n\t\tname: 'err_cantkillserver',\n\t\ttype: 'error'\n\t},\n\t491: {\n\t\tname: 'err_nooperhost',\n\t\ttype: 'error'\n\t},\n\t501: {\n\t\tname: 'err_umodeunknownflag',\n\t\ttype: 'error'\n\t},\n\t502: {\n\t\tname: 'err_usersdontmatch',\n\t\ttype: 'error'\n\t}\n};\n","import net from 'net';\nimport util from 'util';\nimport { EventEmitter } from 'events';\n\nimport parseMessage from './parseMessage';\n\nimport peerCommandHandlers from './peerCommandHandlers';\nimport localCommandHandlers from './localCommandHandlers';\n\nclass RFC2813 {\n\tconstructor(config) {\n\t\tthis.config = config;\n\n\t\t// Hold registered state\n\t\tthis.registerSteps = [];\n\t\tthis.isRegistered = false;\n\n\t\t// Hold peer server information\n\t\tthis.serverPrefix = null;\n\n\t\t// Hold the buffer while receiving\n\t\tthis.receiveBuffer = new Buffer('');\n\n\t}\n\n\t/**\n\t * Setup socket\n\t */\n\tsetupSocket() {\n\t\t// Setup socket\n\t\tthis.socket = new net.Socket();\n\t\tthis.socket.setNoDelay();\n\t\tthis.socket.setEncoding('utf-8');\n\t\tthis.socket.setKeepAlive(true);\n\t\tthis.socket.setTimeout(90000);\n\n\t\tthis.socket.on('data', this.onReceiveFromPeer.bind(this));\n\n\t\tthis.socket.on('connect', this.onConnect.bind(this));\n\t\tthis.socket.on('error', (err) => console.log('[irc][server][err]', err));\n\t\tthis.socket.on('timeout', () => this.log('Timeout'));\n\t\tthis.socket.on('close', () => this.log('Connection Closed'));\n\t\t// Setup local\n\t\tthis.on('onReceiveFromLocal', this.onReceiveFromLocal.bind(this));\n\t}\n\n\t/**\n\t * Log helper\n\t */\n\tlog(message) {\n\t\tconsole.log(`[irc][server] ${ message }`);\n\t}\n\n\t/**\n\t * Connect\n\t */\n\tregister() {\n\t\tthis.log(`Connecting to @${ this.config.server.host }:${ this.config.server.port }`);\n\n\t\tif (!this.socket) {\n\t\t\tthis.setupSocket();\n\t\t}\n\n\t\tthis.socket.connect(this.config.server.port, this.config.server.host);\n\t}\n\n\t/**\n\t * Disconnect\n\t */\n\tdisconnect() {\n\t\tthis.log('Disconnecting from server.');\n\n\t\tif (this.socket) {\n\t\t\tthis.socket.destroy();\n\t\t\tthis.socket = undefined;\n\t\t}\n\t\tthis.isRegistered = false;\n\t\tthis.registerSteps = [];\n\t}\n\n\t/**\n\t * Setup the server connection\n\t */\n\tonConnect() {\n\t\tthis.log('Connected! Registering as server...');\n\n\t\tthis.write({\n\t\t\tcommand: 'PASS',\n\t\t\tparameters: [ this.config.passwords.local, '0210', 'ngircd' ]\n\t\t});\n\n\t\tthis.write({\n\t\t\tcommand: 'SERVER', parameters: [ this.config.server.name ],\n\t\t\ttrailer: this.config.server.description\n\t\t});\n\t}\n\n\t/**\n\t * Sends a command message through the socket\n\t */\n\twrite(command) {\n\t\tlet buffer = command.prefix ? `:${ command.prefix } ` : '';\n\t\tbuffer += command.command;\n\n\t\tif (command.parameters && command.parameters.length > 0) {\n\t\t\tbuffer += ` ${ command.parameters.join(' ') }`;\n\t\t}\n\n\t\tif (command.trailer) {\n\t\t\tbuffer += ` :${ command.trailer }`;\n\t\t}\n\n\t\tthis.log(`Sending Command: ${ buffer }`);\n\n\t\treturn this.socket.write(`${ buffer }\\r\\n`);\n\t}\n\n\t/**\n\t *\n\t *\n\t * Peer message handling\n\t *\n\t *\n\t */\n\tonReceiveFromPeer(chunk) {\n\t\tif (typeof (chunk) === 'string') {\n\t\t\tthis.receiveBuffer += chunk;\n\t\t} else {\n\t\t\tthis.receiveBuffer = Buffer.concat([this.receiveBuffer, chunk]);\n\t\t}\n\n\t\tconst lines = this.receiveBuffer.toString().split(/\\r\\n|\\r|\\n|\\u0007/); // eslint-disable-line no-control-regex\n\n\t\t// If the buffer does not end with \\r\\n, more chunks are coming\n\t\tif (lines.pop()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Reset the buffer\n\t\tthis.receiveBuffer = new Buffer('');\n\n\t\tlines.forEach((line) => {\n\t\t\tif (line.length && !line.startsWith('\\a')) {\n\t\t\t\tconst parsedMessage = parseMessage(line);\n\n\t\t\t\tif (peerCommandHandlers[parsedMessage.command]) {\n\t\t\t\t\tthis.log(`Handling peer message: ${ line }`);\n\n\t\t\t\t\tconst command = peerCommandHandlers[parsedMessage.command].call(this, parsedMessage);\n\n\t\t\t\t\tif (command) {\n\t\t\t\t\t\tthis.log(`Emitting peer command to local: ${ JSON.stringify(command) }`);\n\t\t\t\t\t\tthis.emit('peerCommand', command);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.log(`Unhandled peer message: ${ JSON.stringify(parsedMessage) }`);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t *\n\t *\n\t * Local message handling\n\t *\n\t *\n\t */\n\tonReceiveFromLocal(command, parameters) {\n\t\tif (localCommandHandlers[command]) {\n\t\t\tthis.log(`Handling local command: ${ command }`);\n\n\t\t\tlocalCommandHandlers[command].call(this, parameters);\n\n\t\t} else {\n\t\t\tthis.log(`Unhandled local command: ${ JSON.stringify(command) }`);\n\t\t}\n\t}\n}\n\nutil.inherits(RFC2813, EventEmitter);\n\nexport default RFC2813;\n","function registerUser(parameters) {\n\tconst { name, profile: { irc: { nick, username } } } = parameters;\n\n\tthis.write({\n\t\tprefix: this.config.server.name,\n\t\tcommand: 'NICK', parameters: [ nick, 1, username, 'irc.rocket.chat', 1, '+i' ],\n\t\ttrailer: name\n\t});\n}\n\nfunction joinChannel(parameters) {\n\tconst {\n\t\troom: { name: roomName },\n\t\tuser: { profile: { irc: { nick } } }\n\t} = parameters;\n\n\tthis.write({\n\t\tprefix: this.config.server.name,\n\t\tcommand: 'NJOIN', parameters: [ `#${ roomName }` ],\n\t\ttrailer: nick\n\t});\n}\n\nfunction joinedChannel(parameters) {\n\tconst {\n\t\troom: { name: roomName },\n\t\tuser: { profile: { irc: { nick } } }\n\t} = parameters;\n\n\tthis.write({\n\t\tprefix: nick,\n\t\tcommand: 'JOIN', parameters: [ `#${ roomName }` ]\n\t});\n}\n\nfunction leftChannel(parameters) {\n\tconst {\n\t\troom: { name: roomName },\n\t\tuser: { profile: { irc: { nick } } }\n\t} = parameters;\n\n\tthis.write({\n\t\tprefix: nick,\n\t\tcommand: 'PART', parameters: [ `#${ roomName }` ]\n\t});\n}\n\nfunction sentMessage(parameters) {\n\tconst {\n\t\tuser: { profile: { irc: { nick } } },\n\t\tto,\n\t\tmessage\n\t} = parameters;\n\n\tthis.write({\n\t\tprefix: nick,\n\t\tcommand: 'PRIVMSG', parameters: [ to ],\n\t\ttrailer: message\n\t});\n}\n\nfunction disconnected(parameters) {\n\tconst {\n\t\tuser: { profile: { irc: { nick } } }\n\t} = parameters;\n\n\tthis.write({\n\t\tprefix: nick,\n\t\tcommand: 'QUIT'\n\t});\n}\n\nexport default { registerUser, joinChannel, joinedChannel, leftChannel, sentMessage, disconnected };\n","/**\n * This file is part of https://github.com/martynsmith/node-irc\n * by https://github.com/martynsmith\n */\n\nconst replyFor = require('./codes');\n\n/**\n * parseMessage(line, stripColors)\n *\n * takes a raw \"line\" from the IRC server and turns it into an object with\n * useful keys\n * @param {String} line Raw message from IRC server.\n * @return {Object} A parsed message object.\n */\nmodule.exports = function parseMessage(line) {\n\tconst message = {};\n\tlet match;\n\n\t// Parse prefix\n\tmatch = line.match(/^:([^ ]+) +/);\n\tif (match) {\n\t\tmessage.prefix = match[1];\n\t\tline = line.replace(/^:[^ ]+ +/, '');\n\t\tmatch = message.prefix.match(/^([_a-zA-Z0-9\\~\\[\\]\\\\`^{}|-]*)(!([^@]+)@(.*))?$/);\n\t\tif (match) {\n\t\t\tmessage.nick = match[1];\n\t\t\tmessage.user = match[3];\n\t\t\tmessage.host = match[4];\n\t\t} else {\n\t\t\tmessage.server = message.prefix;\n\t\t}\n\t}\n\n\t// Parse command\n\tmatch = line.match(/^([^ ]+) */);\n\tmessage.command = match[1];\n\tmessage.rawCommand = match[1];\n\tmessage.commandType = 'normal';\n\tline = line.replace(/^[^ ]+ +/, '');\n\n\tif (replyFor[message.rawCommand]) {\n\t\tmessage.command = replyFor[message.rawCommand].name;\n\t\tmessage.commandType = replyFor[message.rawCommand].type;\n\t}\n\n\tmessage.args = [];\n\tlet middle;\n\tlet trailing;\n\n\t// Parse parameters\n\tif (line.search(/^:|\\s+:/) !== -1) {\n\t\tmatch = line.match(/(.*?)(?:^:|\\s+:)(.*)/);\n\t\tmiddle = match[1].trimRight();\n\t\ttrailing = match[2];\n\t} else {\n\t\tmiddle = line;\n\t}\n\n\tif (middle.length) {\n\t\tmessage.args = middle.split(/ +/);\n\t}\n\n\tif (typeof (trailing) !== 'undefined' && trailing.length) {\n\t\tmessage.args.push(trailing);\n\t}\n\n\treturn message;\n};\n","function PASS() {\n\tthis.log('Received PASS command, continue registering...');\n\n\tthis.registerSteps.push('PASS');\n}\n\nfunction SERVER(parsedMessage) {\n\tthis.log('Received SERVER command, waiting for first PING...');\n\n\tthis.serverPrefix = parsedMessage.prefix;\n\n\tthis.registerSteps.push('SERVER');\n}\n\nfunction PING() {\n\tif (!this.isRegistered && this.registerSteps.length === 2) {\n\t\tthis.log('Received first PING command, server is registered!');\n\n\t\tthis.isRegistered = true;\n\n\t\tthis.emit('registered');\n\t}\n\n\tthis.write({\n\t\tprefix: this.config.server.name,\n\t\tcommand: 'PONG',\n\t\tparameters: [ this.config.server.name ]\n\t});\n}\n\nfunction NICK(parsedMessage) {\n\tlet command;\n\n\t// Check if the message comes from the server,\n\t// which means it is a new user\n\tif (parsedMessage.prefix === this.serverPrefix) {\n\t\tcommand = {\n\t\t\tidentifier: 'userRegistered',\n\t\t\targs: {\n\t\t\t\tnick: parsedMessage.args[0],\n\t\t\t\tusername: parsedMessage.args[2],\n\t\t\t\thost: parsedMessage.args[3],\n\t\t\t\tname: parsedMessage.args[6]\n\t\t\t}\n\t\t};\n\t} else { // Otherwise, it is a nick change\n\t\tcommand = {\n\t\t\tidentifier: 'nickChanged',\n\t\t\targs: {\n\t\t\t\tnick: parsedMessage.nick,\n\t\t\t\tnewNick: parsedMessage.args[0]\n\t\t\t}\n\t\t};\n\t}\n\n\treturn command;\n}\n\nfunction JOIN(parsedMessage) {\n\tconst command = {\n\t\tidentifier: 'joinedChannel',\n\t\targs: {\n\t\t\troomName: parsedMessage.args[0].substring(1),\n\t\t\tnick: parsedMessage.prefix\n\t\t}\n\t};\n\n\treturn command;\n}\n\nfunction PART(parsedMessage) {\n\tconst command = {\n\t\tidentifier: 'leftChannel',\n\t\targs: {\n\t\t\troomName: parsedMessage.args[0].substring(1),\n\t\t\tnick: parsedMessage.prefix\n\t\t}\n\t};\n\n\treturn command;\n}\n\nfunction PRIVMSG(parsedMessage) {\n\tconst command = {\n\t\tidentifier: 'sentMessage',\n\t\targs: {\n\t\t\tnick: parsedMessage.prefix,\n\t\t\tmessage: parsedMessage.args[1]\n\t\t}\n\t};\n\n\tif (parsedMessage.args[0][0] === '#') {\n\t\tcommand.args.roomName = parsedMessage.args[0].substring(1);\n\t} else {\n\t\tcommand.args.recipientNick = parsedMessage.args[0];\n\t}\n\n\treturn command;\n}\n\nfunction QUIT(parsedMessage) {\n\tconst command = {\n\t\tidentifier: 'disconnected',\n\t\targs: {\n\t\t\tnick: parsedMessage.prefix\n\t\t}\n\t};\n\n\treturn command;\n}\n\nexport default { PASS, SERVER, PING, NICK, JOIN, PART, PRIVMSG, QUIT };\n"]}