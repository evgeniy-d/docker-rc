{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:drupal/common.js","meteor://ðŸ’»app/packages/rocketchat:drupal/startup.js"],"names":["config","serverURL","identityPath","authorizePath","tokenPath","scope","tokenSentVia","usernameField","mergeUsers","addAutopublishFields","forLoggedInUser","forOtherUsers","Drupal","CustomOAuth","Meteor","isServer","startup","RocketChat","settings","get","key","value","configure","Tracker","autorun","addGroup","section","enableQuery","_id","add","type","public","i18nDescription","readonly","force"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AAEA,MAAMA,SAAS;AACdC,aAAW,EADG;AAEdC,gBAAc,kBAFA;AAGdC,iBAAe,mBAHD;AAIdC,aAAW,eAJG;AAKdC,SAAO,qCALO;AAMdC,gBAAc,SANA;AAOdC,iBAAe,oBAPD;AAQdC,cAAY,IARE;AASdC,wBAAsB;AACrBC,qBAAiB,CAAC,iBAAD,CADI;AAErBC,mBAAe,CAAC,sBAAD;AAFM;AATR,CAAf;AAeA,MAAMC,SAAS,IAAIC,WAAJ,CAAgB,QAAhB,EAA0Bb,MAA1B,CAAf;;AAEA,IAAIc,OAAOC,QAAX,EAAqB;AACpBD,SAAOE,OAAP,CAAe,YAAW;AACzBC,eAAWC,QAAX,CAAoBC,GAApB,CAAwB,gBAAxB,EAA0C,UAASC,GAAT,EAAcC,KAAd,EAAqB;AAC9DrB,aAAOC,SAAP,GAAmBoB,KAAnB;AACAT,aAAOU,SAAP,CAAiBtB,MAAjB;AACA,KAHD;AAIA,GALD;AAMA,CAPD,MAOO;AACNc,SAAOE,OAAP,CAAe,YAAW;AACzBO,YAAQC,OAAR,CAAgB,YAAW;AAC1B,UAAIP,WAAWC,QAAX,CAAoBC,GAApB,CAAwB,gBAAxB,CAAJ,EAA+C;AAC9CnB,eAAOC,SAAP,GAAmBgB,WAAWC,QAAX,CAAoBC,GAApB,CAAwB,gBAAxB,CAAnB;AACAP,eAAOU,SAAP,CAAiBtB,MAAjB;AACA;AACD,KALD;AAMA,GAPD;AAQA,C;;;;;;;;;;;ACtCDiB,WAAWC,QAAX,CAAoBO,QAApB,CAA6B,OAA7B,EAAsC,YAAW;AAChD,OAAKC,OAAL,CAAa,QAAb,EAAuB,YAAW;AACjC,UAAMC,cAAc;AACnBC,WAAK,uBADc;AAEnBP,aAAO;AAFY,KAApB;AAKA,SAAKQ,GAAL,CAAS,uBAAT,EAAkC,KAAlC,EAAyC;AAAEC,YAAM;AAAR,KAAzC;AACA,SAAKD,GAAL,CAAS,gBAAT,EAA2B,EAA3B,EAA+B;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,IAA1B;AAAgCJ,iBAAhC;AAA6CK,uBAAiB;AAA9D,KAA/B;AACA,SAAKH,GAAL,CAAS,0BAAT,EAAqC,EAArC,EAAyC;AAAEC,YAAM,QAAR;AAAkBH;AAAlB,KAAzC;AACA,SAAKE,GAAL,CAAS,8BAAT,EAAyC,EAAzC,EAA6C;AAAEC,YAAM,QAAR;AAAkBH;AAAlB,KAA7C;AACA,SAAKE,GAAL,CAAS,oCAAT,EAA+C,eAA/C,EAAgE;AAAEC,YAAM,aAAR;AAAuBG,gBAAU,IAAjC;AAAuCC,aAAO,IAA9C;AAAoDP;AAApD,KAAhE;AACA,GAXD;AAYA,CAbD,E","file":"/packages/rocketchat_drupal.js","sourcesContent":["/* global CustomOAuth */\n\n// Drupal Server CallBack URL needs to be http(s)://{rocketchat.server}[:port]/_oauth/drupal\n// In RocketChat -> Administration the URL needs to be http(s)://{drupal.server}/\n\nconst config = {\n\tserverURL: '',\n\tidentityPath: '/oauth2/UserInfo',\n\tauthorizePath: '/oauth2/authorize',\n\ttokenPath: '/oauth2/token',\n\tscope: 'openid email profile offline_access',\n\ttokenSentVia: 'payload',\n\tusernameField: 'preferred_username',\n\tmergeUsers: true,\n\taddAutopublishFields: {\n\t\tforLoggedInUser: ['services.drupal'],\n\t\tforOtherUsers: ['services.drupal.name']\n\t}\n};\n\nconst Drupal = new CustomOAuth('drupal', config);\n\nif (Meteor.isServer) {\n\tMeteor.startup(function() {\n\t\tRocketChat.settings.get('API_Drupal_URL', function(key, value) {\n\t\t\tconfig.serverURL = value;\n\t\t\tDrupal.configure(config);\n\t\t});\n\t});\n} else {\n\tMeteor.startup(function() {\n\t\tTracker.autorun(function() {\n\t\t\tif (RocketChat.settings.get('API_Drupal_URL')) {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('API_Drupal_URL');\n\t\t\t\tDrupal.configure(config);\n\t\t\t}\n\t\t});\n\t});\n}\n","RocketChat.settings.addGroup('OAuth', function() {\n\tthis.section('Drupal', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Drupal',\n\t\t\tvalue: true\n\t\t};\n\n\t\tthis.add('Accounts_OAuth_Drupal', false, { type: 'boolean' });\n\t\tthis.add('API_Drupal_URL', '', { type: 'string', public: true, enableQuery, i18nDescription: 'API_Drupal_URL_Description' });\n\t\tthis.add('Accounts_OAuth_Drupal_id', '', { type: 'string', enableQuery });\n\t\tthis.add('Accounts_OAuth_Drupal_secret', '', { type: 'string', enableQuery });\n\t\tthis.add('Accounts_OAuth_Drupal_callback_url', '_oauth/drupal', { type: 'relativeUrl', readonly: true, force: true, enableQuery });\n\t});\n});\n"]}