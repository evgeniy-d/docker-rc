{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:action-links/both/lib/actionLinks.js","meteor://ðŸ’»app/packages/rocketchat:action-links/server/actionLinkHandler.js"],"names":["RocketChat","actionLinks","actions","register","name","funct","getMessage","messageId","userId","Meteor","Error","function","message","models","Messages","findOne","_id","subscription","Subscriptions","rid","methods","actionLinkHandler","method","actionLink","method_id","params"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACAA,WAAWC,WAAX,GAAyB;AACxBC,WAAS,EADe;;AAExBC,WAASC,IAAT,EAAeC,KAAf,EAAsB;AACrBL,eAAWC,WAAX,CAAuBC,OAAvB,CAA+BE,IAA/B,IAAuCC,KAAvC;AACA,GAJuB;;AAKxBC,aAAWF,IAAX,EAAiBG,SAAjB,EAA4B;AAC3B,UAAMC,SAASC,OAAOD,MAAP,EAAf;;AACA,QAAI,CAACA,MAAL,EAAa;AACZ,YAAM,IAAIC,OAAOC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,kBAAU;AAAZ,OAAvD,CAAN;AACA;;AAED,UAAMC,UAAUZ,WAAWa,MAAX,CAAkBC,QAAlB,CAA2BC,OAA3B,CAAmC;AAAEC,WAAKT;AAAP,KAAnC,CAAhB;;AACA,QAAI,CAACK,OAAL,EAAc;AACb,YAAM,IAAIH,OAAOC,KAAX,CAAiB,uBAAjB,EAA0C,iBAA1C,EAA6D;AAAEC,kBAAU;AAAZ,OAA7D,CAAN;AACA;;AAED,UAAMM,eAAejB,WAAWa,MAAX,CAAkBK,aAAlB,CAAgCH,OAAhC,CAAwC;AAC5DI,WAAKP,QAAQO,GAD+C;AAE5D,eAASX;AAFmD,KAAxC,CAArB;;AAIA,QAAI,CAACS,YAAL,EAAmB;AAClB,YAAM,IAAIR,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAEC,kBAAU;AAAZ,OAArD,CAAN;AACA;;AAED,QAAI,CAACC,QAAQX,WAAT,IAAwB,CAACW,QAAQX,WAAR,CAAoBG,IAApB,CAA7B,EAAwD;AACvD,YAAM,IAAIK,OAAOC,KAAX,CAAiB,0BAAjB,EAA6C,qBAA7C,EAAoE;AAAEC,kBAAU;AAAZ,OAApE,CAAN;AACA;;AAED,WAAOC,OAAP;AACA;;AA7BuB,CAAzB,C;;;;;;;;;;;ACDA;AAEAH,OAAOW,OAAP,CAAe;AACdC,oBAAkBjB,IAAlB,EAAwBG,SAAxB,EAAmC;AAClC,QAAI,CAACE,OAAOD,MAAP,EAAL,EAAsB;AACrB,YAAM,IAAIC,OAAOC,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEY,gBAAQ;AAAV,OAAvD,CAAN;AACA;;AAED,UAAMV,UAAUZ,WAAWC,WAAX,CAAuBK,UAAvB,CAAkCF,IAAlC,EAAwCG,SAAxC,CAAhB;AAEA,UAAMgB,aAAaX,QAAQX,WAAR,CAAoBG,IAApB,CAAnB;AAEAJ,eAAWC,WAAX,CAAuBC,OAAvB,CAA+BqB,WAAWC,SAA1C,EAAqDZ,OAArD,EAA8DW,WAAWE,MAAzE;AACA;;AAXa,CAAf,E","file":"/packages/rocketchat_action-links.js","sourcesContent":["//Action Links namespace creation.\nRocketChat.actionLinks = {\n\tactions: {},\n\tregister(name, funct) {\n\t\tRocketChat.actionLinks.actions[name] = funct;\n\t},\n\tgetMessage(name, messageId) {\n\t\tconst userId = Meteor.userId();\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOne({ _id: messageId });\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOne({\n\t\t\trid: message.rid,\n\t\t\t'u._id': userId\n\t\t});\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tif (!message.actionLinks || !message.actionLinks[name]) {\n\t\t\tthrow new Meteor.Error('error-invalid-actionlink', 'Invalid action link', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\treturn message;\n\t}\n};\n","//Action Links Handler. This method will be called off the client.\n\nMeteor.methods({\n\tactionLinkHandler(name, messageId) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'actionLinkHandler' });\n\t\t}\n\n\t\tconst message = RocketChat.actionLinks.getMessage(name, messageId);\n\n\t\tconst actionLink = message.actionLinks[name];\n\n\t\tRocketChat.actionLinks.actions[actionLink.method_id](message, actionLink.params);\n\t}\n});\n"]}