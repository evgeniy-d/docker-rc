{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:markdown/settings.js","meteor://ðŸ’»app/packages/rocketchat:markdown/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/marked/marked.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/code.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/original.js"],"names":["Meteor","module","watch","require","v","RocketChat","startup","settings","add","type","values","key","i18nLabel","group","section","public","enableQueryOriginal","_id","value","enableQuery","i18nDescription","enableQueryMarked","s","default","Blaze","marked","original","code","parsers","MarkdownClass","parse","text","message","html","escapeHTML","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","parser","get","useHtml","tokens","length","token","noHtml","replace","args","Markdown","MarkdownMessage","trim","undefined","callbacks","priority","HIGH","isClient","registerHelper","export","Random","_","hljs","_marked","renderer","Renderer","msg","lang","escaped","options","highlight","out","escape","isString","id","push","codespan","blockquote","quote","e","gfm","tables","breaks","pedantic","smartLists","smartypants","unescapeHTML","sanitize","inlinecode","match","p1","p2","codeblocks","count","msgParts","split","index","part","codeMatch","singleLine","indexOf","Array","from","listLanguages","includes","result","highlightAuto","language","join","markdown","addAsToken","schemes","RegExp","title","url","target","absoluteUrl"],"mappings":"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","file":"/packages/rocketchat_markdown.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.startup(() => {\n\tRocketChat.settings.add('Markdown_Parser', 'original', {\n\t\ttype: 'select',\n\t\tvalues: [{\n\t\t\tkey: 'disabled',\n\t\t\ti18nLabel: 'Disabled'\n\t\t}, {\n\t\t\tkey: 'original',\n\t\t\ti18nLabel: 'Original'\n\t\t}, {\n\t\t\tkey: 'marked',\n\t\t\ti18nLabel: 'Marked'\n\t\t}],\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true\n\t});\n\n\tconst enableQueryOriginal = {_id: 'Markdown_Parser', value: 'original'};\n\tRocketChat.settings.add('Markdown_Headers', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryOriginal\n\t});\n\tRocketChat.settings.add('Markdown_SupportSchemesForLink', 'http,https', {\n\t\ttype: 'string',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\ti18nDescription: 'Markdown_SupportSchemesForLink_Description',\n\t\tenableQuery: enableQueryOriginal\n\t});\n\n\tconst enableQueryMarked = {_id: 'Markdown_Parser', value: 'marked'};\n\tRocketChat.settings.add('Markdown_Marked_GFM', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Tables', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Breaks', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Pedantic', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: [{\n\t\t\t_id: 'Markdown_Parser',\n\t\t\tvalue: 'marked'\n\t\t}, {\n\t\t\t_id: 'Markdown_Marked_GFM',\n\t\t\tvalue: false\n\t\t}]\n\t});\n\tRocketChat.settings.add('Markdown_Marked_SmartLists', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Smartypants', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n});\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport s from 'underscore.string';\nimport { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { marked } from './parser/marked/marked.js';\nimport { original } from './parser/original/original.js';\n\nimport { code } from './parser/original/code.js';\n\nconst parsers = {\n\toriginal,\n\tmarked\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: s.escapeHTML(text)\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst parser = RocketChat.settings.get('Markdown_Parser');\n\n\t\tif (parser === 'disabled') {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (typeof parsers[parser] === 'function') {\n\t\t\treturn parsers[parser](message);\n\t\t}\n\t\treturn parsers['original'](message);\n\t}\n\n\tmountTokensBack(message, useHtml = true) {\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tfor (const {token, text, noHtml} of message.tokens) {\n\t\t\t\tmessage.html = message.html.replace(token, () => useHtml ? text : noHtml); // Uses lambda so doesn't need to escape $\n\t\t\t}\n\t\t}\n\n\t\treturn message;\n\t}\n\n\tcode(...args) {\n\t\treturn code(...args);\n\t}\n}\n\nconst Markdown = new MarkdownClass;\nRocketChat.Markdown = Markdown;\n\n// renderMessage already did html escape\nconst MarkdownMessage = (message) => {\n\tif (s.trim(message != null ? message.html : undefined)) {\n\t\tmessage = Markdown.parseMessageNotEscaped(message);\n\t}\n\n\treturn message;\n};\n\nRocketChat.callbacks.add('renderMessage', MarkdownMessage, RocketChat.callbacks.priority.HIGH, 'markdown');\n\nif (Meteor.isClient) {\n\tBlaze.registerHelper('RocketChatMarkdown', text => Markdown.parse(text));\n\tBlaze.registerHelper('RocketChatMarkdownUnescape', text => Markdown.parseNotEscaped(text));\n}\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport { Random } from 'meteor/random';\nimport _ from 'underscore';\nimport s from 'underscore.string';\nimport hljs from 'highlight.js';\nimport _marked from 'marked';\n\nconst renderer = new _marked.Renderer();\n\nlet msg = null;\n\nrenderer.code = function(code, lang, escaped) {\n\tif (this.options.highlight) {\n\t\tconst out = this.options.highlight(code, lang);\n\t\tif (out != null && out !== code) {\n\t\t\tescaped = true;\n\t\t\tcode = out;\n\t\t}\n\t}\n\n\tlet text = null;\n\n\tif (!lang) {\n\t\ttext = `<pre><code class=\"code-colors hljs\">${ (escaped ? code : s.escapeHTML(code, true)) }</code></pre>`;\n\t} else {\n\t\ttext = `<pre><code class=\"code-colors hljs ${ escape(lang, true) }\">${ (escaped ? code : s.escapeHTML(code, true)) }</code></pre>`;\n\t}\n\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\thighlight: true,\n\t\ttoken,\n\t\ttext\n\t});\n\n\treturn token;\n};\n\nrenderer.codespan = function(text) {\n\ttext = `<code class=\"code-colors inline\">${ text }</code>`;\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\ttoken,\n\t\ttext\n\t});\n\n\treturn token;\n};\n\nrenderer.blockquote = function(quote) {\n\treturn `<blockquote class=\"background-transparent-darker-before\">${ quote }</blockquote>`;\n};\n\nconst highlight = function(code, lang) {\n\tif (!lang) {\n\t\treturn code;\n\t}\n\ttry {\n\t\treturn hljs.highlight(lang, code).value;\n\t} catch (e) {\n\t\t// Unknown language\n\t\treturn code;\n\t}\n};\n\nlet gfm = null;\nlet tables = null;\nlet breaks = null;\nlet pedantic = null;\nlet smartLists = null;\nlet smartypants = null;\n\nexport const marked = (message) => {\n\tmsg = message;\n\n\tif (!msg.tokens) {\n\t\tmsg.tokens = [];\n\t}\n\n\tif (gfm == null) { gfm = RocketChat.settings.get('Markdown_Marked_GFM'); }\n\tif (tables == null) { tables = RocketChat.settings.get('Markdown_Marked_Tables'); }\n\tif (breaks == null) { breaks = RocketChat.settings.get('Markdown_Marked_Breaks'); }\n\tif (pedantic == null) { pedantic = RocketChat.settings.get('Markdown_Marked_Pedantic'); }\n\tif (smartLists == null) { smartLists = RocketChat.settings.get('Markdown_Marked_SmartLists'); }\n\tif (smartypants == null) { smartypants = RocketChat.settings.get('Markdown_Marked_Smartypants'); }\n\n\tmsg.html = _marked(s.unescapeHTML(msg.html), {\n\t\tgfm,\n\t\ttables,\n\t\tbreaks,\n\t\tpedantic,\n\t\tsmartLists,\n\t\tsmartypants,\n\t\trenderer,\n\t\tsanitize: true,\n\t\thighlight\n\t});\n\n\treturn msg;\n};\n","/*\n * code() is a named function that will parse `inline code` and ```codeblock``` syntaxes\n * @param {Object} message - The message object\n */\nimport { Random } from 'meteor/random';\nimport s from 'underscore.string';\nimport hljs from 'highlight.js';\n\nconst inlinecode = (message) => {\n\t// Support `text`\n\treturn message.html = message.html.replace(/\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2) => {\n\t\tconst token = ` =!=${ Random.id() }=!=`;\n\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: `<span class=\\\"copyonly\\\">\\`</span><span><code class=\\\"code-colors inline\\\">${ p1 }</code></span><span class=\\\"copyonly\\\">\\`</span>${ p2 }`,\n\t\t\tnoHtml: match\n\t\t});\n\n\t\treturn token;\n\t});\n};\n\nconst codeblocks = (message) => {\n\t// Count occurencies of ```\n\tconst count = (message.html.match(/```/g) || []).length;\n\n\tif (count) {\n\n\t\t// Check if we need to add a final ```\n\t\tif ((count % 2) > 0) {\n\t\t\tmessage.html = `${ message.html }\\n\\`\\`\\``;\n\t\t\tmessage.msg = `${ message.msg }\\n\\`\\`\\``;\n\t\t}\n\n\t\t// Separate text in code blocks and non code blocks\n\t\tconst msgParts = message.html.split(/(^.*)(```(?:[a-zA-Z]+)?(?:(?:.|\\r|\\n)*?)```)(.*\\n?)$/gm);\n\n\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\t// Verify if this part is code\n\t\t\tconst part = msgParts[index];\n\t\t\tconst codeMatch = part.match(/^```[\\r\\n]*(.*[\\r\\n\\ ]?)[\\r\\n]*([\\s\\S]*?)```+?$/);\n\n\t\t\tif (codeMatch != null) {\n\t\t\t\t// Process highlight if this part is code\n\t\t\t\tconst singleLine = codeMatch[0].indexOf('\\n') === -1;\n\t\t\t\tconst lang = !singleLine && Array.from(hljs.listLanguages()).includes(s.trim(codeMatch[1])) ? s.trim(codeMatch[1]) : '';\n\t\t\t\tconst code =\n\t\t\t\t\tsingleLine ?\n\t\t\t\t\t\ts.unescapeHTML(codeMatch[1]) :\n\t\t\t\t\t\tlang === '' ?\n\t\t\t\t\t\t\ts.unescapeHTML(codeMatch[1] + codeMatch[2]) :\n\t\t\t\t\t\t\ts.unescapeHTML(codeMatch[2]);\n\n\t\t\t\tconst result = lang === '' ? hljs.highlightAuto((lang + code)) : hljs.highlight(lang, code);\n\t\t\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\t\t\tmessage.tokens.push({\n\t\t\t\t\thighlight: true,\n\t\t\t\t\ttoken,\n\t\t\t\t\ttext: `<pre><code class='code-colors hljs ${ result.language }'><span class='copyonly'>\\`\\`\\`<br></span>${ result.value }<span class='copyonly'><br>\\`\\`\\`</span></code></pre>`,\n\t\t\t\t\tnoHtml: codeMatch[0]\n\t\t\t\t});\n\n\t\t\t\tmsgParts[index] = token;\n\t\t\t} else {\n\t\t\t\tmsgParts[index] = part;\n\t\t\t}\n\t\t}\n\n\t\t// Re-mount message\n\t\treturn message.html = msgParts.join('');\n\t}\n};\n\nexport const code = (message) => {\n\tif (s.trim(message.html)) {\n\t\tif (message.tokens == null) {\n\t\t\tmessage.tokens = [];\n\t\t}\n\n\t\tcodeblocks(message);\n\t\tinlinecode(message);\n\t}\n\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {String} msg - The message html\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { RocketChat } from 'meteor/rocketchat:lib';\nimport s from 'underscore.string';\n\nconst parseNotEscaped = function(msg, message) {\n\tif (message && message.tokens == null) {\n\t\tmessage.tokens = [];\n\t}\n\n\tconst addAsToken = function(html) {\n\t\tconst token = `=!=${ Random.id() }=!=`;\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: html\n\t\t});\n\n\t\treturn token;\n\t};\n\n\tconst schemes = RocketChat.settings.get('Markdown_SupportSchemesForLink').split(',').join('|');\n\n\tif (RocketChat.settings.get('Markdown_Headers')) {\n\t\t// Support # Text for h1\n\t\tmsg = msg.replace(/^# (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h1>$1</h1>');\n\n\t\t// Support # Text for h2\n\t\tmsg = msg.replace(/^## (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h2>$1</h2>');\n\n\t\t// Support # Text for h3\n\t\tmsg = msg.replace(/^### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h3>$1</h3>');\n\n\t\t// Support # Text for h4\n\t\tmsg = msg.replace(/^#### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h4>$1</h4>');\n\t}\n\n\t// Support *text* to make bold\n\tmsg = msg.replace(/(^|&gt;|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">*</span><strong>$2</strong><span class=\"copyonly\">*</span>$3');\n\n\t// Support _text_ to make italics\n\tmsg = msg.replace(/(^|&gt;|[ >*~`])\\_{1,2}([^\\_\\r\\n]+)\\_{1,2}([<*~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">_</span><em>$2</em><span class=\"copyonly\">_</span>$3');\n\n\t// Support ~text~ to strike through text\n\tmsg = msg.replace(/(^|&gt;|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">~</span><strike>$2</strike><span class=\"copyonly\">~</span>$3');\n\n\t// Support for block quote\n\t// >>>\n\t// Text\n\t// <<<\n\tmsg = msg.replace(/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>');\n\n\t// Support >Text for quote\n\tmsg = msg.replace(/^&gt;(.*)$/gm, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;</span>$1</blockquote>');\n\n\t// Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\tmsg = msg.replace(/\\s*<blockquote class=\"background-transparent-darker-before\">/gm, '<blockquote class=\"background-transparent-darker-before\">');\n\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>');\n\n\t// Remove new-line between blockquotes.\n\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote/gm, '</blockquote><blockquote');\n\n\t// Support ![alt text](http://image url)\n\tmsg = msg.replace(new RegExp(`!\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" title=\"${ s.escapeHTML(title) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\"><div class=\"inline-image\" style=\"background-image: url(${ s.escapeHTML(url) });\"></div></a>`);\n\t});\n\n\t// Support [Text](http://link)\n\tmsg = msg.replace(new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ s.escapeHTML(title) }</a>`);\n\t});\n\n\t// Support <http://link|Text>\n\tmsg = msg.replace(new RegExp(`(?:<|&lt;)((?:${ schemes }):\\\\/\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'), (match, url, title) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ s.escapeHTML(title) }</a>`);\n\t});\n\n\treturn msg;\n};\n\nexport const markdown = function(message) {\n\tmessage.html = parseNotEscaped(message.html, message);\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { markdown } from './markdown.js';\nimport { code } from './code.js';\n\nexport const original = (message) => {\n\t// Parse markdown code\n\tmessage = code(message);\n\n\t// Parse markdown\n\tmessage = markdown(message);\n\n\t// Replace linebreak to br\n\tmessage.html = message.html.replace(/\\n/gm, '<br>');\n\n\treturn message;\n};\n"]}