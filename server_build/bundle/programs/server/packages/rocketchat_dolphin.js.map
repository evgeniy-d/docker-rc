{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:dolphin/common.js","meteor://ðŸ’»app/packages/rocketchat:dolphin/startup.js"],"names":["config","serverURL","authorizePath","tokenPath","identityPath","scope","addAutopublishFields","forLoggedInUser","forOtherUsers","Dolphin","CustomOAuth","DolphinOnCreateUser","options","user","services","dolphin","NickName","username","Meteor","isServer","startup","RocketChat","models","Settings","find","_id","observe","added","settings","get","configure","changed","data","buttonLabelText","buttonColor","buttonLabelColor","clientId","secret","loginStyle","ServiceConfiguration","configurations","upsert","service","$set","callbacks","add","priority","HIGH","Tracker","autorun","type","group","public","section","i18nLabel","persistent","values","key"],"mappings":"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","file":"/packages/rocketchat_dolphin.js","sourcesContent":["// Dolphin OAuth2\n/* globals CustomOAuth */\n\nconst config = {\n\tserverURL: '',\n\tauthorizePath: '/m/oauth2/auth/',\n\ttokenPath: '/m/oauth2/token/',\n\tidentityPath: '/m/oauth2/api/me/',\n\tscope: 'basic',\n\taddAutopublishFields: {\n\t\tforLoggedInUser: ['services.dolphin'],\n\t\tforOtherUsers: ['services.dolphin.name']\n\t}\n};\n\nconst Dolphin = new CustomOAuth('dolphin', config);\n\nfunction DolphinOnCreateUser(options, user) {\n\tif (user && user.services && user.services.dolphin && user.services.dolphin.NickName) {\n\t\tuser.username = user.services.dolphin.NickName;\n\t}\n\treturn user;\n}\n\nif (Meteor.isServer) {\n\tMeteor.startup(() =>\n\t\tRocketChat.models.Settings.find({ _id: 'Accounts_OAuth_Dolphin_URL' }).observe({\n\t\t\tadded() {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('Accounts_OAuth_Dolphin_URL');\n\t\t\t\treturn Dolphin.configure(config);\n\t\t\t},\n\t\t\tchanged() {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('Accounts_OAuth_Dolphin_URL');\n\t\t\t\treturn Dolphin.configure(config);\n\t\t\t}\n\t\t})\n\t);\n\n\tif (RocketChat.settings.get('Accounts_OAuth_Dolphin_URL')) {\n\t\tconst data = {\n\t\t\tbuttonLabelText: RocketChat.settings.get('Accounts_OAuth_Dolphin_button_label_text'),\n\t\t\tbuttonColor: RocketChat.settings.get('Accounts_OAuth_Dolphin_button_color'),\n\t\t\tbuttonLabelColor: RocketChat.settings.get('Accounts_OAuth_Dolphin_button_label_color'),\n\t\t\tclientId: RocketChat.settings.get('Accounts_OAuth_Dolphin_id'),\n\t\t\tsecret: RocketChat.settings.get('Accounts_OAuth_Dolphin_secret'),\n\t\t\tserverURL: RocketChat.settings.get('Accounts_OAuth_Dolphin_URL'),\n\t\t\tloginStyle: RocketChat.settings.get('Accounts_OAuth_Dolphin_login_style')\n\t\t};\n\n\t\tServiceConfiguration.configurations.upsert({service: 'dolphin'}, {$set: data});\n\t}\n\n\tRocketChat.callbacks.add('beforeCreateUser', DolphinOnCreateUser, RocketChat.callbacks.priority.HIGH);\n} else {\n\tMeteor.startup(() =>\n\t\tTracker.autorun(function() {\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Dolphin_URL')) {\n\t\t\t\tconfig.serverURL = RocketChat.settings.get('Accounts_OAuth_Dolphin_URL');\n\t\t\t\treturn Dolphin.configure(config);\n\t\t\t}\n\t\t})\n\t);\n}\n","RocketChat.settings.add('Accounts_OAuth_Dolphin_URL', '', { type: 'string', group: 'OAuth', public: true, section: 'Dolphin', i18nLabel: 'URL' });\nRocketChat.settings.add('Accounts_OAuth_Dolphin', false, { type: 'boolean', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_Enable' });\nRocketChat.settings.add('Accounts_OAuth_Dolphin_id', '', { type: 'string', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_id' });\nRocketChat.settings.add('Accounts_OAuth_Dolphin_secret', '', { type: 'string', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_Secret' });\nRocketChat.settings.add('Accounts_OAuth_Dolphin_login_style', 'redirect', { type: 'select', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_Login_Style', persistent: true, values: [ { key: 'redirect', i18nLabel: 'Redirect' }, { key: 'popup', i18nLabel: 'Popup' }, { key: '', i18nLabel: 'Default' } ] });\nRocketChat.settings.add('Accounts_OAuth_Dolphin_button_label_text', '', { type: 'string', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Text', persistent: true });\nRocketChat.settings.add('Accounts_OAuth_Dolphin_button_label_color', '#FFFFFF', { type: 'string', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Color', persistent: true });\nRocketChat.settings.add('Accounts_OAuth_Dolphin_button_color', '#13679A', { type: 'string', group: 'OAuth', section: 'Dolphin', i18nLabel: 'Accounts_OAuth_Custom_Button_Color', persistent: true });\n"]}