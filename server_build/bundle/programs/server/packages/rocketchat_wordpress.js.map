{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:wordpress/common.js","meteor://ðŸ’»app/packages/rocketchat:wordpress/startup.js"],"names":["_","module","watch","require","default","v","config","serverURL","identityPath","addAutopublishFields","forLoggedInUser","forOtherUsers","WordPress","CustomOAuth","fillSettings","debounce","Meteor","bindEnvironment","RocketChat","settings","get","undefined","identityTokenSentVia","authorizePath","tokenPath","scope","serverType","result","configure","isServer","enabled","ServiceConfiguration","configurations","upsert","service","$set","remove","startup","Tracker","autorun","addGroup","section","enableQuery","_id","value","add","type","values","key","i18nLabel","customOAuthQuery","readonly","force"],"mappings":"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","file":"/packages/rocketchat_wordpress.js","sourcesContent":["/* globals CustomOAuth */\nimport _ from 'underscore';\n\nconst config = {\n\tserverURL: '',\n\tidentityPath: '/oauth/me',\n\n\taddAutopublishFields: {\n\t\tforLoggedInUser: ['services.wordpress'],\n\t\tforOtherUsers: ['services.wordpress.user_login']\n\t}\n};\n\nconst WordPress = new CustomOAuth('wordpress', config);\n\nconst fillSettings = _.debounce(Meteor.bindEnvironment(() => {\n\tconfig.serverURL = RocketChat.settings.get('API_Wordpress_URL');\n\tif (!config.serverURL) {\n\t\tif (config.serverURL === undefined) {\n\t\t\treturn fillSettings();\n\t\t}\n\t\treturn;\n\t}\n\n\tdelete config.identityPath;\n\tdelete config.identityTokenSentVia;\n\tdelete config.authorizePath;\n\tdelete config.tokenPath;\n\tdelete config.scope;\n\n\tconst serverType = RocketChat.settings.get('Accounts_OAuth_Wordpress_server_type');\n\tswitch (serverType) {\n\t\tcase 'custom':\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Wordpress_identity_path')) {\n\t\t\t\tconfig.identityPath = RocketChat.settings.get('Accounts_OAuth_Wordpress_identity_path');\n\t\t\t}\n\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Wordpress_identity_token_sent_via')) {\n\t\t\t\tconfig.identityTokenSentVia = RocketChat.settings.get('Accounts_OAuth_Wordpress_identity_token_sent_via');\n\t\t\t}\n\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Wordpress_token_path')) {\n\t\t\t\tconfig.tokenPath = RocketChat.settings.get('Accounts_OAuth_Wordpress_token_path');\n\t\t\t}\n\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Wordpress_authorize_path')) {\n\t\t\t\tconfig.authorizePath = RocketChat.settings.get('Accounts_OAuth_Wordpress_authorize_path');\n\t\t\t}\n\n\t\t\tif (RocketChat.settings.get('Accounts_OAuth_Wordpress_scope')) {\n\t\t\t\tconfig.scope = RocketChat.settings.get('Accounts_OAuth_Wordpress_scope');\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'wordpress-com':\n\t\t\tconfig.identityPath = 'https://public-api.wordpress.com/rest/v1/me';\n\t\t\tconfig.identityTokenSentVia = 'header';\n\t\t\tconfig.authorizePath = 'https://public-api.wordpress.com/oauth2/authorize';\n\t\t\tconfig.tokenPath = 'https://public-api.wordpress.com/oauth2/token';\n\t\t\tconfig.scope = 'auth';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconfig.identityPath = '/oauth/me';\n\t\t\tbreak;\n\t}\n\n\tconst result = WordPress.configure(config);\n\tif (Meteor.isServer) {\n\t\tconst enabled = RocketChat.settings.get('Accounts_OAuth_Wordpress');\n\t\tif (enabled) {\n\t\t\tServiceConfiguration.configurations.upsert({\n\t\t\t\tservice: 'wordpress'\n\t\t\t}, {\n\t\t\t\t$set: config\n\t\t\t});\n\t\t} else {\n\t\t\tServiceConfiguration.configurations.remove({\n\t\t\t\tservice: 'wordpress'\n\t\t\t});\n\t\t}\n\t}\n\n\treturn result;\n}), Meteor.isServer ? 1000 : 100);\n\nif (Meteor.isServer) {\n\tMeteor.startup(function() {\n\t\treturn RocketChat.settings.get(/(API\\_Wordpress\\_URL)?(Accounts\\_OAuth\\_Wordpress\\_)?/, () => fillSettings());\n\t});\n} else {\n\tMeteor.startup(function() {\n\t\treturn Tracker.autorun(function() {\n\t\t\treturn fillSettings();\n\t\t});\n\t});\n}\n","RocketChat.settings.addGroup('OAuth', function() {\n\treturn this.section('WordPress', function() {\n\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Wordpress',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Wordpress', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('API_Wordpress_URL', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_server_type', '', {\n\t\t\ttype: 'select',\n\t\t\tenableQuery,\n\t\t\t'public': true,\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'wordpress-com',\n\t\t\t\t\ti18nLabel: 'Accounts_OAuth_Wordpress_server_type_wordpress_com'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'wp-oauth-server',\n\t\t\t\t\ti18nLabel: 'Accounts_OAuth_Wordpress_server_type_wp_oauth_server'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tkey: 'custom',\n\t\t\t\t\ti18nLabel: 'Accounts_OAuth_Wordpress_server_type_custom'\n\t\t\t\t}\n\t\t\t],\n\t\t\ti18nLabel: 'Server_Type'\n\t\t});\n\n\t\tconst customOAuthQuery = [{\n\t\t\t_id: 'Accounts_OAuth_Wordpress',\n\t\t\tvalue: true\n\t\t}, {\n\t\t\t_id: 'Accounts_OAuth_Wordpress_server_type',\n\t\t\tvalue: 'custom'\n\t\t}];\n\n\t\tthis.add('Accounts_OAuth_Wordpress_identity_path', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: customOAuthQuery,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_identity_token_sent_via', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: customOAuthQuery,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_token_path', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: customOAuthQuery,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_authorize_path', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: customOAuthQuery,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Wordpress_scope', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: customOAuthQuery,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Wordpress_callback_url', '_oauth/wordpress', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n});\n"]}