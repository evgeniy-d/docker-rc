{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:graphql/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/api.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/schema.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/helpers/authenticated.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/helpers/dateToFloat.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/mocks/accounts/graphql-api.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/accounts/OauthProvider-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/accounts/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/accounts/oauthProviders.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/Channel-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/ChannelFilter-input.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/ChannelNameAndDirect-input.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/ChannelSort-enum.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/Privacy-enum.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/channelByName.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/channels.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/channelsByUser.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/createChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/directChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/hideChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/leaveChannel.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/channels/settings.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/Message-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/MessageIdentifier-input.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/MessagesWithCursor-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/Reaction-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/addReactionToMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/chatMessageAdded.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/editMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/messages.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/messages/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/User-type.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/UserStatus-enum.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/index.js","meteor://ðŸ’»app/packages/rocketchat:graphql/server/resolvers/users/setStatus.js"],"names":["RocketChat","settings","addGroup","section","add","type","public","enableQuery","_id","value","graphqlExpress","graphiqlExpress","module","watch","require","v","jsAccountsContext","JSAccountsContext","SubscriptionServer","execute","subscribe","Meteor","WebApp","bodyParser","default","express","cors","executableSchema","subscriptionPort","get","graphQLServer","use","req","res","next","status","send","json","request","schema","context","formatError","e","message","locations","path","debug","isDevelopment","endpointURL","subscriptionsEndpoint","startSubscriptionServer","create","onConnect","connectionParams","authToken","Authorization","port","host","process","env","BIND_IP","console","log","onListening","connectHandlers","export","makeExecutableSchema","mergeTypes","mergeResolvers","channels","messages","accounts","users","resolvers","typeDefs","logger","pubsub","PubSub","authenticated","AccountsServer","_authenticated","resolver","dateToFloat","date","Date","getTime","Accounts","func","root","args","info","Error","userObject","resumeSession","Object","assign","user","createJSAccountsGraphQL","oauthProviders","OauthProviderType","accountsGraphQL","extendWithResolvers","HTTP","isJSON","obj","JSON","parse","Query","result","absoluteUrl","content","providers","data","map","name","property","Channel","id","t","usernames","find","u","username","members","ids","models","Subscriptions","findByRoomIdWhenUserIdExists","fields","fetch","sub","Users","findByIds","owners","findOneByUsername","numberOfMembers","findByRoomId","count","numberOfMessages","readOnly","ro","direct","privateChannel","favourite","room","findOneByRoomIdAndUserId","f","unseenMessages","unread","roomPublicFields","channelByName","query","Rooms","findOne","options","sort","filter","nameFilter","undefined","$regex","RegExp","sortBy","msgs","privacy","$ne","channelsByUser","userId","findOneById","roomIds","findByUserId","rid","s","rooms","Mutation","createChannel","API","validate","key","membersId","channel","directChannel","channelId","$all","hideChannel","open","runAsUser","call","leaveChannel","ChannelType","ChannelSort","ChannelFilter","Privacy","ChannelNameAndDirect","description","announcement","topic","archived","Message","creationTime","ts","author","fromServer","channelRef","$in","c","userRef","mentions","reactions","keys","length","forEach","icon","push","addReactionToMessage","Promise","resolve","messageId","Messages","CHAT_MESSAGE_SUBSCRIPTION_TOPIC","publishMessage","withFilter","publish","chatMessageAdded","shouldPublish","directTo","Subscription","asyncIterator","payload","callbacks","deleteMessage","msg","editMessage","sendMessage","MessageType","MessagesWithCursorType","MessageIdentifier","ReactionType","messagesQuery","messagesOptions","channelQuery","isPagination","cursor","channelName","error","messagesArray","cursorMsg","$lt","searchRegex","limit","excludeServer","$exists","firstMessage","lastId","text","messageReturn","processWebhookMessage","User","toUpperCase","avatar","Avatars","model","rawCollection","url","bindEnvironment","findBySubscriptionUserId","directMessages","findDirectRoomContainingUsername","setStatus","UserType","UserStatus","update","$set","toLowerCase"],"mappings":"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","file":"/packages/rocketchat_graphql.js","sourcesContent":["RocketChat.settings.addGroup('General', function() {\n\tthis.section('GraphQL API', function() {\n\t\tthis.add('Graphql_Enabled', false, { type: 'boolean', public: false });\n\t\tthis.add('Graphql_CORS', true, { type: 'boolean', public: false, enableQuery: { _id: 'Graphql_Enabled', value: true } });\n\t\tthis.add('Graphql_Subscription_Port', 3100, { type: 'int', public: false, enableQuery: { _id: 'Graphql_Enabled', value: true } });\n\t});\n});\n","import { graphqlExpress, graphiqlExpress } from 'apollo-server-express';\nimport { JSAccountsContext as jsAccountsContext } from '@accounts/graphql-api';\nimport { SubscriptionServer } from 'subscriptions-transport-ws';\nimport { execute, subscribe } from 'graphql';\nimport { Meteor } from 'meteor/meteor';\nimport { WebApp } from 'meteor/webapp';\nimport bodyParser from 'body-parser';\nimport express from 'express';\nimport cors from 'cors';\n\nimport { executableSchema } from './schema';\n\nconst subscriptionPort = RocketChat.settings.get('Graphql_Subscription_Port') || 3100;\n\n// the Meteor GraphQL server is an Express server\nconst graphQLServer = express();\n\nif (RocketChat.settings.get('Graphql_CORS')) {\n\tgraphQLServer.use(cors());\n}\n\ngraphQLServer.use('/api/graphql', (req, res, next) => {\n\tif (RocketChat.settings.get('Graphql_Enabled')) {\n\t\tnext();\n\t} else {\n\t\tres.status(400).send('Graphql is not enabled in this server');\n\t}\n});\n\ngraphQLServer.use(\n\t'/api/graphql',\n\tbodyParser.json(),\n\tgraphqlExpress(request => {\n\t\treturn {\n\t\t\tschema: executableSchema,\n\t\t\tcontext: jsAccountsContext(request),\n\t\t\tformatError: e => ({\n\t\t\t\tmessage: e.message,\n\t\t\t\tlocations: e.locations,\n\t\t\t\tpath: e.path\n\t\t\t}),\n\t\t\tdebug: Meteor.isDevelopment\n\t\t};\n\t})\n);\n\ngraphQLServer.use(\n\t'/graphiql',\n\tgraphiqlExpress({\n\t\tendpointURL: '/api/graphql',\n\t\tsubscriptionsEndpoint: `ws://localhost:${ subscriptionPort }`\n\t})\n);\n\nconst startSubscriptionServer = () => {\n\tif (RocketChat.settings.get('Graphql_Enabled')) {\n\t\tSubscriptionServer.create({\n\t\t\tschema: executableSchema,\n\t\t\texecute,\n\t\t\tsubscribe,\n\t\t\tonConnect: (connectionParams) => ({ authToken: connectionParams.Authorization })\n\t\t},\n\t\t{\n\t\t\tport: subscriptionPort,\n\t\t\thost: process.env.BIND_IP || '0.0.0.0'\n\t\t});\n\n\t\tconsole.log('GraphQL Subscription server runs on port:', subscriptionPort);\n\t}\n};\n\nWebApp.onListening(() => {\n\tstartSubscriptionServer();\n});\n\n// this binds the specified paths to the Express server running Apollo + GraphiQL\nWebApp.connectHandlers.use(graphQLServer);\n","import { makeExecutableSchema } from 'graphql-tools';\nimport { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\nimport * as channels from './resolvers/channels';\nimport * as messages from './resolvers/messages';\nimport * as accounts from './resolvers/accounts';\nimport * as users from './resolvers/users';\n\nconst schema = mergeTypes([\n\tchannels.schema,\n\tmessages.schema,\n\taccounts.schema,\n\tusers.schema\n]);\n\nconst resolvers = mergeResolvers([\n\tchannels.resolvers,\n\tmessages.resolvers,\n\taccounts.resolvers,\n\tusers.resolvers\n]);\n\nexport const executableSchema = makeExecutableSchema({\n\ttypeDefs: [schema],\n\tresolvers,\n\tlogger: {\n\t\tlog: (e) => console.log(e)\n\t}\n});\n","import { PubSub } from 'graphql-subscriptions';\n\nexport const pubsub = new PubSub();\n","import { AccountsServer } from 'meteor/rocketchat:accounts';\n//import { authenticated as _authenticated } from '@accounts/graphql-api';\nimport { authenticated as _authenticated } from '../mocks/accounts/graphql-api';\n\nexport const authenticated = (resolver) => {\n\treturn _authenticated(AccountsServer, resolver);\n};\n","export function dateToFloat(date) {\n\tif (date) {\n\t\treturn new Date(date).getTime();\n\t}\n}\n","// Same as here: https://github.com/js-accounts/graphql/blob/master/packages/graphql-api/src/utils/authenticated-resolver.js\n// except code below works\n// It might be like that because of async/await,\n// maybe Promise is not wrapped with Fiber\n// See: https://github.com/meteor/meteor/blob/a362e20a37547362b581fed52f7171d022e83b62/packages/promise/server.js\n// Opened issue: https://github.com/js-accounts/graphql/issues/16\nexport const authenticated = (Accounts, func) => (async(root, args, context, info) => {\n\tconst authToken = context.authToken;\n\n\tif (!authToken || authToken === '' || authToken === null) {\n\t\tthrow new Error('Unable to find authorization token in request');\n\t}\n\n\tconst userObject = await Accounts.resumeSession(authToken);\n\n\tif (userObject === null) {\n\t\tthrow new Error('Invalid or expired token!');\n\t}\n\n\treturn await func(root, args, Object.assign(context, { user: userObject }), info);\n});\n","import schema from '../../schemas/accounts/OauthProvider-type.graphqls';\n\nexport {\n\tschema\n};\n","import { createJSAccountsGraphQL } from '@accounts/graphql-api';\nimport { AccountsServer } from 'meteor/rocketchat:accounts';\nimport { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// queries\nimport * as oauthProviders from './oauthProviders';\n// types\nimport * as OauthProviderType from './OauthProvider-type';\n\nconst accountsGraphQL = createJSAccountsGraphQL(AccountsServer);\n\nexport const schema = mergeTypes([\n\taccountsGraphQL.schema,\n\toauthProviders.schema,\n\tOauthProviderType.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\taccountsGraphQL.extendWithResolvers({}),\n\toauthProviders.resolver\n]);\n","import { HTTP } from 'meteor/http';\nimport { Meteor } from 'meteor/meteor';\n\nimport schema from '../../schemas/accounts/oauthProviders.graphqls';\n\nfunction isJSON(obj) {\n\ttry {\n\t\tJSON.parse(obj);\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nconst resolver = {\n\tQuery: {\n\t\toauthProviders: async() => {\n\t\t\t// depends on rocketchat:grant package\n\t\t\ttry {\n\t\t\t\tconst result = HTTP.get(Meteor.absoluteUrl('_oauth_apps/providers')).content;\n\n\t\t\t\tif (isJSON(result)) {\n\t\t\t\t\tconst providers = JSON.parse(result).data;\n\n\t\t\t\t\treturn providers.map((name) => ({ name }));\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Could not parse the result');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthrow new Error('rocketchat:grant not installed');\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport property from 'lodash.property';\n\nimport schema from '../../schemas/channels/Channel-type.graphqls';\n\nconst resolver = {\n\tChannel: {\n\t\tid: property('_id'),\n\t\tname: (root, args, { user }) => {\n\t\t\tif (root.t === 'd') {\n\t\t\t\treturn root.usernames.find(u => u !== user.username);\n\t\t\t}\n\n\t\t\treturn root.name;\n\t\t},\n\t\tmembers: (root) => {\n\t\t\tconst ids = RocketChat.models.Subscriptions.findByRoomIdWhenUserIdExists(root._id, { fields: { 'u._id': 1 } })\n\t\t\t\t.fetch()\n\t\t\t\t.map(sub => sub.u._id);\n\t\t\treturn RocketChat.models.Users.findByIds(ids).fetch();\n\t\t},\n\t\towners: (root) => {\n\t\t\t// there might be no owner\n\t\t\tif (!root.u) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn [RocketChat.models.Users.findOneByUsername(root.u.username)];\n\t\t},\n\t\tnumberOfMembers: (root) => {\n\t\t\treturn RocketChat.models.Subscriptions.findByRoomId(root._id).count();\n\t\t},\n\t\tnumberOfMessages: property('msgs'),\n\t\treadOnly: (root) => root.ro === true,\n\t\tdirect: (root) => root.t === 'd',\n\t\tprivateChannel: (root) => root.t === 'p',\n\t\tfavourite: (root, args, { user }) => {\n\t\t\tconst room = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(root._id, user._id);\n\n\t\t\treturn room && room.f === true;\n\t\t},\n\t\tunseenMessages: (root, args, { user }) => {\n\t\t\tconst room = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(root._id, user._id);\n\n\t\t\treturn (room || {}).unread;\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import schema from '../../schemas/channels/ChannelFilter-input.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/channels/ChannelNameAndDirect-input.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/channels/ChannelSort-enum.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/channels/Privacy-enum.graphqls';\n\nexport {\n\tschema\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/channelByName.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tchannelByName: authenticated((root, { name }) => {\n\t\t\tconst query = {\n\t\t\t\tname,\n\t\t\t\tt: 'c'\n\t\t\t};\n\n\t\t\treturn RocketChat.models.Rooms.findOne(query, {\n\t\t\t\tfields: roomPublicFields\n\t\t\t});\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/channels.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tchannels: authenticated((root, args) => {\n\t\t\tconst query = {};\n\t\t\tconst options = {\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t},\n\t\t\t\tfields: roomPublicFields\n\t\t\t};\n\n\t\t\t// Filter\n\t\t\tif (typeof args.filter !== 'undefined') {\n\t\t\t\t// nameFilter\n\t\t\t\tif (typeof args.filter.nameFilter !== undefined) {\n\t\t\t\t\tquery.name = {\n\t\t\t\t\t\t$regex: new RegExp(args.filter.nameFilter, 'i')\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// sortBy\n\t\t\t\tif (args.filter.sortBy === 'NUMBER_OF_MESSAGES') {\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// privacy\n\t\t\t\tswitch (args.filter.privacy) {\n\t\t\t\t\tcase 'PRIVATE':\n\t\t\t\t\t\tquery.t = 'p';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'PUBLIC':\n\t\t\t\t\t\tquery.t = {\n\t\t\t\t\t\t\t$ne: 'p'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Rooms.find(query, options).fetch();\n\t\t})\n\t}\n};\n\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/channelsByUser.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tchannelsByUser: authenticated((root, { userId }) => {\n\t\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new Error('No user');\n\t\t\t}\n\n\t\t\tconst roomIds = RocketChat.models.Subscriptions.findByUserId(userId, { fields: { rid: 1 } }).fetch().map(s => s.rid);\n\t\t\tconst rooms = RocketChat.models.Rooms.findByIds(roomIds, {\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t},\n\t\t\t\tfields: roomPublicFields\n\t\t\t}).fetch();\n\n\t\t\treturn rooms;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/channels/createChannel.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tcreateChannel: authenticated((root, args, { user }) => {\n\t\t\ttry {\n\t\t\t\tRocketChat.API.channels.create.validate({\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tvalue: user._id\n\t\t\t\t\t},\n\t\t\t\t\tname: {\n\t\t\t\t\t\tvalue: args.name,\n\t\t\t\t\t\tkey: 'name'\n\t\t\t\t\t},\n\t\t\t\t\tmembers: {\n\t\t\t\t\t\tvalue: args.membersId,\n\t\t\t\t\t\tkey: 'membersId'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tconst { channel } = RocketChat.API.channels.create.execute(user._id, {\n\t\t\t\tname: args.name,\n\t\t\t\tmembers: args.membersId\n\t\t\t});\n\n\t\t\treturn channel;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport { roomPublicFields } from './settings';\nimport schema from '../../schemas/channels/directChannel.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tdirectChannel: authenticated((root, { username, channelId }, { user }) => {\n\t\t\tconst query = {\n\t\t\t\tt: 'd',\n\t\t\t\tusernames: user.username\n\t\t\t};\n\n\t\t\tif (typeof username !== 'undefined') {\n\t\t\t\tif (username === user.username) {\n\t\t\t\t\tthrow new Error('You cannot specify your username');\n\t\t\t\t}\n\n\t\t\t\tquery.usernames = { $all: [ user.username, username ] };\n\t\t\t} else if (typeof channelId !== 'undefined') {\n\t\t\t\tquery.id = channelId;\n\t\t\t} else {\n\t\t\t\tthrow new Error('Use one of those fields: username, channelId');\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Rooms.findOne(query, {\n\t\t\t\tfields: roomPublicFields\n\t\t\t});\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/channels/hideChannel.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\thideChannel: authenticated((root, args, { user }) => {\n\t\t\tconst channel = RocketChat.models.Rooms.findOne({\n\t\t\t\t_id: args.channelId,\n\t\t\t\tt: 'c'\n\t\t\t});\n\n\t\t\tif (!channel) {\n\t\t\t\tthrow new Error('error-room-not-found', 'The required \"channelId\" param provided does not match any channel');\n\t\t\t}\n\n\t\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(channel._id, user._id);\n\n\t\t\tif (!sub) {\n\t\t\t\tthrow new Error(`The user/callee is not in the channel \"${ channel.name }.`);\n\t\t\t}\n\n\t\t\tif (!sub.open) {\n\t\t\t\tthrow new Error(`The channel, ${ channel.name }, is already closed to the sender`);\n\t\t\t}\n\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('hideRoom', channel._id);\n\t\t\t});\n\n\t\t\treturn true;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// queries\nimport * as channels from './channels';\nimport * as channelByName from './channelByName';\nimport * as directChannel from './directChannel';\nimport * as channelsByUser from './channelsByUser';\n// mutations\nimport * as createChannel from './createChannel';\nimport * as leaveChannel from './leaveChannel';\nimport * as hideChannel from './hideChannel';\n// types\nimport * as ChannelType from './Channel-type';\nimport * as ChannelSort from './ChannelSort-enum';\nimport * as ChannelFilter from './ChannelFilter-input';\nimport * as Privacy from './Privacy-enum';\nimport * as ChannelNameAndDirect from './ChannelNameAndDirect-input';\n\nexport const schema = mergeTypes([\n\t// queries\n\tchannels.schema,\n\tchannelByName.schema,\n\tdirectChannel.schema,\n\tchannelsByUser.schema,\n\t// mutations\n\tcreateChannel.schema,\n\tleaveChannel.schema,\n\thideChannel.schema,\n\t// types\n\tChannelType.schema,\n\tChannelSort.schema,\n\tChannelFilter.schema,\n\tPrivacy.schema,\n\tChannelNameAndDirect.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\t// queries\n\tchannels.resolver,\n\tchannelByName.resolver,\n\tdirectChannel.resolver,\n\tchannelsByUser.resolver,\n\t// mutations\n\tcreateChannel.resolver,\n\tleaveChannel.resolver,\n\thideChannel.resolver,\n\t// types\n\tChannelType.resolver\n]);\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/channels/leaveChannel.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tleaveChannel: authenticated((root, args, { user }) => {\n\t\t\tconst channel = RocketChat.models.Rooms.findOne({\n\t\t\t\t_id: args.channelId,\n\t\t\t\tt: 'c'\n\t\t\t});\n\n\t\t\tif (!channel) {\n\t\t\t\tthrow new Error('error-room-not-found', 'The required \"channelId\" param provided does not match any channel');\n\t\t\t}\n\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('leaveRoom', channel._id);\n\t\t\t});\n\n\t\t\treturn true;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","export const roomPublicFields = {\n\tt: 1,\n\tname: 1,\n\tdescription: 1,\n\tannouncement: 1,\n\ttopic: 1,\n\tusernames: 1,\n\tmsgs: 1,\n\tro: 1,\n\tu: 1,\n\tarchived: 1\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport property from 'lodash.property';\n\nimport { dateToFloat } from '../../helpers/dateToFloat';\nimport schema from '../../schemas/messages/Message-type.graphqls';\n\nconst resolver = {\n\tMessage: {\n\t\tid: property('_id'),\n\t\tcontent: property('msg'),\n\t\tcreationTime: (root) => dateToFloat(root.ts),\n\t\tauthor: (root) => {\n\t\t\tconst user = RocketChat.models.Users.findOne(root.u._id);\n\n\t\t\treturn user || root.u;\n\t\t},\n\t\tchannel: (root) => {\n\t\t\treturn RocketChat.models.Rooms.findOne(root.rid);\n\t\t},\n\t\tfromServer: (root) => typeof root.t !== 'undefined', // on a message sent by user `true` otherwise `false`\n\t\ttype: property('t'),\n\t\tchannelRef: (root) => {\n\t\t\tif (!root.channels) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: root.channels.map(c => c._id)\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tsort: {\n\t\t\t\t\tname: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t},\n\t\tuserRef: (root) => {\n\t\t\tif (!root.mentions) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: root.mentions.map(c => c._id)\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tsort: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t},\n\t\treactions: (root) => {\n\t\t\tif (!root.reactions || Object.keys(root.reactions).length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst reactions = [];\n\n\t\t\tObject.keys(root.reactions).forEach(icon => {\n\t\t\t\troot.reactions[icon].usernames.forEach(username => {\n\t\t\t\t\treactions.push({\n\t\t\t\t\t\ticon,\n\t\t\t\t\t\tusername\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn reactions;\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import schema from '../../schemas/messages/MessageIdentifier-input.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/messages/MessagesWithCursor-type.graphqls';\n\nexport {\n\tschema\n};\n","import schema from '../../schemas/messages/Reaction-type.graphqls';\n\nexport {\n\tschema\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/addReactionToMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\taddReactionToMessage: authenticated((root, { id, icon }, { user }) => {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\t\tMeteor.call('setReaction', id.messageId, icon, () => {\n\t\t\t\t\t\tresolve(RocketChat.models.Messages.findOne(id.messageId));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { withFilter } from 'graphql-subscriptions';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { pubsub } from '../../subscriptions';\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/chatMessageAdded.graphqls';\n\nexport const CHAT_MESSAGE_SUBSCRIPTION_TOPIC = 'CHAT_MESSAGE_ADDED';\n\nexport function publishMessage(message) {\n\tpubsub.publish(CHAT_MESSAGE_SUBSCRIPTION_TOPIC, { chatMessageAdded: message });\n}\n\nfunction shouldPublish(message, { id, directTo }, username) {\n\tif (id) {\n\t\treturn message.rid === id;\n\t} else if (directTo) {\n\t\tconst room = RocketChat.models.Rooms.findOne({\n\t\t\tusernames: { $all: [directTo, username] },\n\t\t\tt: 'd'\n\t\t});\n\n\t\treturn room && room._id === message.rid;\n\t}\n\n\treturn false;\n}\n\nconst resolver = {\n\tSubscription: {\n\t\tchatMessageAdded: {\n\t\t\tsubscribe: withFilter(() => pubsub.asyncIterator(CHAT_MESSAGE_SUBSCRIPTION_TOPIC), authenticated((payload, args, { user }) => {\n\t\t\t\tconst channel = {\n\t\t\t\t\tid: args.channelId,\n\t\t\t\t\tdirectTo: args.directTo\n\t\t\t\t};\n\n\t\t\t\treturn shouldPublish(payload.chatMessageAdded, channel, user.username);\n\t\t\t}))\n\t\t}\n\t}\n};\n\nRocketChat.callbacks.add('afterSaveMessage', (message) => {\n\tpublishMessage(message);\n}, null, 'chatMessageAddedSubscription');\n\nexport {\n\tschema,\n\tresolver\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/deleteMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tdeleteMessage: authenticated((root, { id }, { user }) => {\n\t\t\tconst msg = RocketChat.models.Messages.findOneById(id.messageId, { fields: { u: 1, rid: 1 }});\n\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error(`No message found with the id of \"${ id.messageId }\".`);\n\t\t\t}\n\n\t\t\tif (id.channelId !== msg.rid) {\n\t\t\t\tthrow new Error('The room id provided does not match where the message is from.');\n\t\t\t}\n\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t\t});\n\n\t\t\treturn msg;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/editMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\teditMessage: authenticated((root, { id, content }, { user }) => {\n\t\t\tconst msg = RocketChat.models.Messages.findOneById(id.messageId);\n\n\t\t\t//Ensure the message exists\n\t\t\tif (!msg) {\n\t\t\t\tthrow new Error(`No message found with the id of \"${ id.messageId }\".`);\n\t\t\t}\n\n\t\t\tif (id.channelId !== msg.rid) {\n\t\t\t\tthrow new Error('The channel id provided does not match where the message is from.');\n\t\t\t}\n\n\t\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\t\tMeteor.runAsUser(user._id, () => {\n\t\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: content, rid: msg.rid });\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Messages.findOneById(msg._id);\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// queries\nimport * as messages from './messages';\n// mutations\nimport * as sendMessage from './sendMessage';\nimport * as editMessage from './editMessage';\nimport * as deleteMessage from './deleteMessage';\nimport * as addReactionToMessage from './addReactionToMessage';\n// subscriptions\nimport * as chatMessageAdded from './chatMessageAdded';\n// types\nimport * as MessageType from './Message-type';\nimport * as MessagesWithCursorType from './MessagesWithCursor-type';\nimport * as MessageIdentifier from './MessageIdentifier-input';\nimport * as ReactionType from './Reaction-type';\n\nexport const schema = mergeTypes([\n\t// queries\n\tmessages.schema,\n\t// mutations\n\tsendMessage.schema,\n\teditMessage.schema,\n\tdeleteMessage.schema,\n\taddReactionToMessage.schema,\n\t// subscriptions\n\tchatMessageAdded.schema,\n\t// types\n\tMessageType.schema,\n\tMessagesWithCursorType.schema,\n\tMessageIdentifier.schema,\n\tReactionType.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\t// queries\n\tmessages.resolver,\n\t// mutations\n\tsendMessage.resolver,\n\teditMessage.resolver,\n\tdeleteMessage.resolver,\n\taddReactionToMessage.resolver,\n\t// subscriptions\n\tchatMessageAdded.resolver,\n\t// types\n\tMessageType.resolver\n]);\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/messages.graphqls';\n\nconst resolver = {\n\tQuery: {\n\t\tmessages: authenticated((root, args, { user }) => {\n\t\t\tconst messagesQuery = {};\n\t\t\tconst messagesOptions = {\n\t\t\t\tsort: { ts: -1 }\n\t\t\t};\n\t\t\tconst channelQuery = {};\n\t\t\tconst isPagination = !!args.cursor || args.count > 0;\n\t\t\tlet cursor;\n\n\t\t\tif (args.channelId) {\n\t\t\t\t// channelId\n\t\t\t\tchannelQuery._id = args.channelId;\n\t\t\t} else if (args.directTo) {\n\t\t\t\t// direct message where directTo is a user id\n\t\t\t\tchannelQuery.t = 'd';\n\t\t\t\tchannelQuery.usernames = { $all: [args.directTo, user.username] };\n\t\t\t} else if (args.channelName) {\n\t\t\t\t// non-direct channel\n\t\t\t\tchannelQuery.t = { $ne: 'd' };\n\t\t\t\tchannelQuery.name = args.channelName;\n\t\t\t} else {\n\t\t\t\tconsole.error('messages query must be called with channelId or directTo');\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst channel = RocketChat.models.Rooms.findOne(channelQuery);\n\n\t\t\tlet messagesArray = [];\n\n\t\t\tif (channel) {\n\t\t\t\t// cursor\n\t\t\t\tif (isPagination && args.cursor) {\n\t\t\t\t\tconst cursorMsg = RocketChat.models.Messages.findOne(args.cursor, { fields: { ts: 1 } });\n\t\t\t\t\tmessagesQuery.ts = { $lt: cursorMsg.ts };\n\t\t\t\t}\n\n\t\t\t\t// search\n\t\t\t\tif (typeof args.searchRegex === 'string') {\n\t\t\t\t\tmessagesQuery.msg = {\n\t\t\t\t\t\t$regex: new RegExp(args.searchRegex, 'i')\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// count\n\t\t\t\tif (isPagination && args.count) {\n\t\t\t\t\tmessagesOptions.limit = args.count;\n\t\t\t\t}\n\n\t\t\t\t// exclude messages generated by server\n\t\t\t\tif (args.excludeServer === true) {\n\t\t\t\t\tmessagesQuery.t = { $exists: false };\n\t\t\t\t}\n\n\t\t\t\t// look for messages that belongs to specific channel\n\t\t\t\tmessagesQuery.rid = channel._id;\n\n\t\t\t\tconst messages = RocketChat.models.Messages.find(messagesQuery, messagesOptions);\n\n\t\t\t\tmessagesArray = messages.fetch();\n\n\t\t\t\tif (isPagination) {\n\t\t\t\t\t// oldest first (because of findOne)\n\t\t\t\t\tmessagesOptions.sort.ts = 1;\n\n\t\t\t\t\tconst firstMessage = RocketChat.models.Messages.findOne(messagesQuery, messagesOptions);\n\t\t\t\t\tconst lastId = (messagesArray[messagesArray.length - 1] || {})._id;\n\n\t\t\t\t\tcursor = !lastId || lastId === firstMessage._id ? null : lastId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcursor,\n\t\t\t\tchannel,\n\t\t\t\tmessagesArray\n\t\t\t};\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","/* global processWebhookMessage */\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/messages/sendMessage.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tsendMessage: authenticated((root, { channelId, directTo, content }, { user }) => {\n\t\t\tconst options = {\n\t\t\t\ttext: content,\n\t\t\t\tchannel: channelId || directTo\n\t\t\t};\n\n\t\t\tconst messageReturn = processWebhookMessage(options, user)[0];\n\n\t\t\tif (!messageReturn) {\n\t\t\t\tthrow new Error('Unknown error');\n\t\t\t}\n\n\t\t\treturn messageReturn.message;\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport property from 'lodash.property';\n\nimport schema from '../../schemas/users/User-type.graphqls';\n\nconst resolver = {\n\tUser: {\n\t\tid: property('_id'),\n\t\tstatus: ({status}) => status.toUpperCase(),\n\t\tavatar: async({ _id }) => {\n\t\t\t// XXX js-accounts/graphql#16\n\t\t\tconst avatar = await RocketChat.models.Avatars.model.rawCollection().findOne({\n\t\t\t\tuserId: _id\n\t\t\t}, { fields: { url: 1 }});\n\n\t\t\tif (avatar) {\n\t\t\t\treturn avatar.url;\n\t\t\t}\n\t\t},\n\t\tchannels: Meteor.bindEnvironment(async({ _id }) => {\n\t\t\treturn await RocketChat.models.Rooms.findBySubscriptionUserId(_id).fetch();\n\t\t}),\n\t\tdirectMessages: ({ username }) => {\n\t\t\treturn RocketChat.models.Rooms.findDirectRoomContainingUsername(username).fetch();\n\t\t}\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n","import schema from '../../schemas/users/UserStatus-enum.graphqls';\n\nexport {\n\tschema\n};\n","import { mergeTypes, mergeResolvers } from 'merge-graphql-schemas';\n\n// mutations\nimport * as setStatus from './setStatus';\n// types\nimport * as UserType from './User-type';\nimport * as UserStatus from './UserStatus-enum';\n\nexport const schema = mergeTypes([\n\t// mutations\n\tsetStatus.schema,\n\t// types\n\tUserType.schema,\n\tUserStatus.schema\n]);\n\nexport const resolvers = mergeResolvers([\n\t// mutations\n\tsetStatus.resolver,\n\t// types\n\tUserType.resolver\n]);\n","import { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { authenticated } from '../../helpers/authenticated';\nimport schema from '../../schemas/users/setStatus.graphqls';\n\nconst resolver = {\n\tMutation: {\n\t\tsetStatus: authenticated((root, { status }, { user }) => {\n\t\t\tRocketChat.models.Users.update(user._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tstatus: status.toLowerCase()\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Users.findOne(user._id);\n\t\t})\n\t}\n};\n\nexport {\n\tschema,\n\tresolver\n};\n"]}