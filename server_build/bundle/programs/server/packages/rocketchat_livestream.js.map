{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:livestream/server/index.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/functions/saveStreamingOptions.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/functions/livestream.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/methods.js","meteor://ðŸ’»app/packages/rocketchat:livestream/server/routes.js"],"names":["module","watch","require","RocketChat","models","Rooms","setStreamingOptionsById","_id","streamingOptions","update","$set","saveStreamingOptions","rid","Match","test","String","Meteor","Error","export","getBroadcastStatus","statusStreamLiveStream","statusLiveStream","setBroadcastStatus","createLiveStream","google","default","v","OAuth2","auth","p","fn","Promise","resolve","reject","err","value","data","id","access_token","refresh_token","clientId","clientSecret","setCredentials","youtube","version","result","liveBroadcasts","list","part","items","status","lifeCycleStatus","liveStreams","streamStatus","transition","broadcastStatus","room","stream","broadcast","all","insert","resource","snippet","name","Date","toISOString","bind","streamId","cdn","ingestionInfo","streamName","startup","settings","addGroup","add","type","public","alert","enableQuery","selectLivestreamSettings","user","livestream","methods","livestreamStreamStatus","method","livestreamSettings","get","setLivestreamStatus","broadcastId","livestreamGet","findOne","API","v1","addRoute","functionName","clientAuth","replace","userId","queryParams","url","generateAuthUrl","access_type","scope","state","JSON","stringify","statusCode","headers","Location","body","code","parse","ret","wrapAsync","getToken","Users"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAAA,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb;AAAqCF,OAAOC,KAAP,CAAaC,QAAQ,cAAR,CAAb,E;;;;;;;;;;;ACArCC,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,uBAAxB,GAAkD,UAASC,GAAT,EAAcC,gBAAd,EAAgC;AACjF,QAAMC,SAAS;AACdC,UAAM;AACLF;AADK;AADQ,GAAf;AAKA,SAAO,KAAKC,MAAL,CAAY;AAAEF;AAAF,GAAZ,EAAqBE,MAArB,CAAP;AACA,CAPD,C;;;;;;;;;;;ACAAN,WAAWQ,oBAAX,GAAkC,UAASC,GAAT,EAAcJ,gBAAd,EAAgC;AACjE,MAAI,CAACK,MAAMC,IAAN,CAAWF,GAAX,EAAgBG,MAAhB,CAAL,EAA8B;AAC7B,UAAM,IAAIC,OAAOC,KAAX,CAAiB,cAAjB,EAAiC,cAAjC,EAAiD;AACtD,kBAAY;AAD0C,KAAjD,CAAN;AAGA;;AAED,SAAOd,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,uBAAxB,CAAgDM,GAAhD,EAAqDJ,gBAArD,CAAP;AACA,CARD,C;;;;;;;;;;;ACAAR,OAAOkB,MAAP,CAAc;AAACC,sBAAmB,MAAIA,kBAAxB;AAA2CC,0BAAuB,MAAIA,sBAAtE;AAA6FC,oBAAiB,MAAIA,gBAAlH;AAAmIC,sBAAmB,MAAIA,kBAA1J;AAA6KC,oBAAiB,MAAIA;AAAlM,CAAd;AAAmO,IAAIC,MAAJ;AAAWxB,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACuB,UAAQC,CAAR,EAAU;AAACF,aAAOE,CAAP;AAAS;;AAArB,CAAnC,EAA0D,CAA1D;AAC9O,MAAMC,SAASH,OAAOI,IAAP,CAAYD,MAA3B;;AAGA,MAAME,IAAIC,MAAM,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AACrDH,KAAG,UAASI,GAAT,EAAcC,KAAd,EAAqB;AACvB,QAAID,GAAJ,EAAS;AACR,aAAOD,OAAOC,GAAP,CAAP;AACA;;AACDF,YAAQG,MAAMC,IAAd;AACA,GALD;AAMA,CAPe,CAAhB;;AASO,MAAMjB,qBAAqB,CAAM;AACvCkB,IADuC;AAEvCC,cAFuC;AAGvCC,eAHuC;AAIvCC,UAJuC;AAKvCC;AALuC,CAAN,8BAM5B;AACL,QAAMb,OAAO,IAAID,MAAJ,CAAWa,QAAX,EAAqBC,YAArB,CAAb;AAEAb,OAAKc,cAAL,CAAoB;AACnBJ,gBADmB;AAEnBC;AAFmB,GAApB;AAIA,QAAMI,UAAUnB,OAAOmB,OAAP,CAAe;AAAEC,aAAQ,IAAV;AAAgBhB;AAAhB,GAAf,CAAhB;AACA,QAAMiB,uBAAehB,EAAEG,WAAWW,QAAQG,cAAR,CAAuBC,IAAvB,CAA4B;AAC7DC,UAAK,WADwD;AAE7DX;AAF6D,GAA5B,EAG/BL,OAH+B,CAAb,CAAf,CAAN;AAIA,SAAOa,OAAOI,KAAP,IAAgBJ,OAAOI,KAAP,CAAa,CAAb,CAAhB,IAAmCJ,OAAOI,KAAP,CAAa,CAAb,EAAgBC,MAAhB,CAAuBC,eAAjE;AACA,CAnBiC,CAA3B;;AAqBA,MAAM/B,yBAAyB,CAAM;AAC3CiB,IAD2C;AAE3CC,cAF2C;AAG3CC,eAH2C;AAI3CC,UAJ2C;AAK3CC;AAL2C,CAAN,8BAMhC;AACL,QAAMb,OAAO,IAAID,MAAJ,CAAWa,QAAX,EAAqBC,YAArB,CAAb;AAEAb,OAAKc,cAAL,CAAoB;AACnBJ,gBADmB;AAEnBC;AAFmB,GAApB;AAKA,QAAMI,UAAUnB,OAAOmB,OAAP,CAAe;AAAEC,aAAQ,IAAV;AAAgBhB;AAAhB,GAAf,CAAhB;AACA,QAAMiB,uBAAehB,EAAEG,WAAWW,QAAQS,WAAR,CAAoBL,IAApB,CAAyB;AAC1DC,UAAK,WADqD;AAE1DX;AAF0D,GAAzB,EAG/BL,OAH+B,CAAb,CAAf,CAAN;AAIA,SAAOa,OAAOI,KAAP,IAAgBJ,OAAOI,KAAP,CAAa,CAAb,EAAgBC,MAAhB,CAAuBG,YAA9C;AACA,CApBqC,CAA/B;;AAsBA,MAAMhC,mBAAmB,CAAC;AAChCgB,IADgC;AAEhCC,cAFgC;AAGhCC,eAHgC;AAIhCC,UAJgC;AAKhCC,cALgC;AAMhCS;AANgC,CAAD,KAO1B;AACL,QAAMtB,OAAO,IAAID,MAAJ,CAAWa,QAAX,EAAqBC,YAArB,CAAb;AAEAb,OAAKc,cAAL,CAAoB;AACnBJ,gBADmB;AAEnBC;AAFmB,GAApB;AAKA,QAAMI,UAAUnB,OAAOmB,OAAP,CAAe;AAAEC,aAAQ,IAAV;AAAgBhB;AAAhB,GAAf,CAAhB;AAEA,SAAOC,EAAEG,WAAWW,QAAQG,cAAR,CAAuBQ,UAAvB,CAAkC;AACrDN,UAAK,WADgD;AAErDX,MAFqD;AAGrDkB,qBAAiBL;AAHoC,GAAlC,EAIjBlB,OAJiB,CAAb,CAAP;AAKA,CAtBM;;AAwBA,MAAMV,qBAAqB,CAAC;AAClCe,IADkC;AAElCC,cAFkC;AAGlCC,eAHkC;AAIlCC,UAJkC;AAKlCC,cALkC;AAMlCS;AANkC,CAAD,KAO5B;AACL,QAAMtB,OAAO,IAAID,MAAJ,CAAWa,QAAX,EAAqBC,YAArB,CAAb;AAEAb,OAAKc,cAAL,CAAoB;AACnBJ,gBADmB;AAEnBC;AAFmB,GAApB;AAKA,QAAMI,UAAUnB,OAAOmB,OAAP,CAAe;AAAEC,aAAQ,IAAV;AAAgBhB;AAAhB,GAAf,CAAhB;AAEA,SAAOC,EAAEG,WAAWW,QAAQG,cAAR,CAAuBQ,UAAvB,CAAkC;AACrDN,UAAK,WADgD;AAErDX,MAFqD;AAGrDkB,qBAAiBL;AAHoC,GAAlC,EAIjBlB,OAJiB,CAAb,CAAP;AAKA,CAtBM;;AAwBA,MAAMT,mBAAmB,CAAM;AACrCiC,MADqC;AAErClB,cAFqC;AAGrCC,eAHqC;AAIrCC,UAJqC;AAKrCC;AALqC,CAAN,8BAM1B;AACL,QAAMb,OAAO,IAAID,MAAJ,CAAWa,QAAX,EAAqBC,YAArB,CAAb;AACAb,OAAKc,cAAL,CAAoB;AACnBJ,gBADmB;AAEnBC;AAFmB,GAApB;AAIA,QAAMI,UAAUnB,OAAOmB,OAAP,CAAe;AAAEC,aAAQ,IAAV;AAAgBhB;AAAhB,GAAf,CAAhB;AAEA,QAAM,CAAC6B,MAAD,EAASC,SAAT,kBAA4B3B,QAAQ4B,GAAR,CAAY,CAAC9B,EAAGG,OAAD,IAAaW,QAAQS,WAAR,CAAoBQ,MAApB,CAA2B;AACxFZ,UAAM,sCADkF;AAExFa,cAAU;AACTC,eAAS;AACR,iBAASN,KAAKO,IAAL,IAAa;AADd,OADA;AAIT,aAAO;AACN,kBAAU,MADJ;AAEN,yBAAiB;AAFX;AAJE;AAF8E,GAA3B,EAW3D/B,OAX2D,CAAf,CAAD,EAWhCH,EAAGG,OAAD,IAAYW,QAAQG,cAAR,CAAuBc,MAAvB,CAA8B;AACzDZ,UAAM,kCADmD;AAEzDa,cAAU;AACTC,eAAS;AACR,iBAASN,KAAKO,IAAL,IAAa,sBADd;AAER,8BAAuB,IAAIC,IAAJ,GAAWC,WAAX;AAFf,OADA;AAKT,gBAAU;AACT,yBAAiB;AADR;AALD;AAF+C,GAA9B,EAWzBjC,OAXyB,CAAd,CAXgC,CAAZ,CAA5B,CAAN;AAwBA,gBAAMH,EAAEG,WAAWW,QAAQG,cAAR,CAAuBoB,IAAvB,CAA4B;AAC9ClB,UAAM,mBADwC;AAE9C;AACAX,QAAIqB,UAAUrB,EAHgC;AAI9C8B,cAAUV,OAAOpB;AAJ6B,GAA5B,EAKhBL,OALgB,CAAb,CAAN;AAOA,SAAO;AAACK,QAAIoB,OAAOW,GAAP,CAAWC,aAAX,CAAyBC,UAA9B;AAA0Cb,UAA1C;AAAkDC;AAAlD,GAAP;AACA,CA9C+B,CAAzB,C;;;;;;;;;;;ACxGP1C,OAAOuD,OAAP,CAAe,YAAW;AACzBpE,aAAWqE,QAAX,CAAoBC,QAApB,CAA6B,2BAA7B,EAA0D,YAAW;AAEpE,SAAKC,GAAL,CAAS,oBAAT,EAA+B,KAA/B,EAAsC;AACrCC,YAAM,SAD+B;AAErCC,cAAQ,IAF6B;AAGrCC,aAAO;AAH8B,KAAtC;AAMA,SAAKH,GAAL,CAAS,sBAAT,EAAiC,KAAjC,EAAwC;AACvCC,YAAM,SADiC;AAEvCC,cAAQ,IAF+B;AAGvCC,aAAO,mGAHgC;AAIvCC,mBAAa;AAAEvE,aAAK,oBAAP;AAA6B4B,eAAO;AAApC;AAJ0B,KAAxC;AAOA,SAAKuC,GAAL,CAAS,wBAAT,EAAmC,EAAnC,EAAuC;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,KAA1B;AAAiCE,mBAAa;AAAEvE,aAAK,sBAAP;AAA+B4B,eAAO;AAAtC;AAA9C,KAAvC;AACA,SAAKuC,GAAL,CAAS,4BAAT,EAAuC,EAAvC,EAA2C;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,KAA1B;AAAiCE,mBAAa;AAAEvE,aAAK,sBAAP;AAA+B4B,eAAO;AAAtC;AAA9C,KAA3C;AACA,SAAKuC,GAAL,CAAS,sBAAT,EAAiC,EAAjC,EAAqC;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,KAA1B;AAAiCE,mBAAa;AAAEvE,aAAK,sBAAP;AAA+B4B,eAAO;AAAtC;AAA9C,KAArC;AACA,SAAKuC,GAAL,CAAS,+BAAT,EAA0C,EAA1C,EAA8C;AAAEC,YAAM,QAAR;AAAkBC,cAAQ,IAA1B;AAAgCE,mBAAa;AAAEvE,aAAK,sBAAP;AAA+B4B,eAAO;AAAtC;AAA7C,KAA9C;AACA,GAnBD;AAoBA,CArBD,E;;;;;;;;;;;ACAA,IAAInB,MAAJ;AAAWhB,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAACc,SAAOU,CAAP,EAAS;AAACV,aAAOU,CAAP;AAAS;;AAApB,CAAtC,EAA4D,CAA5D;AAA+D,IAAIH,gBAAJ,EAAqBF,gBAArB,EAAsCD,sBAAtC,EAA6DD,kBAA7D,EAAgFG,kBAAhF;AAAmGtB,OAAOC,KAAP,CAAaC,QAAQ,wBAAR,CAAb,EAA+C;AAACqB,mBAAiBG,CAAjB,EAAmB;AAACH,uBAAiBG,CAAjB;AAAmB,GAAxC;;AAAyCL,mBAAiBK,CAAjB,EAAmB;AAACL,uBAAiBK,CAAjB;AAAmB,GAAhF;;AAAiFN,yBAAuBM,CAAvB,EAAyB;AAACN,6BAAuBM,CAAvB;AAAyB,GAApI;;AAAqIP,qBAAmBO,CAAnB,EAAqB;AAACP,yBAAmBO,CAAnB;AAAqB,GAAhL;;AAAiLJ,qBAAmBI,CAAnB,EAAqB;AAACJ,yBAAmBI,CAAnB;AAAqB;;AAA5N,CAA/C,EAA6Q,CAA7Q;;AAG7K,MAAMqD,2BAA4BC,IAAD,IAAUA,QAAQA,KAAKR,QAAb,IAAyBQ,KAAKR,QAAL,CAAcS,UAAlF;;AAEAjE,OAAOkE,OAAP,CAAe;AAERC,wBAAN,CAA6B;AAAChB;AAAD,GAA7B;AAAA,oCAAyC;AACxC,UAAI,CAACA,QAAL,EAAe;AACd;AACA,cAAM,IAAInD,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,yBAAtC,EAAiE;AACtEmE,kBAAQ;AAD8D,SAAjE,CAAN;AAGA;;AACD,YAAMC,qBAAqBN,yBAAyB/D,OAAOgE,IAAP,EAAzB,CAA3B;;AAEA,UAAI,CAACK,kBAAL,EAAyB;AACxB,cAAM,IAAIrE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,gCAAtC,EAAwE;AAC7EmE,kBAAQ;AADqE,SAAxE,CAAN;AAGA;;AAED,YAAM;AAAC9C,oBAAD;AAAeC;AAAf,UAAgC8C,kBAAtC;AAEA,2BAAajE,uBAAuB;AACnCiB,YAAI8B,QAD+B;AAEnC7B,oBAFmC;AAGnCC,qBAHmC;AAInCC,kBAAUrC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CAJyB;AAKnC7C,sBAActC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB;AALqB,OAAvB,CAAb;AAQA,KAzBD;AAAA,GAFc;;AA4BRC,qBAAN,CAA0B;AAACC,eAAD;AAActC;AAAd,GAA1B;AAAA,oCAAiD;AAChD,UAAI,CAACsC,WAAL,EAAkB;AACjB;AACA,cAAM,IAAIxE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,oCAAtC,EAA4E;AACjFmE,kBAAQ;AADyE,SAA5E,CAAN;AAGA;;AACD,YAAMC,qBAAqBN,yBAAyB/D,OAAOgE,IAAP,EAAzB,CAA3B;;AAEA,UAAI,CAACK,kBAAL,EAAyB;AACxB,cAAM,IAAIrE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,oCAAtC,EAA4E;AACjFmE,kBAAQ;AADyE,SAA5E,CAAN;AAGA;;AAED,YAAM;AAAC9C,oBAAD;AAAeC;AAAf,UAAgC8C,kBAAtC;AAEA,2BAAahE,iBAAiB;AAC7BgB,YAAImD,WADyB;AAE7BlD,oBAF6B;AAG7BC,qBAH6B;AAI7BW,cAJ6B;AAK7BV,kBAAUrC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CALmB;AAM7B7C,sBAActC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB;AANe,OAAjB,CAAb;AASA,KA1BD;AAAA,GA5Bc;;AAuDRG,eAAN,CAAoB;AAAC7E;AAAD,GAApB;AAAA,oCAA2B;AAC1B,YAAMyE,qBAAqBN,yBAAyB/D,OAAOgE,IAAP,EAAzB,CAA3B;;AAEA,UAAI,CAACK,kBAAL,EAAyB;AACxB,cAAM,IAAIrE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,oCAAtC,EAA4E;AACjFmE,kBAAQ;AADyE,SAA5E,CAAN;AAGA;;AAED,YAAM5B,OAAOrD,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBqF,OAAxB,CAAgC;AAACnF,aAAKK;AAAN,OAAhC,CAAb;;AAEA,UAAI,CAAC4C,IAAL,EAAW;AACV;AACA,cAAM,IAAIxC,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,oCAAtC,EAA4E;AACjFmE,kBAAQ;AADyE,SAA5E,CAAN;AAGA;;AAED,YAAM;AAAC9C,oBAAD;AAAeC;AAAf,UAAgC8C,kBAAtC;AACA,2BAAa9D,iBAAiB;AAC7BiC,YAD6B;AAE7BlB,oBAF6B;AAG7BC,qBAH6B;AAI7BC,kBAAUrC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CAJmB;AAK7B7C,sBAActC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB;AALe,OAAjB,CAAb;AAQA,KA3BD;AAAA,GAvDc;;AAmFRnE,oBAAN,CAAyB;AAACqE;AAAD,GAAzB;AAAA,oCAAwC;AACvC,UAAI,CAACA,WAAL,EAAkB;AACjB;AACA,cAAM,IAAIxE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,wBAAtC,EAAgE;AACrEmE,kBAAQ;AAD6D,SAAhE,CAAN;AAGA;;AACD,YAAMC,qBAAqBN,yBAAyB/D,OAAOgE,IAAP,EAAzB,CAA3B;;AAEA,UAAI,CAACK,kBAAL,EAAyB;AACxB,cAAM,IAAIrE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,gCAAtC,EAAwE;AAC7EmE,kBAAQ;AADqE,SAAxE,CAAN;AAGA;;AAED,YAAM;AAAC9C,oBAAD;AAAeC;AAAf,UAAgC8C,kBAAtC;AAEA,2BAAalE,mBAAmB;AAC/BkB,YAAImD,WAD2B;AAE/BlD,oBAF+B;AAG/BC,qBAH+B;AAI/BC,kBAAUrC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CAJqB;AAK/B7C,sBAActC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB;AALiB,OAAnB,CAAb;AAOA,KAxBD;AAAA,GAnFc;;AA4GRhE,oBAAN,CAAyB;AAACkE,eAAD;AAActC;AAAd,GAAzB;AAAA,oCAAgD;AAC/C,UAAI,CAACsC,WAAL,EAAkB;AACjB;AACA,cAAM,IAAIxE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,wBAAtC,EAAgE;AACrEmE,kBAAQ;AAD6D,SAAhE,CAAN;AAGA;;AACD,YAAMC,qBAAqBN,yBAAyB/D,OAAOgE,IAAP,EAAzB,CAA3B;;AAEA,UAAI,CAACK,kBAAL,EAAyB;AACxB,cAAM,IAAIrE,OAAOC,KAAX,CAAiB,mBAAjB,EAAsC,gCAAtC,EAAwE;AAC7EmE,kBAAQ;AADqE,SAAxE,CAAN;AAGA;;AAED,YAAM;AAAC9C,oBAAD;AAAeC;AAAf,UAAgC8C,kBAAtC;AAEA,2BAAa/D,mBAAmB;AAC/Be,YAAImD,WAD2B;AAE/BlD,oBAF+B;AAG/BC,qBAH+B;AAI/BW,cAJ+B;AAK/BV,kBAAUrC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CALqB;AAM/B7C,sBAActC,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB;AANiB,OAAnB,CAAb;AASA,KA1BD;AAAA;;AA5Gc,CAAf,E;;;;;;;;;;;ACLA,IAAI9D,MAAJ;AAAWxB,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACuB,UAAQC,CAAR,EAAU;AAACF,aAAOE,CAAP;AAAS;;AAArB,CAAnC,EAA0D,CAA1D;AACX,MAAMC,SAASH,OAAOI,IAAP,CAAYD,MAA3B;AAEAxB,WAAWwF,GAAX,CAAeC,EAAf,CAAkBC,QAAlB,CAA2B,kBAA3B,EAA+C;AAC9CP,OAAK,SAASQ,YAAT,GAAwB;AAC5B,UAAMC,aAAa,IAAIpE,MAAJ,CAAWxB,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CAAX,EAA8DnF,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB,CAA9D,EAAsH,GAAGnF,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,UAAxB,CAAqC,mCAAzC,CAA4EU,OAA5E,CAAoF,WAApF,EAAiG,MAAjG,CAArH,CAAnB;AACA,UAAM;AAAEC;AAAF,QAAa,KAAKC,WAAxB;AACA,UAAMC,MAAMJ,WAAWK,eAAX,CAA2B;AACtCC,mBAAa,SADyB;AAEtCC,aAAO,CAAC,yCAAD,CAF+B;AAGtCC,aAAOC,KAAKC,SAAL,CAAe;AACrBR;AADqB,OAAf;AAH+B,KAA3B,CAAZ;AAQA,WAAO;AACNS,kBAAY,GADN;AAENC,eAAS;AACRC,kBAAUT;AADF,OAFH;AAIHU,YAAM;AAJH,KAAP;AAMA;AAlB6C,CAA/C;AAqBA1G,WAAWwF,GAAX,CAAeC,EAAf,CAAkBC,QAAlB,CAA2B,2BAA3B,EAAwD;AACvDP,OAAK,SAASQ,YAAT,GAAwB;AAC5B,UAAM;AAAEgB,UAAF;AAAQP;AAAR,QAAkB,KAAKL,WAA7B;AAEA,UAAM;AAAED;AAAF,QAAaO,KAAKO,KAAL,CAAWR,KAAX,CAAnB;AAEA,UAAMR,aAAa,IAAIpE,MAAJ,CAAWxB,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,wBAAxB,CAAX,EAA8DnF,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,4BAAxB,CAA9D,EAAsH,GAAGnF,WAAWqE,QAAX,CAAoBc,GAApB,CAAwB,UAAxB,CAAqC,mCAAzC,CAA4EU,OAA5E,CAAoF,WAApF,EAAiG,MAAjG,CAArH,CAAnB;AAEA,UAAMgB,MAAMhG,OAAOiG,SAAP,CAAiBlB,WAAWmB,QAAX,CAAoBhD,IAApB,CAAyB6B,UAAzB,CAAjB,EAAuDe,IAAvD,CAAZ;AAEA3G,eAAWC,MAAX,CAAkB+G,KAAlB,CAAwB1G,MAAxB,CAA+B;AAAEF,WAAK0F;AAAP,KAA/B,EAAgD;AAACvF,YAAM;AACtD,+BAAwBsG;AAD8B;AAAP,KAAhD;AAIA,WAAO;AACNL,eAAS;AACR,wBAAiB;AADT,OADH;AAGHE,YAAM;AAHH,KAAP;AAKA;AAnBsD,CAAxD,E","file":"/packages/rocketchat_livestream.js","sourcesContent":["import './routes.js';\nimport './methods.js';\n","RocketChat.models.Rooms.setStreamingOptionsById = function(_id, streamingOptions) {\n\tconst update = {\n\t\t$set: {\n\t\t\tstreamingOptions\n\t\t}\n\t};\n\treturn this.update({ _id }, update);\n};\n","RocketChat.saveStreamingOptions = function(rid, streamingOptions) {\n\tif (!Match.test(rid, String)) {\n\t\tthrow new Meteor.Error('invalid-room', 'Invalid room', {\n\t\t\t'function': 'RocketChat.saveStreamingOptions'\n\t\t});\n\t}\n\n\treturn RocketChat.models.Rooms.setStreamingOptionsById(rid, streamingOptions);\n};\n","import google from 'googleapis';\nconst OAuth2 = google.auth.OAuth2;\n\n\nconst p = fn => new Promise(function(resolve, reject) {\n\tfn(function(err, value) {\n\t\tif (err) {\n\t\t\treturn reject(err);\n\t\t}\n\t\tresolve(value.data);\n\t});\n});\n\nexport const getBroadcastStatus = async({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token\n\t});\n\tconst youtube = google.youtube({ version:'v3', auth });\n\tconst result = await p(resolve => youtube.liveBroadcasts.list({\n\t\tpart:'id,status',\n\t\tid\n\t}, resolve));\n\treturn result.items && result.items[0] && result.items[0].status.lifeCycleStatus;\n};\n\nexport const statusStreamLiveStream = async({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token\n\t});\n\n\tconst youtube = google.youtube({ version:'v3', auth });\n\tconst result = await p(resolve => youtube.liveStreams.list({\n\t\tpart:'id,status',\n\t\tid\n\t}, resolve));\n\treturn result.items && result.items[0].status.streamStatus;\n};\n\nexport const statusLiveStream = ({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n\tstatus\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token\n\t});\n\n\tconst youtube = google.youtube({ version:'v3', auth });\n\n\treturn p(resolve => youtube.liveBroadcasts.transition({\n\t\tpart:'id,status',\n\t\tid,\n\t\tbroadcastStatus: status\n\t}, resolve));\n};\n\nexport const setBroadcastStatus = ({\n\tid,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret,\n\tstatus\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token\n\t});\n\n\tconst youtube = google.youtube({ version:'v3', auth });\n\n\treturn p(resolve => youtube.liveBroadcasts.transition({\n\t\tpart:'id,status',\n\t\tid,\n\t\tbroadcastStatus: status\n\t}, resolve));\n};\n\nexport const createLiveStream = async({\n\troom,\n\taccess_token,\n\trefresh_token,\n\tclientId,\n\tclientSecret\n}) => {\n\tconst auth = new OAuth2(clientId, clientSecret);\n\tauth.setCredentials({\n\t\taccess_token,\n\t\trefresh_token\n\t});\n\tconst youtube = google.youtube({ version:'v3', auth });\n\n\tconst [stream, broadcast] = await Promise.all([p((resolve) => youtube.liveStreams.insert({\n\t\tpart: 'id,snippet,cdn,contentDetails,status',\n\t\tresource: {\n\t\t\tsnippet: {\n\t\t\t\t'title': room.name || 'RocketChat Broadcast'\n\t\t\t},\n\t\t\t'cdn': {\n\t\t\t\t'format': '480p',\n\t\t\t\t'ingestionType': 'rtmp'\n\t\t\t}\n\t\t}\n\t}, resolve)), p((resolve)=> youtube.liveBroadcasts.insert({\n\t\tpart: 'id,snippet,contentDetails,status',\n\t\tresource: {\n\t\t\tsnippet: {\n\t\t\t\t'title': room.name || 'RocketChat Broadcast',\n\t\t\t\t'scheduledStartTime' : new Date().toISOString()\n\t\t\t},\n\t\t\t'status': {\n\t\t\t\t'privacyStatus': 'unlisted'\n\t\t\t}\n\t\t}\n\t}, resolve))]);\n\n\tawait p(resolve => youtube.liveBroadcasts.bind({\n\t\tpart: 'id,snippet,status',\n\t\t// resource: {\n\t\tid: broadcast.id,\n\t\tstreamId: stream.id\n\t}, resolve));\n\n\treturn {id: stream.cdn.ingestionInfo.streamName, stream, broadcast};\n};\n","Meteor.startup(function() {\n\tRocketChat.settings.addGroup('LiveStream & Broadcasting', function() {\n\n\t\tthis.add('Livestream_enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true,\n\t\t\talert: 'This feature is currently in beta! Please report bugs to github.com/RocketChat/Rocket.Chat/issues'\n\t\t});\n\n\t\tthis.add('Broadcasting_enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true,\n\t\t\talert: 'This feature is currently in beta! Please report bugs to github.com/RocketChat/Rocket.Chat/issues',\n\t\t\tenableQuery: { _id: 'Livestream_enabled', value: true }\n\t\t});\n\n\t\tthis.add('Broadcasting_client_id', '', { type: 'string', public: false, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t\tthis.add('Broadcasting_client_secret', '', { type: 'string', public: false, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t\tthis.add('Broadcasting_api_key', '', { type: 'string', public: false, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t\tthis.add('Broadcasting_media_server_url', '', { type: 'string', public: true, enableQuery: { _id: 'Broadcasting_enabled', value: true } });\n\t});\n});\n","import {Meteor} from 'meteor/meteor';\nimport { createLiveStream, statusLiveStream, statusStreamLiveStream, getBroadcastStatus, setBroadcastStatus } from './functions/livestream';\n\nconst selectLivestreamSettings = (user) => user && user.settings && user.settings.livestream;\n\nMeteor.methods({\n\n\tasync livestreamStreamStatus({streamId}) {\n\t\tif (!streamId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Livestream ID not found', {\n\t\t\t\tmethod: 'livestreamStreamStatus'\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to stream', {\n\t\t\t\tmethod: 'livestreamStreamStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst {access_token, refresh_token} = livestreamSettings;\n\n\t\treturn await statusStreamLiveStream({\n\t\t\tid: streamId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret')\n\t\t});\n\n\t},\n\tasync setLivestreamStatus({broadcastId, status}) {\n\t\tif (!broadcastId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamStart'\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamStart'\n\t\t\t});\n\t\t}\n\n\t\tconst {access_token, refresh_token} = livestreamSettings;\n\n\t\treturn await statusLiveStream({\n\t\t\tid: broadcastId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tstatus,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret')\n\t\t});\n\n\t},\n\tasync livestreamGet({rid}) {\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamGet'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOne({_id: rid});\n\n\t\tif (!room) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to livestream', {\n\t\t\t\tmethod: 'livestreamGet'\n\t\t\t});\n\t\t}\n\n\t\tconst {access_token, refresh_token} = livestreamSettings;\n\t\treturn await createLiveStream({\n\t\t\troom,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret')\n\t\t});\n\n\t},\n\tasync getBroadcastStatus({broadcastId}) {\n\t\tif (!broadcastId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Broadcast ID not found', {\n\t\t\t\tmethod: 'getBroadcastStatus'\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to stream', {\n\t\t\t\tmethod: 'getBroadcastStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst {access_token, refresh_token} = livestreamSettings;\n\n\t\treturn await getBroadcastStatus({\n\t\t\tid: broadcastId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret')\n\t\t});\n\t},\n\tasync setBroadcastStatus({broadcastId, status}) {\n\t\tif (!broadcastId) {\n\t\t\t// TODO: change error\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Broadcast ID not found', {\n\t\t\t\tmethod: 'setBroadcastStatus'\n\t\t\t});\n\t\t}\n\t\tconst livestreamSettings = selectLivestreamSettings(Meteor.user());\n\n\t\tif (!livestreamSettings) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'You have no settings to stream', {\n\t\t\t\tmethod: 'setBroadcastStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst {access_token, refresh_token} = livestreamSettings;\n\n\t\treturn await setBroadcastStatus({\n\t\t\tid: broadcastId,\n\t\t\taccess_token,\n\t\t\trefresh_token,\n\t\t\tstatus,\n\t\t\tclientId: RocketChat.settings.get('Broadcasting_client_id'),\n\t\t\tclientSecret: RocketChat.settings.get('Broadcasting_client_secret')\n\t\t});\n\n\t}\n});\n","import google from 'googleapis';\nconst OAuth2 = google.auth.OAuth2;\n\nRocketChat.API.v1.addRoute('livestream/oauth', {\n\tget: function functionName() {\n\t\tconst clientAuth = new OAuth2(RocketChat.settings.get('Broadcasting_client_id'), RocketChat.settings.get('Broadcasting_client_secret'), `${ RocketChat.settings.get('Site_Url') }/api/v1/livestream/oauth/callback`.replace(/\\/{2}api/g, '/api'));\n\t\tconst { userId } = this.queryParams;\n\t\tconst url = clientAuth.generateAuthUrl({\n\t\t\taccess_type: 'offline',\n\t\t\tscope: ['https://www.googleapis.com/auth/youtube'],\n\t\t\tstate: JSON.stringify({\n\t\t\t\tuserId\n\t\t\t})\n\t\t});\n\n\t\treturn {\n\t\t\tstatusCode: 302,\n\t\t\theaders: {\n\t\t\t\tLocation: url\n\t\t\t}, body: 'Oauth redirect'\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('livestream/oauth/callback', {\n\tget: function functionName() {\n\t\tconst { code, state } = this.queryParams;\n\n\t\tconst { userId } = JSON.parse(state);\n\n\t\tconst clientAuth = new OAuth2(RocketChat.settings.get('Broadcasting_client_id'), RocketChat.settings.get('Broadcasting_client_secret'), `${ RocketChat.settings.get('Site_Url') }/api/v1/livestream/oauth/callback`.replace(/\\/{2}api/g, '/api'));\n\n\t\tconst ret = Meteor.wrapAsync(clientAuth.getToken.bind(clientAuth))(code);\n\n\t\tRocketChat.models.Users.update({ _id: userId }, {$set: {\n\t\t\t'settings.livestream' : ret\n\t\t}});\n\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'content-type' : 'text/html'\n\t\t\t}, body: '<script>window.close()</script>'\n\t\t};\n\t}\n});\n"]}