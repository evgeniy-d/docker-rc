{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-kick/server/server.js"],"names":["Kick","command","params","rid","Match","test","String","username","trim","replace","userId","Meteor","user","users","findOne","kickedUser","RocketChat","models","Users","findOneByUsername","Notifications","notifyUser","_id","Random","id","ts","Date","msg","TAPi18n","__","postProcess","sprintf","language","subscription","Subscriptions","findOneByRoomIdAndUserId","fields","call","slashCommands","add","description","permission"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AACA;AAEA,MAAMA,OAAO,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AAACC;AAAD,CAA1B,EAAiC;AAC7C,MAAIF,YAAY,MAAZ,IAAsB,CAACG,MAAMC,IAAN,CAAWH,MAAX,EAAmBI,MAAnB,CAA3B,EAAuD;AACtD;AACA;;AACD,QAAMC,WAAWL,OAAOM,IAAP,GAAcC,OAAd,CAAsB,GAAtB,EAA2B,EAA3B,CAAjB;;AACA,MAAIF,aAAa,EAAjB,EAAqB;AACpB;AACA;;AACD,QAAMG,SAASC,OAAOD,MAAP,EAAf;AACA,QAAME,OAAOD,OAAOE,KAAP,CAAaC,OAAb,CAAqBJ,MAArB,CAAb;AACA,QAAMK,aAAaC,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,iBAAxB,CAA0CZ,QAA1C,CAAnB;;AAEA,MAAIQ,cAAc,IAAlB,EAAwB;AACvB,WAAOC,WAAWI,aAAX,CAAyBC,UAAzB,CAAoCX,MAApC,EAA4C,SAA5C,EAAuD;AAC7DY,WAAKC,OAAOC,EAAP,EADwD;AAE7DrB,SAF6D;AAG7DsB,UAAI,IAAIC,IAAJ,EAHyD;AAI7DC,WAAKC,QAAQC,EAAR,CAAW,uBAAX,EAAoC;AACxCC,qBAAa,SAD2B;AAExCC,iBAAS,CAACxB,QAAD;AAF+B,OAApC,EAGFK,KAAKoB,QAHH;AAJwD,KAAvD,CAAP;AASA;;AAED,QAAMC,eAAejB,WAAWC,MAAX,CAAkBiB,aAAlB,CAAgCC,wBAAhC,CAAyDhC,GAAzD,EAA8DS,KAAKU,GAAnE,EAAwE;AAAEc,YAAQ;AAAEd,WAAK;AAAP;AAAV,GAAxE,CAArB;;AACA,MAAI,CAACW,YAAL,EAAmB;AAClB,WAAOjB,WAAWI,aAAX,CAAyBC,UAAzB,CAAoCX,MAApC,EAA4C,SAA5C,EAAuD;AAC7DY,WAAKC,OAAOC,EAAP,EADwD;AAE7DrB,SAF6D;AAG7DsB,UAAI,IAAIC,IAAJ,EAHyD;AAI7DC,WAAKC,QAAQC,EAAR,CAAW,8BAAX,EAA2C;AAC/CC,qBAAa,SADkC;AAE/CC,iBAAS,CAACxB,QAAD;AAFsC,OAA3C,EAGFK,KAAKoB,QAHH;AAJwD,KAAvD,CAAP;AASA;;AACDrB,SAAO0B,IAAP,CAAY,oBAAZ,EAAkC;AAAClC,OAAD;AAAMI;AAAN,GAAlC;AACA,CArCD;;AAuCAS,WAAWsB,aAAX,CAAyBC,GAAzB,CAA6B,MAA7B,EAAqCvC,IAArC,EAA2C;AAC1CwC,eAAa,0BAD6B;AAE1CtC,UAAQ,WAFkC;AAG1CuC,cAAY;AAH8B,CAA3C,E","file":"/packages/rocketchat_slashcommands-kick.js","sourcesContent":["\n// Kick is a named function that will replace /kick commands\n\nconst Kick = function(command, params, {rid}) {\n\tif (command !== 'kick' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tconst username = params.trim().replace('@', '');\n\tif (username === '') {\n\t\treturn;\n\t}\n\tconst userId = Meteor.userId();\n\tconst user = Meteor.users.findOne(userId);\n\tconst kickedUser = RocketChat.models.Users.findOneByUsername(username);\n\n\tif (kickedUser == null) {\n\t\treturn RocketChat.Notifications.notifyUser(userId, 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_doesnt_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [username]\n\t\t\t}, user.language)\n\t\t});\n\t}\n\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id, { fields: { _id: 1 } });\n\tif (!subscription) {\n\t\treturn RocketChat.Notifications.notifyUser(userId, 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_is_not_in_this_room', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [username]\n\t\t\t}, user.language)\n\t\t});\n\t}\n\tMeteor.call('removeUserFromRoom', {rid, username});\n};\n\nRocketChat.slashCommands.add('kick', Kick, {\n\tdescription: 'Remove_someone_from_room',\n\tparams: '@username',\n\tpermission: 'remove-user'\n});\n"]}