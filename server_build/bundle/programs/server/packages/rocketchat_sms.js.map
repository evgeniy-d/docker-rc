{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:sms/settings.js","meteor://ðŸ’»app/packages/rocketchat:sms/SMS.js","meteor://ðŸ’»app/packages/rocketchat:sms/services/twilio.js"],"names":["Meteor","startup","RocketChat","settings","addGroup","add","type","i18nLabel","values","key","section","enableQuery","_id","value","SMS","enabled","services","accountSid","authToken","fromNumber","registerService","name","service","getService","Error","get","twilio","module","watch","require","default","v","Twilio","constructor","parse","data","numMedia","returnData","from","From","to","To","body","Body","extra","toCountry","ToCountry","toState","ToState","toCity","ToCity","toZip","ToZip","fromCountry","FromCountry","fromState","FromState","fromCity","FromCity","fromZip","FromZip","NumMedia","parseInt","isNaN","console","error","media","mediaIndex","mediaUrl","contentType","url","push","send","toNumber","message","client","messages","create","response","headers","reason"],"mappings":"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","file":"/packages/rocketchat_sms.js","sourcesContent":["Meteor.startup(function() {\n\tRocketChat.settings.addGroup('SMS', function() {\n\t\tthis.add('SMS_Enabled', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Enabled'\n\t\t});\n\n\t\tthis.add('SMS_Service', 'twilio', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [{\n\t\t\t\tkey: 'twilio',\n\t\t\t\ti18nLabel: 'Twilio'\n\t\t\t}],\n\t\t\ti18nLabel: 'Service'\n\t\t});\n\n\t\tthis.section('Twilio', function() {\n\t\t\tthis.add('SMS_Twilio_Account_SID', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'SMS_Service',\n\t\t\t\t\tvalue: 'twilio'\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Account_SID'\n\t\t\t});\n\t\t\tthis.add('SMS_Twilio_authToken', '', {\n\t\t\t\ttype: 'string',\n\t\t\t\tenableQuery: {\n\t\t\t\t\t_id: 'SMS_Service',\n\t\t\t\t\tvalue: 'twilio'\n\t\t\t\t},\n\t\t\t\ti18nLabel: 'Auth_Token'\n\t\t\t});\n\t\t});\n\t});\n});\n","/* globals RocketChat */\nRocketChat.SMS = {\n\tenabled: false,\n\tservices: {},\n\taccountSid: null,\n\tauthToken: null,\n\tfromNumber: null,\n\n\tregisterService(name, service) {\n\t\tthis.services[name] = service;\n\t},\n\n\tgetService(name) {\n\t\tif (!this.services[name]) {\n\t\t\tthrow new Meteor.Error('error-sms-service-not-configured');\n\t\t}\n\t\treturn new this.services[name](this.accountSid, this.authToken, this.fromNumber);\n\t}\n};\n\nRocketChat.settings.get('SMS_Enabled', function(key, value) {\n\tRocketChat.SMS.enabled = value;\n});\n","/* globals RocketChat */\nimport twilio from 'twilio';\n\nclass Twilio {\n\tconstructor() {\n\t\tthis.accountSid = RocketChat.settings.get('SMS_Twilio_Account_SID');\n\t\tthis.authToken = RocketChat.settings.get('SMS_Twilio_authToken');\n\t}\n\tparse(data) {\n\t\tlet numMedia = 0;\n\n\t\tconst returnData = {\n\t\t\tfrom: data.From,\n\t\t\tto: data.To,\n\t\t\tbody: data.Body,\n\n\t\t\textra: {\n\t\t\t\ttoCountry: data.ToCountry,\n\t\t\t\ttoState: data.ToState,\n\t\t\t\ttoCity: data.ToCity,\n\t\t\t\ttoZip: data.ToZip,\n\t\t\t\tfromCountry: data.FromCountry,\n\t\t\t\tfromState: data.FromState,\n\t\t\t\tfromCity: data.FromCity,\n\t\t\t\tfromZip: data.FromZip\n\t\t\t}\n\t\t};\n\n\t\tif (data.NumMedia) {\n\t\t\tnumMedia = parseInt(data.NumMedia, 10);\n\t\t}\n\n\t\tif (isNaN(numMedia)) {\n\t\t\tconsole.error(`Error parsing NumMedia ${ data.NumMedia }`);\n\t\t\treturn returnData;\n\t\t}\n\n\t\treturnData.media = [];\n\n\t\tfor (let mediaIndex = 0; mediaIndex < numMedia; mediaIndex++) {\n\t\t\tconst media = {\n\t\t\t\t'url': '',\n\t\t\t\t'contentType': ''\n\t\t\t};\n\n\t\t\tconst mediaUrl = data[`MediaUrl${ mediaIndex }`];\n\t\t\tconst contentType = data[`MediaContentType${ mediaIndex }`];\n\n\t\t\tmedia.url = mediaUrl;\n\t\t\tmedia.contentType = contentType;\n\n\t\t\treturnData.media.push(media);\n\t\t}\n\n\t\treturn returnData;\n\t}\n\tsend(fromNumber, toNumber, message) {\n\t\tconst client = twilio(this.accountSid, this.authToken);\n\n\t\tclient.messages.create({\n\t\t\tto: toNumber,\n\t\t\tfrom: fromNumber,\n\t\t\tbody: message\n\t\t});\n\t}\n\tresponse(/* message */) {\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml'\n\t\t\t},\n\t\t\tbody: '<Response></Response>'\n\t\t};\n\t}\n\terror(error) {\n\t\tlet message = '';\n\t\tif (error.reason) {\n\t\t\tmessage = `<Message>${ error.reason }</Message>`;\n\t\t}\n\t\treturn {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'text/xml'\n\t\t\t},\n\t\t\tbody: `<Response>${ message }</Response>`\n\t\t};\n\t}\n}\n\nRocketChat.SMS.registerService('twilio', Twilio);\n"]}