{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-msg/server.js"],"names":["Msg","command","params","item","Match","test","String","trimmedParams","trim","separator","indexOf","user","Meteor","users","findOne","userId","RocketChat","Notifications","notifyUser","_id","Random","id","rid","ts","Date","msg","TAPi18n","__","language","message","slice","targetUsernameOrig","targetUsername","replace","targetUser","models","Users","findOneByUsername","postProcess","sprintf","call","msgObject","slashCommands","add","description"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AACA;;;AAIA,SAASA,GAAT,CAAaC,OAAb,EAAsBC,MAAtB,EAA8BC,IAA9B,EAAoC;AACnC,MAAIF,YAAY,KAAZ,IAAqB,CAACG,MAAMC,IAAN,CAAWH,MAAX,EAAmBI,MAAnB,CAA1B,EAAsD;AACrD;AACA;;AACD,QAAMC,gBAAgBL,OAAOM,IAAP,EAAtB;AACA,QAAMC,YAAYF,cAAcG,OAAd,CAAsB,GAAtB,CAAlB;AACA,QAAMC,OAAOC,OAAOC,KAAP,CAAaC,OAAb,CAAqBF,OAAOG,MAAP,EAArB,CAAb;;AACA,MAAIN,cAAc,CAAC,CAAnB,EAAsB;AACrB,WAAOO,WAAWC,aAAX,CAAyBC,UAAzB,CAAoCN,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AACtEI,WAAKC,OAAOC,EAAP,EADiE;AAEtEC,WAAKnB,KAAKmB,GAF4D;AAGtEC,UAAI,IAAIC,IAAJ,EAHkE;AAItEC,WAAKC,QAAQC,EAAR,CAAW,wCAAX,EAAqD,IAArD,EAA2DhB,KAAKiB,QAAhE;AAJiE,KAAhE,CAAP;AAMA;;AACD,QAAMC,UAAUtB,cAAcuB,KAAd,CAAoBrB,YAAY,CAAhC,CAAhB;AACA,QAAMsB,qBAAqBxB,cAAcuB,KAAd,CAAoB,CAApB,EAAuBrB,SAAvB,CAA3B;AACA,QAAMuB,iBAAiBD,mBAAmBE,OAAnB,CAA2B,GAA3B,EAAgC,EAAhC,CAAvB;AACA,QAAMC,aAAalB,WAAWmB,MAAX,CAAkBC,KAAlB,CAAwBC,iBAAxB,CAA0CL,cAA1C,CAAnB;;AACA,MAAIE,cAAc,IAAlB,EAAwB;AACvBlB,eAAWC,aAAX,CAAyBC,UAAzB,CAAoCN,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DI,WAAKC,OAAOC,EAAP,EAD0D;AAE/DC,WAAKnB,KAAKmB,GAFqD;AAG/DC,UAAI,IAAIC,IAAJ,EAH2D;AAI/DC,WAAKC,QAAQC,EAAR,CAAW,uBAAX,EAAoC;AACxCW,qBAAa,SAD2B;AAExCC,iBAAS,CAACR,kBAAD;AAF+B,OAApC,EAGFpB,KAAKiB,QAHH;AAJ0D,KAAhE;AASA;AACA;;AACD,QAAM;AAACN;AAAD,MAAQV,OAAO4B,IAAP,CAAY,qBAAZ,EAAmCR,cAAnC,CAAd;AACA,QAAMS,YAAY;AACjBtB,SAAKC,OAAOC,EAAP,EADY;AAEjBC,OAFiB;AAGjBG,SAAKI;AAHY,GAAlB;AAKAjB,SAAO4B,IAAP,CAAY,aAAZ,EAA2BC,SAA3B;AACA;;AAEDzB,WAAW0B,aAAX,CAAyBC,GAAzB,CAA6B,KAA7B,EAAoC3C,GAApC,EAAyC;AACxC4C,eAAa,wBAD2B;AAExC1C,UAAQ;AAFgC,CAAzC,E","file":"/packages/rocketchat_slashcommands-msg.js","sourcesContent":["\n/*\n* Msg is a named function that will replace /msg commands\n*/\n\nfunction Msg(command, params, item) {\n\tif (command !== 'msg' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\tconst trimmedParams = params.trim();\n\tconst separator = trimmedParams.indexOf(' ');\n\tconst user = Meteor.users.findOne(Meteor.userId());\n\tif (separator === -1) {\n\t\treturn\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_and_message_must_not_be_empty', null, user.language)\n\t\t});\n\t}\n\tconst message = trimmedParams.slice(separator + 1);\n\tconst targetUsernameOrig = trimmedParams.slice(0, separator);\n\tconst targetUsername = targetUsernameOrig.replace('@', '');\n\tconst targetUser = RocketChat.models.Users.findOneByUsername(targetUsername);\n\tif (targetUser == null) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date,\n\t\t\tmsg: TAPi18n.__('Username_doesnt_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [targetUsernameOrig]\n\t\t\t}, user.language)\n\t\t});\n\t\treturn;\n\t}\n\tconst {rid} = Meteor.call('createDirectMessage', targetUsername);\n\tconst msgObject = {\n\t\t_id: Random.id(),\n\t\trid,\n\t\tmsg: message\n\t};\n\tMeteor.call('sendMessage', msgObject);\n}\n\nRocketChat.slashCommands.add('msg', Msg, {\n\tdescription: 'Direct_message_someone',\n\tparams: '@username <message>'\n});\n"]}