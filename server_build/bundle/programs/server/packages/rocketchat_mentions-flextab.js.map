{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:mentions-flextab/server/publications/mentionedMessages.js"],"names":["Meteor","publish","rid","limit","userId","ready","publication","user","RocketChat","models","Users","findOneById","cursorHandle","Messages","findVisibleByMentionAndRoomId","username","sort","ts","observeChanges","added","_id","record","mentionedList","changed","removed","onStop","stop"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAAA,OAAOC,OAAP,CAAe,mBAAf,EAAoC,UAASC,GAAT,EAAcC,QAAQ,EAAtB,EAA0B;AAC7D,MAAI,CAAC,KAAKC,MAAV,EAAkB;AACjB,WAAO,KAAKC,KAAL,EAAP;AACA;;AACD,QAAMC,cAAc,IAApB;AACA,QAAMC,OAAOC,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoC,KAAKP,MAAzC,CAAb;;AACA,MAAI,CAACG,IAAL,EAAW;AACV,WAAO,KAAKF,KAAL,EAAP;AACA;;AACD,QAAMO,eAAeJ,WAAWC,MAAX,CAAkBI,QAAlB,CAA2BC,6BAA3B,CAAyDP,KAAKQ,QAA9D,EAAwEb,GAAxE,EAA6E;AACjGc,UAAM;AACLC,UAAI,CAAC;AADA,KAD2F;AAIjGd;AAJiG,GAA7E,EAKlBe,cALkB,CAKH;AACjBC,UAAMC,GAAN,EAAWC,MAAX,EAAmB;AAClBA,aAAOC,aAAP,GAAuB,IAAvB;AACA,aAAOhB,YAAYa,KAAZ,CAAkB,8BAAlB,EAAkDC,GAAlD,EAAuDC,MAAvD,CAAP;AACA,KAJgB;;AAKjBE,YAAQH,GAAR,EAAaC,MAAb,EAAqB;AACpBA,aAAOC,aAAP,GAAuB,IAAvB;AACA,aAAOhB,YAAYiB,OAAZ,CAAoB,8BAApB,EAAoDH,GAApD,EAAyDC,MAAzD,CAAP;AACA,KARgB;;AASjBG,YAAQJ,GAAR,EAAa;AACZ,aAAOd,YAAYkB,OAAZ,CAAoB,8BAApB,EAAoDJ,GAApD,CAAP;AACA;;AAXgB,GALG,CAArB;AAkBA,OAAKf,KAAL;AACA,SAAO,KAAKoB,MAAL,CAAY,YAAW;AAC7B,WAAOb,aAAac,IAAb,EAAP;AACA,GAFM,CAAP;AAGA,CA/BD,E","file":"/packages/rocketchat_mentions-flextab.js","sourcesContent":["Meteor.publish('mentionedMessages', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\tconst publication = this;\n\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\tif (!user) {\n\t\treturn this.ready();\n\t}\n\tconst cursorHandle = RocketChat.models.Messages.findVisibleByMentionAndRoomId(user.username, rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit\n\t}).observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.mentionedList = true;\n\t\t\treturn publication.added('rocketchat_mentioned_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.mentionedList = true;\n\t\t\treturn publication.changed('rocketchat_mentioned_message', _id, record);\n\t\t},\n\t\tremoved(_id) {\n\t\t\treturn publication.removed('rocketchat_mentioned_message', _id);\n\t\t}\n\t});\n\tthis.ready();\n\treturn this.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n"]}