{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-unarchive/server/messages.js","meteor://ðŸ’»app/packages/rocketchat:slashcommands-unarchive/server/server.js"],"names":["RocketChat","models","Messages","createRoomUnarchivedByRoomIdAndUser","roomId","user","createWithTypeRoomIdMessageAndUser","Unarchive","command","params","item","Match","test","String","channel","trim","room","Rooms","findOneById","rid","name","replace","findOneByName","Meteor","users","findOne","userId","Notifications","notifyUser","_id","Random","id","ts","Date","msg","TAPi18n","__","postProcess","sprintf","language","t","archived","call","slashCommands","add","description"],"mappings":"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","file":"/packages/rocketchat_slashcommands-unarchive.js","sourcesContent":["RocketChat.models.Messages.createRoomUnarchivedByRoomIdAndUser = function(roomId, user) {\n\treturn this.createWithTypeRoomIdMessageAndUser('room-unarchived', roomId, '', user);\n};\n","function Unarchive(command, params, item) {\n\tif (command !== 'unarchive' || !Match.test(params, String)) {\n\t\treturn;\n\t}\n\n\tlet channel = params.trim();\n\tlet room;\n\n\tif (channel === '') {\n\t\troom = RocketChat.models.Rooms.findOneById(item.rid);\n\t\tchannel = room.name;\n\t} else {\n\t\tchannel = channel.replace('#', '');\n\t\troom = RocketChat.models.Rooms.findOneByName(channel);\n\t}\n\n\tconst user = Meteor.users.findOne(Meteor.userId());\n\n\tif (!room) {\n\t\treturn RocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date(),\n\t\t\tmsg: TAPi18n.__('Channel_doesnt_exist', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [channel]\n\t\t\t}, user.language)\n\t\t});\n\t}\n\n\t// You can not archive direct messages.\n\tif (room.t === 'd') {\n\t\treturn;\n\t}\n\n\tif (!room.archived) {\n\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t_id: Random.id(),\n\t\t\trid: item.rid,\n\t\t\tts: new Date(),\n\t\t\tmsg: TAPi18n.__('Channel_already_Unarchived', {\n\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\tsprintf: [channel]\n\t\t\t}, user.language)\n\t\t});\n\t\treturn;\n\t}\n\n\tMeteor.call('unarchiveRoom', room._id);\n\n\tRocketChat.models.Messages.createRoomUnarchivedByRoomIdAndUser(room._id, Meteor.user());\n\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t_id: Random.id(),\n\t\trid: item.rid,\n\t\tts: new Date(),\n\t\tmsg: TAPi18n.__('Channel_Unarchived', {\n\t\t\tpostProcess: 'sprintf',\n\t\t\tsprintf: [channel]\n\t\t}, user.language)\n\t});\n\n\treturn Unarchive;\n}\n\nRocketChat.slashCommands.add('unarchive', Unarchive, {\n\tdescription: 'Unarchive',\n\tparams: '#channel'\n});\n"]}