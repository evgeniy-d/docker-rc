{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:file/file.server.js"],"names":["Grid","module","watch","require","default","v","stream","fs","path","mkdirp","prototype","tryParseObjectId","RocketChatFile","bufferToStream","buffer","bufferStream","PassThrough","end","dataURIParse","dataURI","imageData","split","image","contentType","replace","addPassThrough","st","fn","pass","GridFS","constructor","config","name","transformWrite","mongo","Package","MongoInternals","NpmModule","db","defaultRemoteCollectionDriver","store","findOneSync","Meteor","wrapAsync","collection","findOne","bind","removeSync","remove","countSync","_col","count","getFileSync","getFile","fileName","_id","root","createWriteStream","self","ws","filename","mode","content_type","rs","file","on","emit","createReadStream","getFileWithReadStream","readStream","length","uploadDate","cb","data","bindEnvironment","chunk","push","Buffer","concat","deleteFile","undefined","FileSystem","absolutePath","sep","homepath","process","env","HOME","HOMEPATH","USERPROFILE","Error","resolve","sync","statSync","stat","unlinkSync","unlink","join","size","error1"],"mappings":"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","file":"/packages/rocketchat_file.js","sourcesContent":["import Grid from 'gridfs-stream';\nimport stream from 'stream';\nimport fs from 'fs';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\n\n// Fix problem with usernames being converted to object id\nGrid.prototype.tryParseObjectId = function() {\n\treturn false;\n};\n//TODO: REMOVE RocketChatFile from globals\nRocketChatFile = {};\n\nRocketChatFile.bufferToStream = function(buffer) {\n\tconst bufferStream = new stream.PassThrough();\n\tbufferStream.end(buffer);\n\treturn bufferStream;\n};\n\nRocketChatFile.dataURIParse = function(dataURI) {\n\tconst imageData = dataURI.split(';base64,');\n\treturn {\n\t\timage: imageData[1],\n\t\tcontentType: imageData[0].replace('data:', '')\n\t};\n};\n\nRocketChatFile.addPassThrough = function(st, fn) {\n\tconst pass = new stream.PassThrough();\n\tfn(pass, st);\n\treturn pass;\n};\n\nRocketChatFile.GridFS = class {\n\tconstructor(config = {}) {\n\t\tconst {name = 'file', transformWrite} = config;\n\n\t\tthis.name = name;\n\t\tthis.transformWrite = transformWrite;\n\t\tconst mongo = Package.mongo.MongoInternals.NpmModule;\n\t\tconst db = Package.mongo.MongoInternals.defaultRemoteCollectionDriver().mongo.db;\n\t\tthis.store = new Grid(db, mongo);\n\t\tthis.findOneSync = Meteor.wrapAsync(this.store.collection(this.name).findOne.bind(this.store.collection(this.name)));\n\t\tthis.removeSync = Meteor.wrapAsync(this.store.remove.bind(this.store));\n\t\tthis.countSync = Meteor.wrapAsync(this.store._col.count.bind(this.store._col));\n\t\tthis.getFileSync = Meteor.wrapAsync(this.getFile.bind(this));\n\t}\n\n\tfindOne(fileName) {\n\t\treturn this.findOneSync({\n\t\t\t_id: fileName\n\t\t});\n\t}\n\n\tremove(fileName) {\n\t\treturn this.removeSync({\n\t\t\t_id: fileName,\n\t\t\troot: this.name\n\t\t});\n\t}\n\n\tcreateWriteStream(fileName, contentType) {\n\t\tconst self = this;\n\t\tlet ws = this.store.createWriteStream({\n\t\t\t_id: fileName,\n\t\t\tfilename: fileName,\n\t\t\tmode: 'w',\n\t\t\troot: this.name,\n\t\t\tcontent_type: contentType\n\t\t});\n\t\tif (self.transformWrite != null) {\n\t\t\tws = RocketChatFile.addPassThrough(ws, function(rs, ws) {\n\t\t\t\tconst file = {\n\t\t\t\t\tname: self.name,\n\t\t\t\t\tfileName,\n\t\t\t\t\tcontentType\n\t\t\t\t};\n\t\t\t\treturn self.transformWrite(file, rs, ws);\n\t\t\t});\n\t\t}\n\t\tws.on('close', function() {\n\t\t\treturn ws.emit('end');\n\t\t});\n\t\treturn ws;\n\t}\n\n\tcreateReadStream(fileName) {\n\t\treturn this.store.createReadStream({\n\t\t\t_id: fileName,\n\t\t\troot: this.name\n\t\t});\n\t}\n\n\tgetFileWithReadStream(fileName) {\n\t\tconst file = this.findOne(fileName);\n\t\tif (file == null) {\n\t\t\treturn null;\n\t\t}\n\t\tconst rs = this.createReadStream(fileName);\n\t\treturn {\n\t\t\treadStream: rs,\n\t\t\tcontentType: file.contentType,\n\t\t\tlength: file.length,\n\t\t\tuploadDate: file.uploadDate\n\t\t};\n\t}\n\n\tgetFile(fileName, cb) {\n\t\tconst file = this.getFileWithReadStream(fileName);\n\t\tif (!file) {\n\t\t\treturn cb();\n\t\t}\n\t\tconst data = [];\n\t\tfile.readStream.on('data', Meteor.bindEnvironment(function(chunk) {\n\t\t\treturn data.push(chunk);\n\t\t}));\n\t\treturn file.readStream.on('end', Meteor.bindEnvironment(function() {\n\t\t\treturn cb(null, {\n\t\t\t\tbuffer: Buffer.concat(data),\n\t\t\t\tcontentType: file.contentType,\n\t\t\t\tlength: file.length,\n\t\t\t\tuploadDate: file.uploadDate\n\t\t\t});\n\t\t}));\n\t}\n\n\tdeleteFile(fileName) {\n\t\tconst file = this.findOne(fileName);\n\t\tif (file == null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this.remove(fileName);\n\t}\n\n\n};\n\nRocketChatFile.FileSystem = class {\n\tconstructor(config = {}) {\n\t\tlet {absolutePath = '~/uploads'} = config;\n\t\tconst {transformWrite} = config;\n\n\t\tthis.transformWrite = transformWrite;\n\t\tif (absolutePath.split(path.sep)[0] === '~') {\n\t\t\tconst homepath = process.env.HOME || process.env.HOMEPATH || process.env.USERPROFILE;\n\t\t\tif (homepath != null) {\n\t\t\t\tabsolutePath = absolutePath.replace('~', homepath);\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unable to resolve \"~\" in path');\n\t\t\t}\n\t\t}\n\t\tthis.absolutePath = path.resolve(absolutePath);\n\t\tmkdirp.sync(this.absolutePath);\n\t\tthis.statSync = Meteor.wrapAsync(fs.stat.bind(fs));\n\t\tthis.unlinkSync = Meteor.wrapAsync(fs.unlink.bind(fs));\n\t\tthis.getFileSync = Meteor.wrapAsync(this.getFile.bind(this));\n\t}\n\n\tcreateWriteStream(fileName, contentType) {\n\t\tconst self = this;\n\t\tlet ws = fs.createWriteStream(path.join(this.absolutePath, fileName));\n\t\tif (self.transformWrite != null) {\n\t\t\tws = RocketChatFile.addPassThrough(ws, function(rs, ws) {\n\t\t\t\tconst file = {\n\t\t\t\t\tfileName,\n\t\t\t\t\tcontentType\n\t\t\t\t};\n\t\t\t\treturn self.transformWrite(file, rs, ws);\n\t\t\t});\n\t\t}\n\t\tws.on('close', function() {\n\t\t\treturn ws.emit('end');\n\t\t});\n\t\treturn ws;\n\t}\n\n\tcreateReadStream(fileName) {\n\t\treturn fs.createReadStream(path.join(this.absolutePath, fileName));\n\t}\n\n\tstat(fileName) {\n\t\treturn this.statSync(path.join(this.absolutePath, fileName));\n\t}\n\n\tremove(fileName) {\n\t\treturn this.unlinkSync(path.join(this.absolutePath, fileName));\n\t}\n\n\tgetFileWithReadStream(fileName) {\n\t\ttry {\n\t\t\tconst stat = this.stat(fileName);\n\t\t\tconst rs = this.createReadStream(fileName);\n\t\t\treturn {\n\t\t\t\treadStream: rs,\n\t\t\t\t// contentType: file.contentType\n\t\t\t\tlength: stat.size\n\t\t\t};\n\t\t} catch (error1) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetFile(fileName, cb) {\n\t\tconst file = this.getFileWithReadStream(fileName);\n\t\tif (!file) {\n\t\t\treturn cb();\n\t\t}\n\t\tconst data = [];\n\t\tfile.readStream.on('data', Meteor.bindEnvironment(function(chunk) {\n\t\t\treturn data.push(chunk);\n\t\t}));\n\t\treturn file.readStream.on('end', Meteor.bindEnvironment(function() {\n\t\t\treturn {\n\t\t\t\tbuffer: Buffer.concat(data)({\n\t\t\t\t\tcontentType: file.contentType,\n\t\t\t\t\tlength: file.length,\n\t\t\t\t\tuploadDate: file.uploadDate\n\t\t\t\t})\n\t\t\t};\n\t\t}));\n\t}\n\n\tdeleteFile(fileName) {\n\t\ttry {\n\t\t\treturn this.remove(fileName);\n\t\t} catch (error1) {\n\t\t\treturn null;\n\t\t}\n\t}\n};\n"]}