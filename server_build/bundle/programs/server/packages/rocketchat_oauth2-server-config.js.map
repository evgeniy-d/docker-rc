{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/server/models/OAuthApps.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/oauth/server/oauth2-server.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/oauth/server/default-services.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/publications/oauthApps.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/methods/addOAuthApp.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/methods/updateOAuthApp.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/methods/deleteOAuthApp.js"],"names":["RocketChat","models","OAuthApps","_Base","constructor","oauth2server","OAuth2Server","accessTokensCollectionName","refreshTokensCollectionName","authCodesCollectionName","clientsCollection","model","debug","WebApp","connectHandlers","use","app","routes","get","req","res","headers","authorization","sendStatus","send","accessToken","replace","token","oauth","AccessTokens","findOne","user","Users","findOneById","userId","sub","_id","name","email","emails","address","email_verified","verified","department","birthdate","preffered_username","username","updated_at","_updatedAt","picture","Meteor","absoluteUrl","publish","clientId","ready","find","active","fields","API","v1","addAuthMethod","headerToken","request","getToken","query","access_token","matches","match","undefined","bearerToken","getAccessToken","wrapAsync","expires","Date","insert","clientSecret","redirectUri","_createdAt","_createdBy","authz","hasPermission","error","Error","_","module","watch","require","default","v","methods","addOAuthApp","application","method","isString","trim","isBoolean","Random","id","secret","updateOAuthApp","applicationId","currentApplication","update","$set","_updatedBy","deleteOAuthApp","remove"],"mappings":"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","file":"/packages/rocketchat_oauth2-server-config.js","sourcesContent":["RocketChat.models.OAuthApps = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('oauth_apps');\n\t}\n};\n\n\n\n\n// FIND\n// findByRole: (role, options) ->\n// \tquery =\n// \troles: role\n\n// \treturn @find query, options\n\n// CREATE\n","/*global OAuth2Server */\n\nconst oauth2server = new OAuth2Server({\n\taccessTokensCollectionName: 'rocketchat_oauth_access_tokens',\n\trefreshTokensCollectionName: 'rocketchat_oauth_refresh_tokens',\n\tauthCodesCollectionName: 'rocketchat_oauth_auth_codes',\n\tclientsCollection: RocketChat.models.OAuthApps.model,\n\tdebug: true\n});\n\nWebApp.connectHandlers.use(oauth2server.app);\n\noauth2server.routes.get('/oauth/userinfo', function(req, res) {\n\tif (req.headers.authorization == null) {\n\t\treturn res.sendStatus(401).send('No token');\n\t}\n\tconst accessToken = req.headers.authorization.replace('Bearer ', '');\n\tconst token = oauth2server.oauth.model.AccessTokens.findOne({\n\t\taccessToken\n\t});\n\tif (token == null) {\n\t\treturn res.sendStatus(401).send('Invalid Token');\n\t}\n\tconst user = RocketChat.models.Users.findOneById(token.userId);\n\tif (user == null) {\n\t\treturn res.sendStatus(401).send('Invalid Token');\n\t}\n\treturn res.send({\n\t\tsub: user._id,\n\t\tname: user.name,\n\t\temail: user.emails[0].address,\n\t\temail_verified: user.emails[0].verified,\n\t\tdepartment: '',\n\t\tbirthdate: '',\n\t\tpreffered_username: user.username,\n\t\tupdated_at: user._updatedAt,\n\t\tpicture: `${ Meteor.absoluteUrl() }avatar/${ user.username }`\n\t});\n});\n\nMeteor.publish('oauthClient', function(clientId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\treturn RocketChat.models.OAuthApps.find({\n\t\tclientId,\n\t\tactive: true\n\t}, {\n\t\tfields: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n\nRocketChat.API.v1.addAuthMethod(function() {\n\tlet headerToken = this.request.headers['authorization'];\n\tconst getToken = this.request.query.access_token;\n\tif (headerToken != null) {\n\t\tconst matches = headerToken.match(/Bearer\\s(\\S+)/);\n\t\tif (matches) {\n\t\t\theaderToken = matches[1];\n\t\t} else {\n\t\t\theaderToken = undefined;\n\t\t}\n\t}\n\tconst bearerToken = headerToken || getToken;\n\tif (bearerToken == null) {\n\t\treturn;\n\t}\n\tconst getAccessToken = Meteor.wrapAsync(oauth2server.oauth.model.getAccessToken, oauth2server.oauth.model);\n\tconst accessToken = getAccessToken(bearerToken);\n\tif (accessToken == null) {\n\t\treturn;\n\t}\n\tif ((accessToken.expires != null) && accessToken.expires !== 0 && accessToken.expires < new Date()) {\n\t\treturn;\n\t}\n\tconst user = RocketChat.models.Users.findOne(accessToken.userId);\n\tif (user == null) {\n\t\treturn;\n\t}\n\treturn { user };\n});\n","if (!RocketChat.models.OAuthApps.findOne('zapier')) {\n\tRocketChat.models.OAuthApps.insert({\n\t\t_id: 'zapier',\n\t\tname: 'Zapier',\n\t\tactive: true,\n\t\tclientId: 'zapier',\n\t\tclientSecret: 'RTK6TlndaCIolhQhZ7_KHIGOKj41RnlaOq_o-7JKwLr',\n\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/',\n\t\t_createdAt: new Date,\n\t\t_createdBy: {\n\t\t\t_id: 'system',\n\t\t\tusername: 'system'\n\t\t}\n\t});\n}\n","Meteor.publish('oauthApps', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\tthis.error(Meteor.Error('error-not-allowed', 'Not allowed', { publish: 'oauthApps' }));\n\t}\n\treturn RocketChat.models.OAuthApps.find();\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\taddOAuthApp(application) {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'addOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.name) || application.name.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { method: 'addOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.redirectUri) || application.redirectUri.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-redirectUri', 'Invalid redirectUri', { method: 'addOAuthApp' });\n\t\t}\n\t\tif (!_.isBoolean(application.active)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', { method: 'addOAuthApp' });\n\t\t}\n\t\tapplication.clientId = Random.id();\n\t\tapplication.clientSecret = Random.secret();\n\t\tapplication._createdAt = new Date;\n\t\tapplication._createdBy = RocketChat.models.Users.findOne(this.userId, { fields: { username: 1 } });\n\t\tapplication._id = RocketChat.models.OAuthApps.insert(application);\n\t\treturn application;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tupdateOAuthApp(applicationId, application) {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'updateOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.name) || application.name.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { method: 'updateOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.redirectUri) || application.redirectUri.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-redirectUri', 'Invalid redirectUri', { method: 'updateOAuthApp' });\n\t\t}\n\t\tif (!_.isBoolean(application.active)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', { method: 'updateOAuthApp' });\n\t\t}\n\t\tconst currentApplication = RocketChat.models.OAuthApps.findOne(applicationId);\n\t\tif (currentApplication == null) {\n\t\t\tthrow new Meteor.Error('error-application-not-found', 'Application not found', { method: 'updateOAuthApp' });\n\t\t}\n\t\tRocketChat.models.OAuthApps.update(applicationId, {\n\t\t\t$set: {\n\t\t\t\tname: application.name,\n\t\t\t\tactive: application.active,\n\t\t\t\tredirectUri: application.redirectUri,\n\t\t\t\t_updatedAt: new Date,\n\t\t\t\t_updatedBy: RocketChat.models.Users.findOne(this.userId, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tusername: 1\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.OAuthApps.findOne(applicationId);\n\t}\n});\n","Meteor.methods({\n\tdeleteOAuthApp(applicationId) {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'deleteOAuthApp' });\n\t\t}\n\t\tconst application = RocketChat.models.OAuthApps.findOne(applicationId);\n\t\tif (application == null) {\n\t\t\tthrow new Meteor.Error('error-application-not-found', 'Application not found', { method: 'deleteOAuthApp' });\n\t\t}\n\t\tRocketChat.models.OAuthApps.remove({ _id: applicationId });\n\t\treturn true;\n\t}\n});\n"]}